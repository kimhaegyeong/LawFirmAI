# 법률 상담 챗봇 React 구현 기능 명세


## 1. 초기 화면 구성

### 1.1 웰컴 스크린 ✅ 구현 완료
- **빈 화면 상태 처리**: 대화 이력이 없을 때 중앙에 환영 메시지와 서비스 소개 표시
- **빠른 질문 카드**: 자주 묻는 법률 상담 주제를 카드 형태로 제공
  - **구현된 카테고리**:
    - 📄 계약 관련 (계약서 검토, 위약금, 계약 해제)
    - 🏠 임대차 분쟁 (임대차 분쟁, 전세금 반환, 임대차 보호법)
    - 💼 근로 관련 (근로계약, 퇴직금, 근로시간)
    - ⚖️ 손해배상 (손해배상 청구, 과실 상계, 배상 범위)
  - **2단계 선택 방식**: 카테고리 선택 → 세부 질문 선택
  - 클릭 시 해당 질문으로 자동 전송 및 새 세션 생성

## 2. 사이드바 구성 ✅ 구현 완료

### 2.1 상단 영역 - 세션 관리 ✅ 구현 완료
- **새 상담 시작 버튼**: 
  - 빨간색 프라이머리 버튼 (Plus 아이콘 포함)
  - 클릭 시 즉시 새 세션 생성 (확인 모달 없음)
  - 현재 대화는 자동 저장됨

### 2.2 대화 히스토리 ✅ 구현 완료
- **히스토리 검색창**: 
  - 상단에 검색 입력 필드 (SearchBar 컴포넌트)
  - 실시간 필터링: 제목 기반 검색 (대소문자 구분 없음)
  - 검색어 입력 시 즉시 필터링
  
- **날짜별 그룹 리스트** ✅ 구현 완료:
  - **오늘**: 당일 대화 세션들 (기본 펼침)
  - **어제**: 전일 대화 세션들
  - **지난 7일**: 최근 일주일
  - **지난 30일**: 최근 한 달
  - **이전 대화**: 30일 이상 된 대화
  - 접기/펼치기 기능 (ChevronDown/ChevronRight 아이콘)
  - 그룹별 세션 개수 표시
  
- **세션 카드 구성** ✅ 구현 완료:
  - 세션 제목 (truncate 처리, 최대 1줄)
  - 메시지 개수 및 상대 시간 표시 (예: "12개 메시지 • 2시간 전")
  - 호버 시 메뉴 버튼 표시 (MoreVertical 아이콘)
  
- **세션 액션** ✅ 구현 완료:
  - 클릭: 해당 세션 불러오기
  - 호버 시 메뉴 버튼 클릭:
    - 이름 변경 (prompt 사용)
    - 복사본 만들기 (새 세션 생성, 메시지는 재전송 필요)
    - 내보내기 (TXT 형식)
    - 삭제 (확인 다이얼로그)
  - ⚠️ 고정(Pin) 기능: 아직 구현되지 않음

### 2.3 필터 및 정렬 ⚠️ 부분 구현
- **카테고리 필터**: 
  - 상수로 정의됨 (SESSION_CATEGORIES)
  - ⚠️ UI에서 필터 기능은 아직 구현되지 않음
  
- **정렬 옵션**: 
  - 상수로 정의됨 (SORT_OPTIONS)
  - ⚠️ UI에서 정렬 기능은 아직 구현되지 않음

### 2.4 설정 영역 ✅ 구현 완료 (SettingsPanel)
- **사용자 설정** ✅ 구현 완료:
  - 테마 선택: 라이트/다크/자동 (버튼 그룹)
  - 글꼴 크기: 작게/보통/크게 (버튼 그룹)
  - 답변 속도: 즉시 표시/타이핑 효과 (버튼 그룹)
  - ⚠️ 실제 적용 기능은 아직 구현되지 않음 (UI만 존재)
  
- **알림 설정**: 
  - ⚠️ 아직 구현되지 않음

- **데이터 관리** ✅ 구현 완료:
  - 전체 히스토리 내보내기 (버튼)
  - 전체 대화 삭제 (2단계 확인: 버튼 클릭 → 확인 버튼)
  - 로컬 캐시 지우기 (버튼)
  - ⚠️ 실제 기능은 아직 구현되지 않음 (UI만 존재)

### 2.5 하단 영역 - 정보 및 링크 ⚠️ 미구현
- **사용 통계**: ⚠️ 아직 구현되지 않음
- **빠른 링크**: ⚠️ 아직 구현되지 않음
- **피드백 및 지원**: ⚠️ 아직 구현되지 않음
- **서비스 정보**: ⚠️ 아직 구현되지 않음

### 2.6 사이드바 UX ✅ 구현 완료
- **접기/펼치기**: 
  - Header의 햄버거 메뉴 아이콘으로 토글
  - 사이드바 너비: 256px (w-64) / 0px (닫힘)
  - 펼친 상태 기본값 (sidebarOpen: true)
  - 부드러운 전환 애니메이션 (transition-all duration-300)

- **반응형 너비**:
  - 데스크톱: 256px (w-64)
  - ⚠️ 태블릿/모바일 반응형은 아직 구현되지 않음

- **스크롤 영역 분리** ✅ 구현 완료:
  - 상단 버튼 고정 (border-b)
  - 히스토리 영역만 스크롤 (flex-1 overflow-y-auto)
  - 설정 패널 하단 고정 (border-t)

## 3. 대화 인터페이스 ✅ 구현 완료

### 3.1 메시지 표시 영역 ✅ 구현 완료 (ChatMessage)
- **스크롤 가능한 대화창**: ChatHistory 컴포넌트로 구현
- **사용자/봇 메시지 구분**: 
  - 사용자 메시지: 오른쪽 정렬 (justify-end), 파란색 배경 (bg-blue-50)
  - 봇 메시지: 왼쪽 정렬 (justify-start), 흰색 배경 (bg-white)
  - 프로필 아이콘: 사용자 "U", 봇 "AI" (원형 배경)
- **타임스탬프**: 각 메시지 하단에 상대 시간 표시 (formatRelativeTime)
- **메시지 복사 기능**: 봇 메시지에만 복사 버튼 (Copy 아이콘, 복사 성공 시 Check 아이콘)

### 3.2 답변 참고자료 시스템 ✅ 구현 완료 (ReferencesSection, CompactReferencesBadge)
- **접이식 참고자료 섹션**: 
  - CompactReferencesBadge: 간단한 뱃지 형태로 표시
  - ReferencesSection: 확장 가능한 상세 섹션
  - "참고 법령/판례 보기 (N개)" 버튼 (ChevronDown/ChevronUp 아이콘)
  
- **출처 표시** ✅ 구현 완료:
  - 법령명, 조항 (legal_references)
  - 판례 번호 및 요지 (sources)
  - 관련 규정 링크 (link 속성 지원)
  - 각 참고자료에 번호 표시 ([1], [2], ...)
  
- **인용 하이라이트**: 
  - ⚠️ 답변 내 참고자료 번호 하이라이트는 아직 구현되지 않음
  
- **원문 보기 모달** ✅ 구현 완료:
  - Modal 컴포넌트 사용
  - 클릭 시 전체 법령/판례 내용 팝업
  - 외부 링크 아이콘 (ExternalLink) 지원

### 3.3 연관 질문 추천 ✅ 구현 완료 (RelatedQuestions)
- **답변 완료 후 표시**: 각 봇 답변 하단에 연관 질문 섹션 표시
- **동적 생성**: metadata.related_questions 배열에서 가져옴
- **원클릭 질문**: 버튼 클릭으로 즉시 해당 질문 전송
- **UI**: 
  - Lightbulb 아이콘과 "연관 질문" 제목
  - 각 질문은 버튼 형태 (호버 효과)
  - 질문이 없으면 섹션 숨김

## 4. 입력 영역 ✅ 구현 완료

### 4.1 질의 입력창 ✅ 구현 완료 (ChatInput)
- **하단 고정 입력창**: 화면 최하단에 항상 표시 (flex-shrink-0)
- **멀티라인 텍스트**: textarea 사용, 자동 높이 조절 (최대 128px)
- **플레이스홀더**: "메시지를 입력하세요..." 안내 문구
- **Enter 전송, Shift+Enter 줄바꿈**: 키보드 단축키 지원 ✅
- **하단 안내 문구**: "Shift + Enter로 줄바꿈, Enter로 전송"

### 4.2 파일 업로드 ✅ 구현 완료
- **간결한 첨부 버튼**: 입력창 왼쪽에 Paperclip 아이콘 버튼
- **지원 파일 형식**: image/*, .pdf, .doc, .docx, .txt
- **파일 미리보기**: 
  - 입력창 위에 FileAttachment 컴포넌트로 표시
  - 파일명과 용량 표시
  - 삭제 버튼 포함
- **다중 파일 지원**: multiple 속성으로 여러 파일 동시 첨부 ✅

### 4.3 전송 버튼 ✅ 구현 완료
- **명확한 전송 버튼**: 입력창 우측 끝에 Send 아이콘 (파란색 배경)
- **비활성 상태 처리**: 
  - 메시지가 비어있고 파일이 없을 때 비활성화
  - disabled 상태 시 회색 배경
- **로딩 상태**: 
  - isLoading prop으로 전송 중 상태 관리
  - 전송 중에는 버튼과 입력창 모두 비활성화

## 5. 세션 관리 ✅ 구현 완료

### 5.1 대화 세션 ✅ 구현 완료 (useSession hook)
- **세션 ID 자동 생성**: 
  - 새 메시지 전송 시 세션이 없으면 자동 생성
  - 백엔드 API를 통해 고유 세션 ID 생성
- **세션 지속성**: 
  - React 상태로 관리 (useState)
  - 세션 변경 시 메시지 자동 로드
- **세션 초기화**: "새 상담 시작" 버튼으로 새 세션 생성

### 5.2 히스토리 관리 ✅ 구현 완료 (useHistory hook)
- **자동 저장**: 각 메시지 전송 시 백엔드 API를 통해 자동 저장
- **세션별 제목**: 
  - 백엔드에서 자동 생성 (첫 질문 기반)
  - 수동 변경 가능 (이름 변경 기능)
- **메타데이터 저장**: 
  - 생성일 (created_at), 수정일 (updated_at)
  - 메시지 수 (message_count)
  - 카테고리 (category) - ⚠️ UI에서 활용되지 않음
- **세션 불러오기**: 클릭으로 과거 대화 이어가기 ✅
- **세션 삭제**: 개별 대화 기록 삭제 옵션 (확인 다이얼로그) ✅

## 6. 부가 기능

### 6.1 사용자 경험
- **다크모드 지원**: 
  - 설정 패널에 테마 선택 UI 존재
  - ⚠️ 실제 다크모드 적용은 아직 구현되지 않음
- **반응형 디자인**: 
  - ⚠️ 모바일/태블릿 대응은 아직 구현되지 않음
  - 데스크톱 중심으로 구현됨
- **로딩 인디케이터**: 
  - LoadingSpinner 컴포넌트 존재
  - ⚠️ ChatHistory에서 로딩 상태 표시는 구현됨
- **스크롤 자동 이동**: 
  - ⚠️ 새 메시지 생성 시 자동 스크롤은 아직 구현되지 않음

### 6.2 안내 및 도움말 ⚠️ 미구현
- **사용 가이드 버튼**: ⚠️ 아직 구현되지 않음
- **면책 고지**: ⚠️ 아직 구현되지 않음
- **전문가 연결**: ⚠️ 아직 구현되지 않음

### 6.3 피드백 시스템 ✅ 부분 구현
- **답변 평가**: 
  - 각 봇 답변에 ThumbsUp/ThumbsDown 버튼 ✅
  - 피드백 전송 기능 구현됨 (sendFeedback API)
  - 선택한 피드백 시각적 표시 (배경색 변경)
- **개선 제안**: ⚠️ 문제 신고 및 의견 전달 기능은 아직 구현되지 않음

## 7. 성능 최적화

### 7.1 데이터 관리
- **세션 스토리지**: 
  - React useState로 상태 관리
  - ⚠️ Context API 또는 Redux는 사용하지 않음
- **메시지 페이지네이션**: 
  - ⚠️ 긴 대화 시 과거 메시지 lazy loading은 아직 구현되지 않음
  - 현재는 모든 메시지를 한 번에 로드
- **캐싱**: 
  - ⚠️ 자주 조회되는 법령 데이터 캐시 처리는 아직 구현되지 않음

### 7.2 응답 처리
- **스트리밍 답변**: 
  - useStreaming hook 존재
  - ⚠️ 실제 스트리밍 답변 표시는 아직 구현되지 않음
- **타임아웃 처리**: 
  - ⚠️ 장시간 응답 없을 시 에러 안내는 아직 구현되지 않음
- **재시도 기능**: 
  - ⚠️ 답변 생성 실패 시 재요청 버튼은 아직 구현되지 않음
  - 현재는 에러 발생 시 alert만 표시

---

## 구현 현황 요약

### ✅ 완전 구현
- 웰컴 스크린 (빠른 질문 카드)
- 사이드바 기본 구조 (세션 관리, 히스토리)
- 대화 인터페이스 (메시지 표시, 참고자료, 연관 질문)
- 입력 영역 (멀티라인 입력, 파일 업로드)
- 세션 관리 (생성, 불러오기, 삭제)
- 피드백 시스템 (좋아요/싫어요)

### ⚠️ 부분 구현
- 설정 패널 (UI만 존재, 실제 기능 미구현)
- 필터 및 정렬 (상수만 정의, UI 미구현)
- 다크모드 (UI만 존재, 실제 적용 미구현)

### ❌ 미구현
- 하단 정보 영역 (통계, 링크, 서비스 정보)
- 안내 및 도움말
- 스트리밍 답변
- 메시지 페이지네이션
- 캐싱 시스템
- 타임아웃 처리
- 재시도 기능
- 반응형 디자인

---