# Pseudo-Query 생성 스크립트 코드 검토 결과

## 발견된 문제점

### 1. 가비지 컬렉션 부재 (Critical)
- `gc` 모듈이 import되지 않음
- 메모리 해제 코드가 전혀 없음
- 대량 문서 처리 시 메모리 누수 발생 가능

### 2. 메모리 누수 가능성
- `ground_truth` 리스트에 모든 데이터를 계속 추가 (메모리에 계속 쌓임)
- `documents_to_process`가 전체 문서 리스트를 참조 (샘플링해도 전체 메모리 사용)
- `metadata.copy()`로 불필요한 복사
- `generated_queries`가 각 entry마다 중복 저장 (같은 queries가 여러 번 저장됨)

### 3. 성능 문제
- **순차 처리**: LLM API 호출이 순차적으로만 실행 (병렬 처리 없음)
- **배치 크기 미사용**: `batch_size` 파라미터가 있지만 실제로는 단순 sleep만 있음
- **체크포인트 기능 없음**: 중단 시 처음부터 다시 시작해야 함
- **진행 상황 모니터링 부족**: 예상 시간, 진행률 등이 없음

### 4. 로깅 문제
- Windows 호환 로깅 설정 없음 (클러스터링 스크립트와 동일한 문제 가능)

### 5. 데이터 중복
- `generated_queries`가 각 query entry마다 저장되어 메모리 낭비
- 예: 문서당 3개 질문 생성 시, 같은 queries 리스트가 3번 저장됨

## 개선 방안

### 1. 가비지 컬렉션 추가
- `import gc` 추가
- 배치 처리 후 `gc.collect()` 호출
- 큰 객체 사용 후 명시적 `del` 및 `gc.collect()`

### 2. 메모리 최적화
- 샘플링 시 실제로 샘플만 메모리에 로드
- `generated_queries` 중복 저장 제거
- 배치 단위로 결과 저장 (전체를 메모리에 보관하지 않음)

### 3. 성능 개선
- 비동기/병렬 LLM 호출 (가능한 경우)
- 체크포인트 기능 추가
- 진행 상황 모니터링 강화

### 4. 로깅 개선
- SafeStreamHandler 사용 (클러스터링 스크립트와 동일)

### 5. 데이터 구조 최적화
- `generated_queries` 중복 제거
- 메모리 효율적인 데이터 구조 사용

