#!/usr/bin/env python3
"""
향상된 SemanticKeywordMapper
추출된 법률 용어를 기반으로 확장된 의미적 관계를 제공합니다.
"""

from typing import Dict, List, Tuple, Set
from collections import defaultdict, Counter
import json

class EnhancedSemanticKeywordMapper:
    """향상된 의미적 키워드 매핑 시스템"""
    
    def __init__(self):
        # 확장된 법률 용어 간의 의미적 관계 정의
        self.semantic_relations = {
        "제1항": {
                "synonyms": [],
                "related": [
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부"
                ]
        },
        "대법원": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령"
                ]
        },
        "제2항": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부"
                ]
        },
        "지원": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령"
                ]
        },
        "시행령": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "위원",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "위원",
                        "일부",
                        "대통령령"
                ]
        },
        "위원": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "일부",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "일부",
                        "대통령령"
                ]
        },
        "일부": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "대통령령",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "대통령령"
                ]
        },
        "대통령령": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "여부"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부"
                ]
        },
        "여부": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부"
                ]
        },
        "대법": {
                "synonyms": [],
                "related": [
                        "제1항",
                        "대법원",
                        "제2항",
                        "지원",
                        "시행령",
                        "위원",
                        "일부",
                        "대통령령"
                ],
                "context": [
                        "대법원",
                        "지원",
                        "시행령",
                        "위원",
                        "일부"
                ]
        },
        "신청": {
                "synonyms": [],
                "related": [
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "공무원": {
                "synonyms": [],
                "related": [
                        "신청",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이",
                        "공무원은"
                ]
        },
        "이의신청": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "신고": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "허가": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "승인을",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "승인을": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "변경신고",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "변경신고": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "허가를",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "허가를": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "승인"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "승인": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "신고를": {
                "synonyms": [],
                "related": [
                        "신청",
                        "공무원",
                        "이의신청",
                        "신고",
                        "허가",
                        "승인을",
                        "변경신고",
                        "허가를"
                ],
                "context": [
                        "공무원",
                        "공무원의",
                        "고위공무원",
                        "공무원으",
                        "공무원이"
                ]
        },
        "채권": {
                "synonyms": [],
                "related": [
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "위반행위": {
                "synonyms": [],
                "related": [
                        "채권",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "소유권": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "소유권이": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "민사소송": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "채권의",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "채권의": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "회생채권",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "회생채권": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "민사소송법",
                        "손해배상청"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "민사소송법": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "손해배상청"
                ],
                "context": [
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반",
                        "항소장각하명령"
                ]
        },
        "손해배상청": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법"
                ],
                "context": [
                        "민사소송법",
                        "채무자회생법",
                        "법위반",
                        "법률위반",
                        "항소장각하명령"
                ]
        },
        "채권을": {
                "synonyms": [],
                "related": [
                        "채권",
                        "위반행위",
                        "소유권",
                        "소유권이",
                        "민사소송",
                        "채권의",
                        "회생채권",
                        "민사소송법"
                ],
                "context": [
                        "민사소송법",
                        "손해배상청",
                        "채무자회생법",
                        "법위반",
                        "법률위반"
                ]
        },
        "부동산": {
                "synonyms": [],
                "related": [
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부",
                        "부동산투"
                ]
        },
        "부동산에": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산의",
                        "부동산을",
                        "등기부",
                        "부동산투"
                ]
        },
        "부동산의": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산을",
                        "등기부",
                        "부동산투"
                ]
        },
        "부동산을": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "등기부",
                        "부동산투"
                ]
        },
        "등기신청": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부"
                ]
        },
        "등기부": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "전세권",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "부동산투"
                ]
        },
        "전세권": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "부동산투",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부"
                ]
        },
        "부동산투": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산등"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부"
                ]
        },
        "부동산등": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부"
                ]
        },
        "부동산실": {
                "synonyms": [],
                "related": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기신청",
                        "등기부",
                        "전세권",
                        "부동산투"
                ],
                "context": [
                        "부동산",
                        "부동산에",
                        "부동산의",
                        "부동산을",
                        "등기부"
                ]
        },
        "판결": {
                "synonyms": [],
                "related": [
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "원심판결": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판",
                        "처벌법"
                ]
        },
        "원고의": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "불법행위",
                        "형사소송법",
                        "헌법재판",
                        "처벌법"
                ]
        },
        "형사소송": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "재판장": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "불법행위",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "불법행위": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "판결에",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "형사소송법",
                        "헌법재판",
                        "처벌법"
                ]
        },
        "판결에": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결한다",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "판결한다": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "형사소송법"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "형사소송법": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "헌법재판",
                        "처벌법"
                ]
        },
        "판결주": {
                "synonyms": [],
                "related": [
                        "판결",
                        "원심판결",
                        "원고의",
                        "형사소송",
                        "재판장",
                        "불법행위",
                        "판결에",
                        "판결한다"
                ],
                "context": [
                        "원심판결",
                        "원고의",
                        "불법행위",
                        "형사소송법",
                        "헌법재판"
                ]
        },
        "가정법원": {
                "synonyms": [],
                "related": [
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부",
                        "상속증여세법"
                ]
        },
        "위자료청": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "서울가정법원",
                        "법정상속",
                        "상속세부",
                        "상속증여세법"
                ]
        },
        "혼인신고": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부"
                ]
        },
        "서울가정법원": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "법정상속",
                        "상속세부",
                        "상속증여세법"
                ]
        },
        "양육책임": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "법정상속",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부"
                ]
        },
        "법정상속": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "상속세부",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "상속세부",
                        "상속증여세법"
                ]
        },
        "상속세부": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "위자료청구권",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속증여세법"
                ]
        },
        "위자료청구권": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "상속증여세법"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부"
                ]
        },
        "상속증여세법": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부"
                ]
        },
        "상속세법": {
                "synonyms": [],
                "related": [
                        "가정법원",
                        "위자료청",
                        "혼인신고",
                        "서울가정법원",
                        "양육책임",
                        "법정상속",
                        "상속세부",
                        "위자료청구권"
                ],
                "context": [
                        "가정법원",
                        "위자료청",
                        "서울가정법원",
                        "법정상속",
                        "상속세부"
                ]
        },
        "상법": {
                "synonyms": [],
                "related": [
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관"
                ]
        },
        "감사위원": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관"
                ]
        },
        "감사원": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "회사로부",
                        "주주명부",
                        "부이사관"
                ]
        },
        "회사로부": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "주주명부",
                        "부이사관"
                ]
        },
        "주주명부": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "부이사관"
                ]
        },
        "부이사관": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "감사위원회",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부"
                ]
        },
        "감사위원회": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "토지보상법",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부"
                ]
        },
        "토지보상법": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "국가배상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부"
                ]
        },
        "국가배상법": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부"
                ]
        },
        "외부감사": {
                "synonyms": [],
                "related": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부",
                        "부이사관",
                        "감사위원회",
                        "토지보상법"
                ],
                "context": [
                        "상법",
                        "감사위원",
                        "감사원",
                        "회사로부",
                        "주주명부"
                ]
        },
        "근로기준법": {
                "synonyms": [],
                "related": [
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로",
                        "중앙노동위원회"
                ]
        },
        "최저임금법": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로",
                        "중앙노동위원회"
                ]
        },
        "노동조합법": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동위원회",
                        "선원근로",
                        "중앙노동위원회"
                ]
        },
        "노동위원회": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "선원근로",
                        "중앙노동위원회"
                ]
        },
        "근로의무": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로"
                ]
        },
        "임금지급의무": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "선원근로",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로"
                ]
        },
        "선원근로": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "중앙노동위원회",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "중앙노동위원회"
                ]
        },
        "중앙노동위원회": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "해고처분"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로"
                ]
        },
        "해고처분": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로"
                ]
        },
        "근로지원": {
                "synonyms": [],
                "related": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "근로의무",
                        "임금지급의무",
                        "선원근로",
                        "중앙노동위원회"
                ],
                "context": [
                        "근로기준법",
                        "최저임금법",
                        "노동조합법",
                        "노동위원회",
                        "선원근로"
                ]
        },
        "특허권": {
                "synonyms": [],
                "related": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원"
                ]
        },
        "특허청": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원"
                ]
        },
        "특허청장": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원"
                ]
        },
        "특허출원": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허법",
                        "특허법원",
                        "특허심판원"
                ]
        },
        "특허법": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법원",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법원",
                        "특허심판원"
                ]
        },
        "특허법원": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허심판원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허심판원"
                ]
        },
        "특허심판원": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허권의",
                        "특허권자"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원"
                ]
        },
        "특허권의": {
                "synonyms": [
                        "특허권자"
                ],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권을"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원"
                ]
        },
        "특허권자": {
                "synonyms": [
                        "특허권의"
                ],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권을"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원"
                ]
        },
        "특허권을": {
                "synonyms": [],
                "related": [
                        "특허권",
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원",
                        "특허심판원",
                        "특허권의"
                ],
                "context": [
                        "특허청",
                        "특허청장",
                        "특허출원",
                        "특허법",
                        "특허법원"
                ]
        }
}
        
        # 키워드 간 의미적 거리 매트릭스
        self.semantic_distance = self._build_semantic_distance_matrix()
        
        # 도메인별 용어 그룹
        self.domain_groups = self._build_domain_groups()
    
    def _build_semantic_distance_matrix(self) -> Dict[str, Dict[str, float]]:
        """의미적 거리 매트릭스 구축"""
        distance_matrix = {{}}
        
        for term, relations in self.semantic_relations.items():
            distance_matrix[term] = {{}}
            
            # 동의어는 거리 0.1
            for synonym in relations["synonyms"]:
                distance_matrix[term][synonym] = 0.1
            
            # 관련 용어는 거리 0.3
            for related in relations["related"]:
                distance_matrix[term][related] = 0.3
            
            # 컨텍스트 용어는 거리 0.5
            for context in relations["context"]:
                distance_matrix[term][context] = 0.5
            
            # 자기 자신은 거리 0
            distance_matrix[term][term] = 0.0
        
        return distance_matrix
    
    def _build_domain_groups(self) -> Dict[str, List[str]]:
        """도메인별 용어 그룹 구축"""
        domain_groups = defaultdict(list)
        
        for term, relations in self.semantic_relations.items():
            # 컨텍스트에서 도메인 추출
            for context in relations["context"]:
                if context in ["형사법", "민사법", "가족법", "상사법", "노동법", "부동산법", "특허법", "행정법"]:
                    domain_groups[context].append(term)
                    break
            else:
                domain_groups["기타"].append(term)
        
        return dict(domain_groups)
    
    def calculate_semantic_similarity(self, keyword1: str, keyword2: str) -> float:
        """두 키워드 간의 의미적 유사도 계산"""
        # 직접적인 의미적 관계 확인
        for term, relations in self.semantic_relations.items():
            if keyword1 == term:
                if keyword2 in relations["synonyms"]:
                    return 0.9
                elif keyword2 in relations["related"]:
                    return 0.7
                elif keyword2 in relations["context"]:
                    return 0.5
            
            if keyword2 == term:
                if keyword1 in relations["synonyms"]:
                    return 0.9
                elif keyword1 in relations["related"]:
                    return 0.7
                elif keyword1 in relations["context"]:
                    return 0.5
        
        # 부분 문자열 매칭
        if keyword1 in keyword2 or keyword2 in keyword1:
            return 0.6
        
        # 공통 문자 기반 유사도
        common_chars = set(keyword1) & set(keyword2)
        if common_chars:
            similarity = len(common_chars) / max(len(keyword1), len(keyword2))
            return similarity * 0.4
        
        return 0.0
    
    def find_semantic_related_keywords(self, target_keyword: str, threshold: float = 0.5) -> List[Tuple[str, float]]:
        """의미적으로 관련된 키워드 찾기"""
        related_keywords = []
        
        for keyword, relations in self.semantic_relations.items():
            similarity = self.calculate_semantic_similarity(target_keyword, keyword)
            if similarity >= threshold:
                related_keywords.append((keyword, similarity))
        
        # 유사도 기준으로 정렬
        related_keywords.sort(key=lambda x: x[1], reverse=True)
        return related_keywords
    
    def expand_keywords_semantically(self, keywords: List[str], expansion_factor: float = 0.7) -> List[str]:
        """키워드를 의미적으로 확장"""
        expanded_keywords = set(keywords)
        
        for keyword in keywords:
            related_keywords = self.find_semantic_related_keywords(keyword, expansion_factor)
            for related_keyword, similarity in related_keywords[:5]:  # 상위 5개만 추가
                expanded_keywords.add(related_keyword)
        
        return list(expanded_keywords)
    
    def get_semantic_keyword_clusters(self, keywords: List[str]) -> Dict[str, List[str]]:
        """키워드의 의미적 클러스터 생성"""
        clusters = defaultdict(list)
        
        for keyword in keywords:
            # 가장 유사한 대표 키워드 찾기
            best_match = None
            best_similarity = 0.0
            
            for cluster_center, relations in self.semantic_relations.items():
                similarity = self.calculate_semantic_similarity(keyword, cluster_center)
                if similarity > best_similarity and similarity >= 0.5:
                    best_similarity = similarity
                    best_match = cluster_center
            
            if best_match:
                clusters[best_match].append(keyword)
            else:
                clusters[keyword].append(keyword)  # 독립 클러스터
        
        return dict(clusters)
    
    def analyze_keyword_semantic_coverage(self, answer: str, keywords: List[str]) -> Dict[str, any]:
        """키워드의 의미적 커버리지 분석"""
        answer_lower = answer.lower()
        
        # 직접 매칭
        direct_matches = [kw for kw in keywords if kw.lower() in answer_lower]
        
        # 의미적 매칭
        semantic_matches = []
        for keyword in keywords:
            related_keywords = self.find_semantic_related_keywords(keyword, 0.6)
            for related_kw, similarity in related_keywords:
                if related_kw.lower() in answer_lower:
                    semantic_matches.append((keyword, related_kw, similarity))
        
        # 클러스터 분석
        clusters = self.get_semantic_keyword_clusters(keywords)
        cluster_coverage = {}
        for cluster_center, cluster_keywords in clusters.items():
            cluster_matches = [kw for kw in cluster_keywords if kw.lower() in answer_lower]
            cluster_coverage[cluster_center] = {
                "total_keywords": len(cluster_keywords),
                "matched_keywords": len(cluster_matches),
                "coverage_ratio": len(cluster_matches) / len(cluster_keywords) if cluster_keywords else 0
            }
        
        return {
            "direct_matches": direct_matches,
            "semantic_matches": semantic_matches,
            "cluster_coverage": cluster_coverage,
            "overall_coverage": len(direct_matches) / len(keywords) if keywords else 0,
            "semantic_coverage": len(set([match[0] for match in semantic_matches])) / len(keywords) if keywords else 0
        }
    
    def get_semantic_keyword_recommendations(self, question: str, query_type: str, base_keywords: List[str]) -> Dict[str, any]:
        """의미적 키워드 추천"""
        # 질문에서 도메인 추출
        question_domains = []
        for domain, domain_keywords in self.domain_groups.items():
            for keyword in domain_keywords:
                if keyword in question:
                    question_domains.append(domain)
                    break
        
        # 도메인별 관련 키워드 추천
        domain_recommendations = {}
        for domain in question_domains:
            if domain in self.domain_groups:
                domain_keywords = self.domain_groups[domain]
                # 기존 키워드와 유사한 도메인 키워드 추천
                recommended = []
                for base_kw in base_keywords:
                    for domain_kw in domain_keywords:
                        similarity = self.calculate_semantic_similarity(base_kw, domain_kw)
                        if similarity >= 0.6 and domain_kw not in base_keywords:
                            recommended.append((domain_kw, similarity))
                
                recommended.sort(key=lambda x: x[1], reverse=True)
                domain_recommendations[domain] = [kw for kw, sim in recommended[:5]]
        
        # 의미적 확장 키워드
        expanded_keywords = self.expand_keywords_semantically(base_keywords, 0.7)
        new_keywords = [kw for kw in expanded_keywords if kw not in base_keywords]
        
        return {
            "domain_recommendations": domain_recommendations,
            "expanded_keywords": new_keywords,
            "semantic_clusters": self.get_semantic_keyword_clusters(base_keywords),
            "recommended_keywords": new_keywords[:10]  # 상위 10개 추천
        }
    
    def get_domain_statistics(self) -> Dict[str, any]:
        """도메인별 통계 정보"""
        stats = {}
        for domain, keywords in self.domain_groups.items():
            stats[domain] = {
                "total_keywords": len(keywords),
                "top_keywords": keywords[:5],  # 상위 5개 키워드
                "semantic_relations_count": len([kw for kw in keywords if kw in self.semantic_relations])
            }
        return stats
    
    def export_semantic_relations(self, output_file: str):
        """의미적 관계를 JSON 파일로 내보내기"""
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(self.semantic_relations, f, ensure_ascii=False, indent=2)
    
    def load_semantic_relations(self, input_file: str):
        """JSON 파일에서 의미적 관계 로드"""
        with open(input_file, 'r', encoding='utf-8') as f:
            self.semantic_relations = json.load(f)
        self.semantic_distance = self._build_semantic_distance_matrix()
        self.domain_groups = self._build_domain_groups()

# 사용 예시
if __name__ == "__main__":
    mapper = EnhancedSemanticKeywordMapper()
    
    # 테스트
    test_keywords = ["계약", "손해배상", "소송"]
    expanded = mapper.expand_keywords_semantically(test_keywords)
    print(f"확장된 키워드: {{expanded}}")
    
    clusters = mapper.get_semantic_keyword_clusters(test_keywords)
    print(f"키워드 클러스터: {{clusters}}")
    
    stats = mapper.get_domain_statistics()
    print(f"도메인 통계: {{stats}}")
