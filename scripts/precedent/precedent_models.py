#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
판례 수집 관련 데이터 모델 정의
"""

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, Any, Optional


class CollectionStatus(Enum):
    """수집 상태 열거형"""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


class PrecedentCategory(Enum):
    """판례 카테고리 열거형"""
    CIVIL_CONTRACT = "민사_계약손해"
    CIVIL_PROPERTY = "민사_물권"
    CIVIL_FAMILY = "민사_가족법"
    CRIMINAL = "형사"
    ADMINISTRATIVE = "행정"
    COMMERCIAL = "상사법"
    LABOR = "노동법"
    INTELLECTUAL_PROPERTY = "지적재산권"
    CONSUMER = "소비자법"
    ENVIRONMENT = "환경법"
    OTHER = "기타"


@dataclass
class CollectionStats:
    """수집 통계 데이터 클래스"""
    start_time: datetime = field(default_factory=datetime.now)
    end_time: Optional[datetime] = None
    target_count: int = 5000
    collected_count: int = 0
    saved_count: int = 0
    duplicate_count: int = 0
    failed_count: int = 0
    keywords_processed: int = 0
    total_keywords: int = 0
    api_requests_made: int = 0
    api_errors: int = 0
    status: CollectionStatus = CollectionStatus.PENDING
    
    @property
    def success_rate(self) -> float:
        """성공률 계산"""
        total_attempts = self.collected_count + self.duplicate_count + self.failed_count
        return (self.collected_count / total_attempts * 100) if total_attempts > 0 else 0.0
    
    @property
    def duration(self) -> Optional[timedelta]:
        """수집 소요 시간"""
        if self.end_time:
            return self.end_time - self.start_time
        return None


@dataclass
class PrecedentData:
    """판례 데이터 클래스"""
    precedent_id: str
    case_name: str
    case_number: str
    court: str
    case_type: str
    decision_date: str
    category: PrecedentCategory
    raw_data: Dict[str, Any]
    detail_info: Dict[str, Any] = field(default_factory=dict)
    collected_at: datetime = field(default_factory=datetime.now)
    
    def __post_init__(self):
        """데이터 검증"""
        if not self.precedent_id:
            raise ValueError("판례 ID는 필수입니다")
        if not self.case_name:
            raise ValueError("사건명은 필수입니다")
    
    @property
    def hash_id(self) -> str:
        """판례 데이터의 해시 ID 생성"""
        import hashlib
        content = f"{self.precedent_id}_{self.case_name}_{self.case_number}"
        return hashlib.md5(content.encode('utf-8')).hexdigest()


# 검색 키워드 (법률 분야별) - 최적화 버전
SEARCH_KEYWORDS = [
    # 민사법 (기존 + 확장) - 고효율 키워드 우선
    "계약", "손해배상", "불법행위", "소유권", "점유권", "유치권", "저당권", "질권",
    "임대차", "매매", "증여", "상속", "유언", "혼인", "이혼", "친자관계",
    "채권", "채무", "이행", "지연", "이자", "위약금", "해제", "해지", 
    "무효", "취소", "취득시효", "소멸시효", "담보", "보증", "연대",
    
    # 추가 고효율 키워드 (판례가 많은 키워드)
    "사건", "소송", "재판", "판결", "확정", "기판력", "소송물", "당사자",
    "원고", "피고", "항소", "상고", "재심", "집행", "강제집행", "가압류",
    "가처분", "보전처분", "가산금", "과태료", "벌금", "형", "징역", "금고",
    "채권자", "채무자", "채권양도", "채무인수", "상계", "공탁", "압류", "가압류",
    
    # 형사법 (기존 + 확장)
    "절도", "강도", "사기", "횡령", "배임", "강간", "강제추행", "살인", "상해",
    "교통사고", "음주운전", "마약", "도박", "폭행", "협박", "강요",
    "절도죄", "강도죄", "사기죄", "횡령죄", "배임죄", "강간죄", "강제추행죄", 
    "살인죄", "상해죄", "교통사고처리특례법", "도로교통법", "특가법", "경범죄",
    "보안관찰법", "보호관찰", "가석방", "집행유예", "선고유예", "형의실효", "형의소멸",
    "공범", "교사범", "방조범", "미수범", "기수범", "예비음모", "음모",
    
    # 행정법 (기존 + 확장)
    "행정처분", "허가", "인가", "신고", "신청", "이의신청", "행정심판", "행정소송",
    "국세", "지방세", "부동산등기", "건축허가", "환경영향평가",
    "행정절차", "행정규칙", "행정지도", "행정계획", "행정계약", "행정상 손해배상", 
    "국가배상", "손실보상", "행정상 강제집행", "행정벌", "과태료", "과징금",
    "행정상 즉시강제", "행정상 대집행", "행정상 강제징수", "행정상 강제집행",
    "행정상 강제징수", "행정상 강제집행", "행정상 강제징수", "행정상 강제집행",
    
    # 상사법 (기존 + 확장)
    "회사", "주식", "주주", "이사", "감사", "합병", "분할", "해산", "청산",
    "어음", "수표", "보험", "해상", "항공", "운송",
    "유한회사", "합명회사", "합자회사", "유한책임회사", "상호", "상호권", 
    "상호권침해", "상호권침해금지", "상호권침해금지청구", "상호권침해금지청구권",
    "상호권침해금지청구권의 행사", "상호권침해금지청구권의 행사방법",
    "상호권침해금지청구권의 행사요건", "상호권침해금지청구권의 행사효과",
    "상호권침해금지청구권의 행사제한", "상호권침해금지청구권의 행사기간",
    
    # 노동법 (기존 + 확장)
    "근로계약", "임금", "근로시간", "휴게시간", "휴일", "연차유급휴가", "해고",
    "퇴직금", "산업재해", "산업안전", "노동조합", "단체교섭", "파업",
    "근로자", "사용자", "근로조건", "근로기준", "근로기준법", "근로기준법위반",
    "근로기준법위반죄", "근로기준법위반처벌", "근로기준법위반처벌법",
    "근로기준법위반처벌법위반", "근로기준법위반처벌법위반죄",
    "근로기준법위반처벌법위반처벌", "근로기준법위반처벌법위반처벌법",
    "근로기준법위반처벌법위반처벌법위반", "근로기준법위반처벌법위반처벌법위반죄",
    
    # 지적재산권법 (기존 + 확장)
    "특허", "실용신안", "디자인", "상표", "저작권", "영업비밀", "부정경쟁",
    "라이선스", "기술이전", "발명", "창작물",
    "특허권", "실용신안권", "디자인권", "상표권", "저작권", "영업비밀권", 
    "부정경쟁방지", "부정경쟁방지법", "부정경쟁방지법위반", "부정경쟁방지법위반죄",
    "부정경쟁방지법위반처벌", "부정경쟁방지법위반처벌법", "부정경쟁방지법위반처벌법위반",
    "부정경쟁방지법위반처벌법위반죄", "부정경쟁방지법위반처벌법위반처벌",
    "부정경쟁방지법위반처벌법위반처벌법", "부정경쟁방지법위반처벌법위반처벌법위반",
    
    # 소비자법 (기존 + 확장)
    "소비자", "계약", "약관", "표시광고", "할부거래", "방문판매", "다단계판매",
    "통신판매", "전자상거래", "개인정보", "정보공개",
    "소비자기본법", "소비자기본법위반", "소비자기본법위반죄", "소비자기본법위반처벌",
    "소비자기본법위반처벌법", "소비자기본법위반처벌법위반", "소비자기본법위반처벌법위반죄",
    "소비자기본법위반처벌법위반처벌", "소비자기본법위반처벌법위반처벌법",
    "소비자기본법위반처벌법위반처벌법위반", "소비자기본법위반처벌법위반처벌법위반죄",
    "소비자기본법위반처벌법위반처벌법위반처벌", "소비자기본법위반처벌법위반처벌법위반처벌법",
    
    # 환경법 (기존 + 확장)
    "환경", "대기", "수질", "토양", "소음", "진동", "악취", "폐기물",
    "환경영향평가", "환경오염", "생태계", "자연환경",
    "환경정책", "환경정책기본법", "환경정책기본법위반", "환경정책기본법위반죄",
    "환경정책기본법위반처벌", "환경정책기본법위반처벌법", "환경정책기본법위반처벌법위반",
    "환경정책기본법위반처벌법위반죄", "환경정책기본법위반처벌법위반처벌",
    "환경정책기본법위반처벌법위반처벌법", "환경정책기본법위반처벌법위반처벌법위반",
    "환경정책기본법위반처벌법위반처벌법위반죄", "환경정책기본법위반처벌법위반처벌법위반처벌",
    
    # 가족법 (신규 추가)
    "가족", "가족법", "가족관계", "가족관계등록", "가족관계등록법", "가족관계등록법위반",
    "가족관계등록법위반죄", "가족관계등록법위반처벌", "가족관계등록법위반처벌법",
    "가족관계등록법위반처벌법위반", "가족관계등록법위반처벌법위반죄",
    "가족관계등록법위반처벌법위반처벌", "가족관계등록법위반처벌법위반처벌법",
    
    # 부동산법 (신규 추가)
    "부동산", "부동산법", "부동산등기", "부동산등기법", "부동산등기법위반",
    "부동산등기법위반죄", "부동산등기법위반처벌", "부동산등기법위반처벌법",
    "부동산등기법위반처벌법위반", "부동산등기법위반처벌법위반죄",
    "부동산등기법위반처벌법위반처벌", "부동산등기법위반처벌법위반처벌법",
    
    # 금융법 (신규 추가)
    "금융", "금융법", "금융거래", "금융거래법", "금융거래법위반", "금융거래법위반죄",
    "금융거래법위반처벌", "금융거래법위반처벌법", "금융거래법위반처벌법위반",
    "금융거래법위반처벌법위반죄", "금융거래법위반처벌법위반처벌",
    "금융거래법위반처벌법위반처벌법", "금융거래법위반처벌법위반처벌법위반",
    
    # 의료법 (신규 추가)
    "의료", "의료법", "의료사고", "의료사고처리", "의료사고처리법", "의료사고처리법위반",
    "의료사고처리법위반죄", "의료사고처리법위반처벌", "의료사고처리법위반처벌법",
    "의료사고처리법위반처벌법위반", "의료사고처리법위반처벌법위반죄",
    "의료사고처리법위반처벌법위반처벌", "의료사고처리법위반처벌법위반처벌법",
    
    # 교육법 (신규 추가)
    "교육", "교육법", "교육기본법", "교육기본법위반", "교육기본법위반죄",
    "교육기본법위반처벌", "교육기본법위반처벌법", "교육기본법위반처벌법위반",
    "교육기본법위반처벌법위반죄", "교육기본법위반처벌법위반처벌",
    "교육기본법위반처벌법위반처벌법", "교육기본법위반처벌법위반처벌법위반",
    
    # 사회보장법 (신규 추가)
    "사회보장", "사회보장법", "사회보장기본법", "사회보장기본법위반", "사회보장기본법위반죄",
    "사회보장기본법위반처벌", "사회보장기본법위반처벌법", "사회보장기본법위반처벌법위반",
    "사회보장기본법위반처벌법위반죄", "사회보장기본법위반처벌법위반처벌",
    "사회보장기본법위반처벌법위반처벌법", "사회보장기본법위반처벌법위반처벌법위반"
]

# 우선순위 키워드 (중요도 순) - 확장 버전
PRIORITY_KEYWORDS = [
    # 1순위: 핵심 민사법 키워드 (100건)
    "계약", "손해배상", "불법행위", "소유권", "점유권", "채권", "채무", "이행",
    
    # 2순위: 주요 형사법 키워드 (80건)
    "사기", "절도", "강도", "교통사고", "음주운전", "절도죄", "강도죄", "사기죄",
    
    # 3순위: 행정법 키워드 (60건)
    "행정처분", "허가", "인가", "국세", "지방세", "행정절차", "국가배상", "손실보상",
    
    # 4순위: 상사법 키워드 (50건)
    "회사", "주식", "주주", "이사", "합병", "유한회사", "합명회사", "상호",
    
    # 5순위: 노동법 키워드 (40건)
    "근로계약", "임금", "해고", "퇴직금", "산업재해", "근로자", "사용자", "근로조건",
    
    # 6순위: 지적재산권법 키워드 (30건)
    "특허", "저작권", "상표", "영업비밀", "부정경쟁", "특허권", "실용신안권", "디자인권",
    
    # 7순위: 소비자법 키워드 (25건)
    "소비자", "약관", "표시광고", "할부거래", "전자상거래", "소비자기본법", "개인정보", "정보공개",
    
    # 8순위: 환경법 키워드 (20건)
    "환경", "대기", "수질", "폐기물", "환경영향평가", "환경정책", "환경오염", "생태계",
    
    # 9순위: 가족법 키워드 (15건)
    "가족", "가족법", "가족관계", "가족관계등록", "혼인", "이혼", "친자관계", "상속",
    
    # 10순위: 부동산법 키워드 (15건)
    "부동산", "부동산법", "부동산등기", "부동산등기법", "임대차", "매매", "증여", "유언",
    
    # 11순위: 금융법 키워드 (15건)
    "금융", "금융법", "금융거래", "금융거래법", "어음", "수표", "보험", "해상",
    
    # 12순위: 의료법 키워드 (15건)
    "의료", "의료법", "의료사고", "의료사고처리", "의료사고처리법", "의료사고처리법위반",
    
    # 13순위: 교육법 키워드 (15건)
    "교육", "교육법", "교육기본법", "교육기본법위반", "교육기본법위반죄",
    
    # 14순위: 사회보장법 키워드 (15건)
    "사회보장", "사회보장법", "사회보장기본법", "사회보장기본법위반", "사회보장기본법위반죄"
]

# 키워드별 수집 목표 건수 (우선순위에 따라 차등) - 2배 증가 버전
KEYWORD_TARGET_COUNTS = {
    # 1순위: 240건 (핵심 민사법 - 2배 증가)
    "계약": 240, "손해배상": 240, "불법행위": 240, "소유권": 240, "점유권": 240,
    "채권": 240, "채무": 240, "이행": 240,
    
    # 1.5순위: 200건 (고효율 키워드 - 2배 증가)
    "사건": 200, "소송": 200, "재판": 200, "판결": 200, "확정": 200,
    "원고": 200, "피고": 200, "항소": 200, "상고": 200,
    
    # 2순위: 180건 (주요 형사법 - 2배 증가)
    "사기": 180, "절도": 180, "강도": 180, "교통사고": 180, "음주운전": 180,
    "절도죄": 180, "강도죄": 180, "사기죄": 180,
    
    # 3순위: 120건 (행정법 - 2배 증가)
    "행정처분": 120, "허가": 120, "인가": 120, "국세": 120, "지방세": 120,
    "행정절차": 120, "국가배상": 120, "손실보상": 120,
    
    # 4순위: 100건 (상사법 - 2배 증가)
    "회사": 100, "주식": 100, "주주": 100, "이사": 100, "합병": 100,
    "유한회사": 100, "합명회사": 100, "상호": 100,
    
    # 5순위: 80건 (노동법 - 2배 증가)
    "근로계약": 80, "임금": 80, "해고": 80, "퇴직금": 80, "산업재해": 80,
    "근로자": 80, "사용자": 80, "근로조건": 80,
    
    # 6순위: 60건 (지적재산권법 - 2배 증가)
    "특허": 60, "저작권": 60, "상표": 60, "영업비밀": 60, "부정경쟁": 60,
    "특허권": 60, "실용신안권": 60, "디자인권": 60,
    
    # 7순위: 50건 (소비자법 - 2배 증가)
    "소비자": 50, "약관": 50, "표시광고": 50, "할부거래": 50, "전자상거래": 50,
    "소비자기본법": 50, "개인정보": 50, "정보공개": 50,
    
    # 8순위: 40건 (환경법 - 2배 증가)
    "환경": 40, "대기": 40, "수질": 40, "폐기물": 40, "환경영향평가": 40,
    "환경정책": 40, "환경오염": 40, "생태계": 40,
    
    # 9순위: 30건 (가족법 - 2배 증가)
    "가족": 30, "가족법": 30, "가족관계": 30, "가족관계등록": 30,
    "혼인": 30, "이혼": 30, "친자관계": 30, "상속": 30,
    
    # 10순위: 30건 (부동산법 - 2배 증가)
    "부동산": 30, "부동산법": 30, "부동산등기": 30, "부동산등기법": 30,
    "임대차": 30, "매매": 30, "증여": 30, "유언": 30,
    
    # 11순위: 30건 (금융법 - 2배 증가)
    "금융": 30, "금융법": 30, "금융거래": 30, "금융거래법": 30,
    "어음": 30, "수표": 30, "보험": 30, "해상": 30,
    
    # 12순위: 30건 (의료법 - 2배 증가)
    "의료": 30, "의료법": 30, "의료사고": 30, "의료사고처리": 30,
    "의료사고처리법": 30, "의료사고처리법위반": 30,
    
    # 13순위: 30건 (교육법 - 2배 증가)
    "교육": 30, "교육법": 30, "교육기본법": 30, "교육기본법위반": 30,
    "교육기본법위반죄": 30,
    
    # 14순위: 30건 (사회보장법 - 2배 증가)
    "사회보장": 30, "사회보장법": 30, "사회보장기본법": 30, "사회보장기본법위반": 30,
    "사회보장기본법위반죄": 30
}

# 기본 키워드당 수집 건수 (우선순위 키워드가 아닌 경우) - 2배 증가
DEFAULT_KEYWORD_COUNT = 50

# 백업 키워드 (수집이 부족할 때 사용)
FALLBACK_KEYWORDS = [
    # 일반적인 법률 용어
    "법원", "법원장", "판사", "검사", "변호사", "법무사", "공증인",
    "법정", "법정공개", "법정비공개", "재판", "심리", "변론", "증인",
    "증거", "증거조사", "증거보전", "증거개시", "증거신청", "증거채택",
    "증거배제", "증거능력", "증명력", "자백", "진술", "진술거부권",
    "진술조서", "진술서", "진술보조인", "진술보조인선임", "진술보조인선임권",
    
    # 소송 관련 용어
    "소송", "소송물", "소송요건", "소송능력", "소송행위", "소송행위능력",
    "소송대리", "소송대리권", "소송대리인", "소송대리인선임", "소송대리인선임권",
    "소송비용", "소송비용부담", "소송비용상계", "소송비용확정", "소송비용집행",
    "소송보조", "소송보조인", "소송보조인선임", "소송보조인선임권",
    
    # 판결 관련 용어
    "판결", "판결서", "판결정본", "판결등본", "판결초본", "판결확정",
    "판결확정력", "판결기판력", "판결집행력", "판결집행", "판결집행명령",
    "판결집행명령신청", "판결집행명령신청권", "판결집행명령신청서",
    
    # 항소/상고 관련
    "항소", "항소장", "항소이유서", "항소이유", "항소기간", "항소제기",
    "항소제기권", "항소제기권자", "항소제기권자능력", "항소제기권자능력확인",
    "상고", "상고장", "상고이유서", "상고이유", "상고기간", "상고제기",
    "상고제기권", "상고제기권자", "상고제기권자능력", "상고제기권자능력확인",
    
    # 집행 관련
    "집행", "집행문", "집행문부여", "집행문부여신청", "집행문부여신청권",
    "집행문부여신청서", "집행문부여신청권자", "집행문부여신청권자능력",
    "강제집행", "강제집행신청", "강제집행신청권", "강제집행신청권자",
    "강제집행신청서", "강제집행신청권자능력", "강제집행신청권자능력확인",
    
    # 가압류/가처분
    "가압류", "가압류신청", "가압류신청권", "가압류신청권자", "가압류신청서",
    "가압류신청권자능력", "가압류신청권자능력확인", "가압류신청권자능력확인신청",
    "가처분", "가처분신청", "가처분신청권", "가처분신청권자", "가처분신청서",
    "가처분신청권자능력", "가처분신청권자능력확인", "가처분신청권자능력확인신청",
    
    # 보전처분
    "보전처분", "보전처분신청", "보전처분신청권", "보전처분신청권자", "보전처분신청서",
    "보전처분신청권자능력", "보전처분신청권자능력확인", "보전처분신청권자능력확인신청",
    
    # 기타 법률 용어
    "법령", "법규", "법규명령", "법규명령위반", "법규명령위반죄",
    "법규명령위반죄처벌", "법규명령위반죄처벌법", "법규명령위반죄처벌법위반",
    "법규명령위반죄처벌법위반죄", "법규명령위반죄처벌법위반죄처벌",
]

# 법원 코드
COURT_CODES = {
    "01": "대법원",
    "02": "고등법원", 
    "03": "지방법원",
    "04": "가정법원",
    "05": "행정법원"
}

# 사건유형 코드
CASE_TYPE_CODES = {
    "01": "민사",
    "02": "형사", 
    "03": "행정",
    "04": "가사",
    "05": "특별법"
}
