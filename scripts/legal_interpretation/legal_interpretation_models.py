#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
법령해석례 수집 관련 데이터 모델 정의
"""

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, Any, Optional


class CollectionStatus(Enum):
    """수집 상태 열거형"""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


class InterpretationCategory(Enum):
    """법령해석례 카테고리 열거형"""
    ADMINISTRATIVE = "행정법"
    CIVIL = "민사법"
    CRIMINAL = "형사법"
    COMMERCIAL = "상사법"
    LABOR = "노동법"
    INTELLECTUAL_PROPERTY = "지적재산권법"
    CONSUMER = "소비자법"
    ENVIRONMENT = "환경법"
    FINANCE = "금융법"
    INFORMATION_TECHNOLOGY = "정보통신법"
    OTHER = "기타"


class MinistryType(Enum):
    """중앙부처 유형 열거형"""
    PLANNING_FINANCE = "기획재정부"
    EDUCATION = "교육부"
    SCIENCE_TECH = "과학기술정보통신부"
    FOREIGN_AFFAIRS = "외교부"
    UNIFICATION = "통일부"
    JUSTICE = "법무부"
    DEFENSE = "국방부"
    ADMINISTRATION_SAFETY = "행정안전부"
    CULTURE_SPORTS = "문화체육관광부"
    AGRICULTURE = "농림축산식품부"
    TRADE_INDUSTRY = "산업통상자원부"
    HEALTH_WELFARE = "보건복지부"
    ENVIRONMENT = "환경부"
    EMPLOYMENT_LABOR = "고용노동부"
    GENDER_FAMILY = "여성가족부"
    LAND_INFRASTRUCTURE = "국토교통부"
    OCEANS_FISHERIES = "해양수산부"
    SMALL_MEDIUM_BUSINESS = "중소벤처기업부"
    FAIR_TRADE = "공정거래위원회"
    FINANCIAL_SUPERVISION = "금융감독원"
    OTHER = "기타"


@dataclass
class CollectionStats:
    """수집 통계 데이터 클래스"""
    start_time: datetime = field(default_factory=datetime.now)
    end_time: Optional[datetime] = None
    target_count: int = 2000
    collected_count: int = 0
    saved_count: int = 0
    duplicate_count: int = 0
    failed_count: int = 0
    keywords_processed: int = 0
    total_keywords: int = 0
    api_requests_made: int = 0
    api_errors: int = 0
    status: CollectionStatus = CollectionStatus.PENDING
    
    @property
    def success_rate(self) -> float:
        """성공률 계산"""
        total_attempts = self.collected_count + self.duplicate_count + self.failed_count
        return (self.collected_count / total_attempts * 100) if total_attempts > 0 else 0.0
    
    @property
    def duration(self) -> Optional[timedelta]:
        """수집 소요 시간"""
        if self.end_time:
            return self.end_time - self.start_time
        return None


@dataclass
class LegalInterpretationData:
    """법령해석례 데이터 클래스"""
    interpretation_id: str
    case_name: str
    case_number: str
    ministry: str
    decision_date: str
    category: InterpretationCategory
    topic: str
    raw_data: Dict[str, Any]
    collected_at: datetime = field(default_factory=datetime.now)
    
    # 상세 정보 필드들
    question_content: Optional[str] = None  # 질의 내용
    answer_content: Optional[str] = None   # 회신 내용
    related_laws: Optional[str] = None     # 관련 법령
    html_content: Optional[str] = None     # HTML 본문
    detail_url: Optional[str] = None       # 상세 링크
    inquiry_agency: Optional[str] = None   # 질의기관
    reply_agency: Optional[str] = None     # 회신기관
    
    def __post_init__(self):
        """데이터 검증"""
        if not self.interpretation_id:
            raise ValueError("법령해석례 ID는 필수입니다")
        if not self.case_name:
            raise ValueError("사건명은 필수입니다")
    
    @property
    def hash_id(self) -> str:
        """법령해석례 데이터의 해시 ID 생성"""
        import hashlib
        content = f"{self.interpretation_id}_{self.case_name}_{self.case_number}"
        return hashlib.md5(content.encode('utf-8')).hexdigest()


# 법령해석 관련 검색 키워드 (우선순위별)
INTERPRETATION_KEYWORDS = [
    # 행정법 (최우선)
    "행정처분", "허가", "인가", "신고", "신청", "이의신청", "행정심판", "행정소송",
    "국세", "지방세", "부동산등기", "건축허가", "환경영향평가", "도시계획",
    "행정절차", "행정규칙", "행정지도", "행정계획", "행정계약", "행정상 손해배상",
    "국가배상", "손실보상", "행정상 강제집행", "행정벌", "과태료", "과징금",
    
    # 민사법
    "계약", "손해배상", "불법행위", "소유권", "점유권", "물권", "채권", "채무",
    "임대차", "매매", "증여", "상속", "유언", "혼인", "이혼", "친자관계",
    "이행", "지연", "이자", "위약금", "해제", "해지", "무효", "취소",
    "취득시효", "소멸시효", "담보", "보증", "연대", "상계", "공탁",
    
    # 형사법
    "절도", "강도", "사기", "횡령", "배임", "강간", "강제추행", "살인", "상해",
    "교통사고", "음주운전", "마약", "도박", "폭행", "협박", "강요",
    "절도죄", "강도죄", "사기죄", "횡령죄", "배임죄", "강간죄", "강제추행죄",
    "살인죄", "상해죄", "교통사고처리특례법", "도로교통법", "특가법", "경범죄",
    "보안관찰법", "보호관찰", "가석방", "집행유예", "선고유예", "형의실효",
    
    # 상사법
    "회사", "주식", "주주", "이사", "감사", "합병", "분할", "해산", "청산",
    "어음", "수표", "보험", "해상", "항공", "운송", "상행위",
    "유한회사", "합명회사", "합자회사", "유한책임회사", "상호", "상호권",
    
    # 노동법
    "근로계약", "임금", "근로시간", "휴게시간", "휴일", "연차유급휴가", "해고",
    "퇴직금", "산업재해", "산업안전", "노동조합", "단체교섭", "파업", "파견근로",
    "근로자", "사용자", "근로조건", "근로기준", "근로기준법", "근로기준법위반",
    
    # 지적재산권법
    "특허", "실용신안", "디자인", "상표", "저작권", "영업비밀", "부정경쟁",
    "라이선스", "기술이전", "발명", "창작물", "저작인접권",
    "특허권", "실용신안권", "디자인권", "상표권", "저작권", "영업비밀권",
    
    # 소비자법
    "소비자", "계약", "약관", "표시광고", "할부거래", "방문판매", "다단계판매",
    "통신판매", "전자상거래", "개인정보", "정보공개", "소비자분쟁",
    "소비자기본법", "소비자기본법위반", "소비자기본법위반죄",
    
    # 환경법
    "환경", "대기", "수질", "토양", "소음", "진동", "악취", "폐기물",
    "환경영향평가", "환경오염", "생태계", "자연환경", "기후변화",
    "환경정책", "환경정책기본법", "환경정책기본법위반",
    
    # 금융법
    "금융", "은행", "보험", "증권", "자본시장", "금융투자", "신용정보",
    "금융감독", "금융거래", "금융기관", "금융상품", "금융투자업법",
    
    # 정보통신법
    "정보통신", "전자거래", "개인정보", "정보보호", "사이버보안", "데이터",
    "인터넷", "모바일", "클라우드", "빅데이터", "인공지능", "개인정보보호법"
]

# 우선순위 키워드 (중요도 순)
PRIORITY_KEYWORDS = [
    # 1순위: 핵심 행정법 키워드 (100건)
    "행정처분", "허가", "인가", "신고", "신청", "이의신청", "행정심판", "행정소송",
    
    # 2순위: 주요 민사법 키워드 (80건)
    "계약", "손해배상", "불법행위", "소유권", "점유권", "채권", "채무", "이행",
    
    # 3순위: 형사법 키워드 (60건)
    "사기", "절도", "강도", "교통사고", "음주운전", "절도죄", "강도죄", "사기죄",
    
    # 4순위: 상사법 키워드 (50건)
    "회사", "주식", "주주", "이사", "합병", "유한회사", "합명회사", "상호",
    
    # 5순위: 노동법 키워드 (40건)
    "근로계약", "임금", "해고", "퇴직금", "산업재해", "근로자", "사용자", "근로조건",
    
    # 6순위: 지적재산권법 키워드 (30건)
    "특허", "저작권", "상표", "영업비밀", "부정경쟁", "특허권", "실용신안권", "디자인권",
    
    # 7순위: 소비자법 키워드 (25건)
    "소비자", "약관", "표시광고", "할부거래", "전자상거래", "소비자기본법", "개인정보", "정보공개",
    
    # 8순위: 환경법 키워드 (20건)
    "환경", "대기", "수질", "폐기물", "환경영향평가", "환경정책", "환경오염", "생태계",
    
    # 9순위: 금융법 키워드 (15건)
    "금융", "은행", "보험", "증권", "자본시장", "금융투자", "신용정보", "금융감독",
    
    # 10순위: 정보통신법 키워드 (15건)
    "정보통신", "전자거래", "개인정보", "정보보호", "사이버보안", "데이터", "인터넷", "모바일"
]

# 키워드별 수집 목표 건수 (우선순위에 따라 차등)
KEYWORD_TARGET_COUNTS = {
    # 1순위: 100건 (핵심 행정법)
    "행정처분": 100, "허가": 100, "인가": 100, "신고": 100, "신청": 100,
    "이의신청": 100, "행정심판": 100, "행정소송": 100,
    
    # 2순위: 80건 (주요 민사법)
    "계약": 80, "손해배상": 80, "불법행위": 80, "소유권": 80, "점유권": 80,
    "채권": 80, "채무": 80, "이행": 80,
    
    # 3순위: 60건 (형사법)
    "사기": 60, "절도": 60, "강도": 60, "교통사고": 60, "음주운전": 60,
    "절도죄": 60, "강도죄": 60, "사기죄": 60,
    
    # 4순위: 50건 (상사법)
    "회사": 50, "주식": 50, "주주": 50, "이사": 50, "합병": 50,
    "유한회사": 50, "합명회사": 50, "상호": 50,
    
    # 5순위: 40건 (노동법)
    "근로계약": 40, "임금": 40, "해고": 40, "퇴직금": 40, "산업재해": 40,
    "근로자": 40, "사용자": 40, "근로조건": 40,
    
    # 6순위: 30건 (지적재산권법)
    "특허": 30, "저작권": 30, "상표": 30, "영업비밀": 30, "부정경쟁": 30,
    "특허권": 30, "실용신안권": 30, "디자인권": 30,
    
    # 7순위: 25건 (소비자법)
    "소비자": 25, "약관": 25, "표시광고": 25, "할부거래": 25, "전자상거래": 25,
    "소비자기본법": 25, "개인정보": 25, "정보공개": 25,
    
    # 8순위: 20건 (환경법)
    "환경": 20, "대기": 20, "수질": 20, "폐기물": 20, "환경영향평가": 20,
    "환경정책": 20, "환경오염": 20, "생태계": 20,
    
    # 9순위: 15건 (금융법)
    "금융": 15, "은행": 15, "보험": 15, "증권": 15, "자본시장": 15,
    "금융투자": 15, "신용정보": 15, "금융감독": 15,
    
    # 10순위: 15건 (정보통신법)
    "정보통신": 15, "전자거래": 15, "개인정보": 15, "정보보호": 15,
    "사이버보안": 15, "데이터": 15, "인터넷": 15, "모바일": 15
}

# 기본 키워드당 수집 건수 (우선순위 키워드가 아닌 경우)
DEFAULT_KEYWORD_COUNT = 20

# 중앙부처별 키워드
MINISTRY_KEYWORDS = {
    "기획재정부": ["예산", "세금", "국고", "재정", "경제정책", "물가", "금융정책"],
    "교육부": ["교육", "학교", "학생", "교사", "대학", "연구", "학술"],
    "과학기술정보통신부": ["과학", "기술", "정보통신", "연구개발", "혁신", "디지털"],
    "외교부": ["외교", "국제", "외국인", "비자", "여권", "영사"],
    "통일부": ["통일", "북한", "남북", "대북", "평화"],
    "법무부": ["법무", "검찰", "교정", "출입국", "법무행정"],
    "국방부": ["국방", "군사", "병역", "군인", "국방정책"],
    "행정안전부": ["행정", "안전", "지방자치", "공무원", "행정제도"],
    "문화체육관광부": ["문화", "체육", "관광", "예술", "스포츠", "콘텐츠"],
    "농림축산식품부": ["농업", "축산", "식품", "농촌", "식량", "농정"],
    "산업통상자원부": ["산업", "통상", "자원", "에너지", "무역", "투자"],
    "보건복지부": ["보건", "복지", "의료", "건강", "사회보장", "노인"],
    "환경부": ["환경", "대기", "수질", "폐기물", "생태", "기후"],
    "고용노동부": ["고용", "노동", "근로", "직업", "산업안전", "노사관계"],
    "여성가족부": ["여성", "가족", "아동", "청소년", "성평등", "가족정책"],
    "국토교통부": ["국토", "교통", "건설", "도시", "주택", "물류"],
    "해양수산부": ["해양", "수산", "어업", "항만", "해운", "해양정책"],
    "중소벤처기업부": ["중소기업", "벤처", "창업", "기업지원", "소상공인"],
    "공정거래위원회": ["공정거래", "독점", "경쟁", "불공정거래", "소비자보호"],
    "금융감독원": ["금융감독", "금융기관", "금융상품", "금융거래", "금융정책"]
}

# 해석 주제별 분류 키워드
INTERPRETATION_TOPIC_KEYWORDS = {
    "행정법": ["행정처분", "허가", "인가", "신고", "행정심판", "행정소송"],
    "민사법": ["계약", "손해배상", "소유권", "물권", "채권", "상속"],
    "형사법": ["절도", "강도", "사기", "살인", "상해", "교통사고"],
    "상사법": ["회사", "주식", "어음", "수표", "보험", "상행위"],
    "노동법": ["근로계약", "임금", "해고", "노동조합", "산업재해"],
    "지적재산권법": ["특허", "저작권", "상표", "영업비밀", "부정경쟁"],
    "소비자법": ["소비자", "계약", "약관", "표시광고", "할부거래"],
    "환경법": ["환경", "대기", "수질", "폐기물", "환경영향평가"],
    "금융법": ["금융", "은행", "보험", "증권", "자본시장"],
    "정보통신법": ["정보통신", "전자거래", "개인정보", "사이버보안"]
}

# 백업 키워드 (수집이 부족할 때 사용)
FALLBACK_KEYWORDS = [
    # 일반적인 법률 용어
    "법원", "법원장", "판사", "검사", "변호사", "법무사", "공증인",
    "법정", "법정공개", "법정비공개", "재판", "심리", "변론", "증인",
    "증거", "증거조사", "증거보전", "증거개시", "증거신청", "증거채택",
    "증거배제", "증거능력", "증명력", "자백", "진술", "진술거부권",
    
    # 소송 관련 용어
    "소송", "소송물", "소송요건", "소송능력", "소송행위", "소송행위능력",
    "소송대리", "소송대리권", "소송대리인", "소송대리인선임", "소송대리인선임권",
    "소송비용", "소송비용부담", "소송비용상계", "소송비용확정", "소송비용집행",
    
    # 판결 관련 용어
    "판결", "판결서", "판결정본", "판결등본", "판결초본", "판결확정",
    "판결확정력", "판결기판력", "판결집행력", "판결집행", "판결집행명령",
    
    # 항소/상고 관련
    "항소", "항소장", "항소이유서", "항소이유", "항소기간", "항소제기",
    "상고", "상고장", "상고이유서", "상고이유", "상고기간", "상고제기",
    
    # 집행 관련
    "집행", "집행문", "집행문부여", "집행문부여신청", "집행문부여신청권",
    "강제집행", "강제집행신청", "강제집행신청권", "강제집행신청권자",
    
    # 가압류/가처분
    "가압류", "가압류신청", "가압류신청권", "가압류신청권자", "가압류신청서",
    "가처분", "가처분신청", "가처분신청권", "가처분신청권자", "가처분신청서",
    
    # 보전처분
    "보전처분", "보전처분신청", "보전처분신청권", "보전처분신청권자", "보전처분신청서",
    
    # 기타 법률 용어
    "법령", "법규", "법규명령", "법규명령위반", "법규명령위반죄",
    "법규명령위반죄처벌", "법규명령위반죄처벌법", "법규명령위반죄처벌법위반"
]
