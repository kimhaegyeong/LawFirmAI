#!/usr/bin/env python3
"""
행정심판례 수집 관련 데이터 모델 정의
"""

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, Any, Optional


class CollectionStatus(Enum):
    """수집 상태 열거형"""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


class AppealType(Enum):
    """행정심판 유형 열거형"""
    PERMIT_APPROVAL = "허가인가"
    DISPOSITION_CANCELLATION = "처분취소"
    IMPOSITION_DISPOSITION = "부과처분"
    DISCIPLINARY_DISPOSITION = "징계처분"
    TAX_DISPOSITION = "세무처분"
    CONSTRUCTION_DISPOSITION = "건축처분"
    ENVIRONMENTAL_DISPOSITION = "환경처분"
    URBAN_PLANNING = "도시계획"
    TRAFFIC_DISPOSITION = "교통처분"
    HEALTH_WELFARE = "보건복지"
    EDUCATION_DISPOSITION = "교육처분"
    LABOR_DISPOSITION = "노동처분"
    FINANCE_DISPOSITION = "금융처분"
    OTHER = "기타"


@dataclass
class CollectionStats:
    """수집 통계 데이터 클래스"""
    start_time: datetime = field(default_factory=datetime.now)
    end_time: Optional[datetime] = None
    target_count: int = 1000
    collected_count: int = 0
    saved_count: int = 0
    duplicate_count: int = 0
    failed_count: int = 0
    keywords_processed: int = 0
    total_keywords: int = 0
    api_requests_made: int = 0
    api_errors: int = 0
    status: CollectionStatus = CollectionStatus.PENDING
    
    @property
    def success_rate(self) -> float:
        """성공률 계산"""
        total_attempts = self.collected_count + self.duplicate_count + self.failed_count
        return (self.collected_count / total_attempts * 100) if total_attempts > 0 else 0.0
    
    @property
    def duration(self) -> Optional[timedelta]:
        """수집 소요 시간"""
        if self.end_time:
            return self.end_time - self.start_time
        return None


@dataclass
class AdministrativeAppealData:
    """행정심판례 데이터 클래스"""
    appeal_id: str
    case_name: str
    case_number: str
    appeal_type: AppealType
    decision_date: str
    raw_data: Dict[str, Any]
    collected_at: datetime = field(default_factory=datetime.now)
    
    def __post_init__(self):
        """데이터 검증"""
        if not self.appeal_id:
            raise ValueError("행정심판례 ID는 필수입니다")
        if not self.case_name:
            raise ValueError("사건명은 필수입니다")
    
    @property
    def hash_id(self) -> str:
        """행정심판례 데이터의 해시 ID 생성"""
        import hashlib
        content = f"{self.appeal_id}_{self.case_name}_{self.case_number}"
        return hashlib.md5(content.encode('utf-8')).hexdigest()


# 행정심판 관련 검색 키워드 (우선순위별)
ADMINISTRATIVE_APPEAL_KEYWORDS = [
    # 행정처분 관련 (최우선)
    "행정처분", "허가", "인가", "신고", "신청", "이의신청", "취소처분", "정지처분",
    "과태료", "과징금", "부과처분", "징계처분", "면허취소", "허가취소",
    
    # 국세 관련
    "국세", "지방세", "세무조사", "가산세", "가산금", "체납처분", "압류처분",
    "세무서", "국세청", "지방세청", "세무조정", "세무심사",
    
    # 건축 관련
    "건축허가", "건축신고", "건축법", "건축물", "건축계획", "건축심의",
    "용도변경", "증축", "개축", "재건축", "철거명령",
    
    # 환경 관련
    "환경영향평가", "환경오염", "대기오염", "수질오염", "소음진동", "악취",
    "폐기물", "폐기물처리", "환경영향평가서", "환경영향평가심의",
    
    # 도시계획 관련
    "도시계획", "도시계획시설", "도시계획사업", "도시계획변경", "도시계획결정",
    "개발행위허가", "개발행위신고", "개발제한구역", "도시계획구역",
    
    # 교통 관련
    "교통", "교통영향평가", "교통계획", "교통시설", "도로", "교량", "터널",
    "교통사고", "교통위반", "교통정리", "교통신호",
    
    # 보건복지 관련
    "보건", "복지", "의료", "의료기관", "의료기기", "의료인", "의료법",
    "사회보장", "국민연금", "건강보험", "산업재해보상보험",
    
    # 교육 관련
    "교육", "학교", "교육기관", "교육법", "교육과정", "교육시설", "교육시설기준",
    "사립학교", "사립학교법", "교육감", "교육위원회",
    
    # 노동 관련
    "노동", "고용", "근로", "근로기준법", "산업안전보건법", "산업재해",
    "노동조합", "단체교섭", "파업", "파견근로", "기간제근로",
    
    # 금융 관련
    "금융", "금융감독", "금융기관", "금융상품", "금융거래", "금융투자",
    "은행", "보험", "증권", "자본시장", "금융투자업법",
    
    # 부동산 관련
    "부동산", "부동산등기", "부동산등기법", "부동산등기법위반",
    "부동산등기법위반죄", "부동산등기법위반처벌", "부동산등기법위반처벌법",
    
    # 정보통신 관련
    "정보통신", "전자거래", "개인정보", "정보보호", "사이버보안", "데이터",
    "인터넷", "모바일", "클라우드", "빅데이터", "인공지능",
    
    # 의료 관련
    "의료", "의료법", "의료사고", "의료사고처리", "의료사고처리법",
    "의료사고처리법위반", "의료사고처리법위반죄", "의료사고처리법위반처벌",
    
    # 사회보장 관련
    "사회보장", "사회보장법", "사회보장기본법", "사회보장기본법위반",
    "사회보장기본법위반죄", "사회보장기본법위반처벌", "사회보장기본법위반처벌법"
]

# 우선순위 키워드 (중요도 순)
PRIORITY_KEYWORDS = [
    # 1순위: 핵심 행정처분 키워드 (80건)
    "행정처분", "허가", "인가", "신고", "신청", "이의신청", "취소처분", "정지처분",
    
    # 2순위: 주요 국세 키워드 (60건)
    "국세", "지방세", "세무조사", "가산세", "가산금", "체납처분", "압류처분", "세무서",
    
    # 3순위: 건축 관련 키워드 (50건)
    "건축허가", "건축신고", "건축법", "건축물", "건축계획", "건축심의", "용도변경", "증축",
    
    # 4순위: 환경 관련 키워드 (40건)
    "환경영향평가", "환경오염", "대기오염", "수질오염", "소음진동", "악취", "폐기물", "폐기물처리",
    
    # 5순위: 도시계획 키워드 (35건)
    "도시계획", "도시계획시설", "도시계획사업", "도시계획변경", "도시계획결정", "개발행위허가", "개발행위신고", "개발제한구역",
    
    # 6순위: 교통 키워드 (30건)
    "교통", "교통영향평가", "교통계획", "교통시설", "도로", "교량", "터널", "교통사고",
    
    # 7순위: 보건복지 키워드 (25건)
    "보건", "복지", "의료", "의료기관", "의료기기", "의료인", "의료법", "사회보장",
    
    # 8순위: 교육 키워드 (20건)
    "교육", "학교", "교육기관", "교육법", "교육과정", "교육시설", "교육시설기준", "사립학교",
    
    # 9순위: 노동 키워드 (20건)
    "노동", "고용", "근로", "근로기준법", "산업안전보건법", "산업재해", "노동조합", "단체교섭",
    
    # 10순위: 금융 키워드 (15건)
    "금융", "금융감독", "금융기관", "금융상품", "금융거래", "금융투자", "은행", "보험"
]

# 키워드별 수집 목표 건수 (우선순위에 따라 차등)
KEYWORD_TARGET_COUNTS = {
    # 1순위: 80건 (핵심 행정처분)
    "행정처분": 80, "허가": 80, "인가": 80, "신고": 80, "신청": 80,
    "이의신청": 80, "취소처분": 80, "정지처분": 80,
    
    # 2순위: 60건 (주요 국세)
    "국세": 60, "지방세": 60, "세무조사": 60, "가산세": 60, "가산금": 60,
    "체납처분": 60, "압류처분": 60, "세무서": 60,
    
    # 3순위: 50건 (건축 관련)
    "건축허가": 50, "건축신고": 50, "건축법": 50, "건축물": 50, "건축계획": 50,
    "건축심의": 50, "용도변경": 50, "증축": 50,
    
    # 4순위: 40건 (환경 관련)
    "환경영향평가": 40, "환경오염": 40, "대기오염": 40, "수질오염": 40,
    "소음진동": 40, "악취": 40, "폐기물": 40, "폐기물처리": 40,
    
    # 5순위: 35건 (도시계획)
    "도시계획": 35, "도시계획시설": 35, "도시계획사업": 35, "도시계획변경": 35,
    "도시계획결정": 35, "개발행위허가": 35, "개발행위신고": 35, "개발제한구역": 35,
    
    # 6순위: 30건 (교통)
    "교통": 30, "교통영향평가": 30, "교통계획": 30, "교통시설": 30,
    "도로": 30, "교량": 30, "터널": 30, "교통사고": 30,
    
    # 7순위: 25건 (보건복지)
    "보건": 25, "복지": 25, "의료": 25, "의료기관": 25, "의료기기": 25,
    "의료인": 25, "의료법": 25, "사회보장": 25,
    
    # 8순위: 20건 (교육)
    "교육": 20, "학교": 20, "교육기관": 20, "교육법": 20, "교육과정": 20,
    "교육시설": 20, "교육시설기준": 20, "사립학교": 20,
    
    # 9순위: 20건 (노동)
    "노동": 20, "고용": 20, "근로": 20, "근로기준법": 20, "산업안전보건법": 20,
    "산업재해": 20, "노동조합": 20, "단체교섭": 20,
    
    # 10순위: 15건 (금융)
    "금융": 15, "금융감독": 15, "금융기관": 15, "금융상품": 15,
    "금융거래": 15, "금융투자": 15, "은행": 15, "보험": 15
}

# 기본 키워드당 수집 건수 (우선순위 키워드가 아닌 경우)
DEFAULT_KEYWORD_COUNT = 10

# 심판 유형별 분류 키워드
APPEAL_TYPE_KEYWORDS = {
    "허가인가": ["허가", "인가", "면허", "등록", "신고"],
    "처분취소": ["처분", "취소", "정지", "철회", "무효"],
    "부과처분": ["부과", "과태료", "과징금", "가산세", "가산금"],
    "징계처분": ["징계", "해임", "파면", "정직", "감봉"],
    "세무처분": ["국세", "지방세", "세무조사", "체납처분", "압류"],
    "건축처분": ["건축", "건축허가", "건축신고", "용도변경", "철거명령"],
    "환경처분": ["환경", "환경영향평가", "환경오염", "폐기물", "소음진동"],
    "도시계획": ["도시계획", "개발행위", "개발제한구역", "도시계획시설"],
    "교통처분": ["교통", "교통영향평가", "교통사고", "교통위반", "교통정리"],
    "보건복지": ["보건", "복지", "의료", "사회보장", "국민연금"],
    "교육처분": ["교육", "학교", "교육기관", "사립학교", "교육법"],
    "노동처분": ["노동", "고용", "근로", "산업재해", "노동조합"],
    "금융처분": ["금융", "금융감독", "금융기관", "금융상품", "금융거래"]
}

# 백업 키워드 (수집이 부족할 때 사용)
FALLBACK_KEYWORDS = [
    # 일반적인 행정 용어
    "행정", "행정기관", "행정청", "행정청장", "행정청장관", "행정청장관대리",
    "행정청장관대리자", "행정청장관대리자권한", "행정청장관대리자권한대행",
    "행정청장관대리자권한대행자", "행정청장관대리자권한대행자권한",
    
    # 행정절차 관련
    "행정절차", "행정절차법", "행정절차법위반", "행정절차법위반죄",
    "행정절차법위반처벌", "행정절차법위반처벌법", "행정절차법위반처벌법위반",
    
    # 행정규칙 관련
    "행정규칙", "행정규칙법", "행정규칙법위반", "행정규칙법위반죄",
    "행정규칙법위반처벌", "행정규칙법위반처벌법", "행정규칙법위반처벌법위반",
    
    # 행정지도 관련
    "행정지도", "행정지도법", "행정지도법위반", "행정지도법위반죄",
    "행정지도법위반처벌", "행정지도법위반처벌법", "행정지도법위반처벌법위반",
    
    # 행정계획 관련
    "행정계획", "행정계획법", "행정계획법위반", "행정계획법위반죄",
    "행정계획법위반처벌", "행정계획법위반처벌법", "행정계획법위반처벌법위반",
    
    # 행정계약 관련
    "행정계약", "행정계약법", "행정계약법위반", "행정계약법위반죄",
    "행정계약법위반처벌", "행정계약법위반처벌법", "행정계약법위반처벌법위반",
    
    # 행정상 손해배상 관련
    "행정상손해배상", "행정상손해배상법", "행정상손해배상법위반", "행정상손해배상법위반죄",
    "행정상손해배상법위반처벌", "행정상손해배상법위반처벌법", "행정상손해배상법위반처벌법위반",
    
    # 국가배상 관련
    "국가배상", "국가배상법", "국가배상법위반", "국가배상법위반죄",
    "국가배상법위반처벌", "국가배상법위반처벌법", "국가배상법위반처벌법위반",
    
    # 손실보상 관련
    "손실보상", "손실보상법", "손실보상법위반", "손실보상법위반죄",
    "손실보상법위반처벌", "손실보상법위반처벌법", "손실보상법위반처벌법위반",
    
    # 행정상 강제집행 관련
    "행정상강제집행", "행정상강제집행법", "행정상강제집행법위반", "행정상강제집행법위반죄",
    "행정상강제집행법위반처벌", "행정상강제집행법위반처벌법", "행정상강제집행법위반처벌법위반",
    
    # 행정벌 관련
    "행정벌", "행정벌법", "행정벌법위반", "행정벌법위반죄",
    "행정벌법위반처벌", "행정벌법위반처벌법", "행정벌법위반처벌법위반",
    
    # 과태료 관련
    "과태료", "과태료법", "과태료법위반", "과태료법위반죄",
    "과태료법위반처벌", "과태료법위반처벌법", "과태료법위반처벌법위반",
    
    # 과징금 관련
    "과징금", "과징금법", "과징금법위반", "과징금법위반죄",
    "과징금법위반처벌", "과징금법위반처벌법", "과징금법위반처벌법위반"
]
