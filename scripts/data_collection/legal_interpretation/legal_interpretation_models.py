#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
법령?석례 ?집 관???이??모델 ?의
"""

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, Any, Optional


class CollectionStatus(Enum):
    """?집 ?태 ?거??""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


class InterpretationCategory(Enum):
    """법령?석례 카테고리 ?거??""
    ADMINISTRATIVE = "?정?
    CIVIL = "민사?
    CRIMINAL = "?사?
    COMMERCIAL = "?사?
    LABOR = "?동?
    INTELLECTUAL_PROPERTY = "지?재?권?
    CONSUMER = "?비?법"
    ENVIRONMENT = "?경?
    FINANCE = "금융?
    INFORMATION_TECHNOLOGY = "?보?신?
    OTHER = "기?"


class MinistryType(Enum):
    """중앙부??형 ?거??""
    PLANNING_FINANCE = "기획?정부"
    EDUCATION = "교육부"
    SCIENCE_TECH = "과학기술?보?신부"
    FOREIGN_AFFAIRS = "?교부"
    UNIFICATION = "?일부"
    JUSTICE = "법무부"
    DEFENSE = "?부"
    ADMINISTRATION_SAFETY = "?정?전부"
    CULTURE_SPORTS = "문화체육관광?"
    AGRICULTURE = "?림축산?품부"
    TRADE_INDUSTRY = "?업?상?원부"
    HEALTH_WELFARE = "보건복?부"
    ENVIRONMENT = "?경부"
    EMPLOYMENT_LABOR = "고용?동부"
    GENDER_FAMILY = "?성가족?"
    LAND_INFRASTRUCTURE = "?교통부"
    OCEANS_FISHERIES = "?양?산부"
    SMALL_MEDIUM_BUSINESS = "중소벤처기업부"
    FAIR_TRADE = "공정거래?원??
    FINANCIAL_SUPERVISION = "금융감독??
    OTHER = "기?"


@dataclass
class CollectionStats:
    """?집 ?계 ?이???래??""
    start_time: datetime = field(default_factory=datetime.now)
    end_time: Optional[datetime] = None
    target_count: int = 2000
    collected_count: int = 0
    saved_count: int = 0
    duplicate_count: int = 0
    failed_count: int = 0
    keywords_processed: int = 0
    total_keywords: int = 0
    api_requests_made: int = 0
    api_errors: int = 0
    status: CollectionStatus = CollectionStatus.PENDING
    
    @property
    def success_rate(self) -> float:
        """?공?계산"""
        total_attempts = self.collected_count + self.duplicate_count + self.failed_count
        return (self.collected_count / total_attempts * 100) if total_attempts > 0 else 0.0
    
    @property
    def duration(self) -> Optional[timedelta]:
        """?집 ?요 ?간"""
        if self.end_time:
            return self.end_time - self.start_time
        return None


@dataclass
class LegalInterpretationData:
    """법령?석례 ?이???래??""
    interpretation_id: str
    case_name: str
    case_number: str
    ministry: str
    decision_date: str
    category: InterpretationCategory
    topic: str
    raw_data: Dict[str, Any]
    collected_at: datetime = field(default_factory=datetime.now)
    
    # ?세 ?보 ?드??
    question_content: Optional[str] = None  # 질의 ?용
    answer_content: Optional[str] = None   # ?신 ?용
    related_laws: Optional[str] = None     # 관??법령
    html_content: Optional[str] = None     # HTML 본문
    detail_url: Optional[str] = None       # ?세 링크
    inquiry_agency: Optional[str] = None   # 질의기?
    reply_agency: Optional[str] = None     # ?신기?
    
    def __post_init__(self):
        """?이??검?""
        if not self.interpretation_id:
            raise ValueError("법령?석례 ID???수?니??)
        if not self.case_name:
            raise ValueError("?건명? ?수?니??)
    
    @property
    def hash_id(self) -> str:
        """법령?석례 ?이?의 ?시 ID ?성"""
        import hashlib
        content = f"{self.interpretation_id}_{self.case_name}_{self.case_number}"
        return hashlib.md5(content.encode('utf-8')).hexdigest()


# 법령?석 관??검???워??(?선?위?
INTERPRETATION_KEYWORDS = [
    # ?정?(최우??
    "?정처분", "??", "??", "?고", "?청", "?의?청", "?정?판", "?정?송",
    "?", "지방세", "부?산?기", "건축??", "?경?향??", "?시계획",
    "?정?차", "?정규칙", "?정지??, "?정계획", "?정계약", "?정???해배상",
    "??배상", "?실보상", "?정??강제집행", "?정?, "과태?, "과징?,
    
    # 민사?
    "계약", "?해배상", "불법?위", "?유?, "?유?, "물권", "채권", "채무",
    "???, "매매", "증여", "?속", "?언", "?인", "?혼", "친자관?,
    "?행", "지??, "?자", "?약?, "?제", "??", "무효", "취소",
    "취득?효", "?멸?효", "?보", "보증", "??", "?계", "공탁",
    
    # ?사?
    "?도", "강도", "?기", "?령", "배임", "강간", "강제추행", "?인", "?해",
    "교통?고", "?주?전", "마약", "?박", "??", "?박", "강요",
    "?도?, "강도?, "?기?, "?령?, "배임?, "강간?, "강제추행?,
    "?인?, "?해?, "교통?고처리???, "?로교통?, "???, "경범?,
    "보안관찰법", "보호관?, "가?방", "집행?예", "?고?예", "?의?효",
    
    # ?사?
    "?사", "주식", "주주", "?사", "감사", "?병", "분할", "?산", "?",
    "?음", "?표", "보험", "?상", "??", "?송", "?행??,
    "?한?사", "?명?사", "?자?사", "?한책임?사", "?호", "?호?,
    
    # ?동?
    "근로계약", "?금", "근로?간", "?게?간", "?일", "?차?급??", "?고",
    "?직?, "?업?해", "?업?전", "?동조합", "?체교섭", "?업", "?견근로",
    "근로??, "?용??, "근로조건", "근로기?", "근로기??, "근로기?법위?,
    
    # 지?재?권?
    "?허", "?용?안", "?자??, "?표", "??권", "?업비?", "부?경??,
    "?이?스", "기술?전", "발명", "창작?, "??인?권",
    "?허?, "?용?안?, "?자?권", "?표?, "??권", "?업비??,
    
    # ?비?법
    "?비??, "계약", "??", "?시광고", "??거래", "방문?매", "?단계판?,
    "?신?매", "?자?거??, "개인?보", "?보공개", "?비?분??,
    "?비?기본법", "?비?기본법?반", "?비?기본법?반?,
    
    # ?경?
    "?경", "??, "?질", "?양", "?음", "진동", "?취", "?기?,
    "?경?향??", "?경?염", "?태?, "?연?경", "기후변??,
    "?경?책", "?경?책기본?, "?경?책기본법위?,
    
    # 금융?
    "금융", "???, "보험", "증권", "?본?장", "금융?자", "?용?보",
    "금융감독", "금융거래", "금융기?", "금융?품", "금융?자?법",
    
    # ?보?신?
    "?보?신", "?자거래", "개인?보", "?보보호", "?이버보??, "?이??,
    "?터??, "모바??, "?라?드", "빅데?터", "?공지??, "개인?보보호?
]

# ?선?위 ?워??(중요????
PRIORITY_KEYWORDS = [
    # 1?위: ?심 ?정??워??(100?
    "?정처분", "??", "??", "?고", "?청", "?의?청", "?정?판", "?정?송",
    
    # 2?위: 주요 민사??워??(80?
    "계약", "?해배상", "불법?위", "?유?, "?유?, "채권", "채무", "?행",
    
    # 3?위: ?사??워??(60?
    "?기", "?도", "강도", "교통?고", "?주?전", "?도?, "강도?, "?기?,
    
    # 4?위: ?사??워??(50?
    "?사", "주식", "주주", "?사", "?병", "?한?사", "?명?사", "?호",
    
    # 5?위: ?동??워??(40?
    "근로계약", "?금", "?고", "?직?, "?업?해", "근로??, "?용??, "근로조건",
    
    # 6?위: 지?재?권??워??(30?
    "?허", "??권", "?표", "?업비?", "부?경??, "?허?, "?용?안?, "?자?권",
    
    # 7?위: ?비?법 ?워??(25?
    "?비??, "??", "?시광고", "??거래", "?자?거??, "?비?기본법", "개인?보", "?보공개",
    
    # 8?위: ?경??워??(20?
    "?경", "??, "?질", "?기?, "?경?향??", "?경?책", "?경?염", "?태?,
    
    # 9?위: 금융??워??(15?
    "금융", "???, "보험", "증권", "?본?장", "금융?자", "?용?보", "금융감독",
    
    # 10?위: ?보?신??워??(15?
    "?보?신", "?자거래", "개인?보", "?보보호", "?이버보??, "?이??, "?터??, "모바??
]

# ?워?별 ?집 목표 건수 (?선?위???라 차등)
KEYWORD_TARGET_COUNTS = {
    # 1?위: 100?(?심 ?정?
    "?정처분": 100, "??": 100, "??": 100, "?고": 100, "?청": 100,
    "?의?청": 100, "?정?판": 100, "?정?송": 100,
    
    # 2?위: 80?(주요 민사?
    "계약": 80, "?해배상": 80, "불법?위": 80, "?유?: 80, "?유?: 80,
    "채권": 80, "채무": 80, "?행": 80,
    
    # 3?위: 60?(?사?
    "?기": 60, "?도": 60, "강도": 60, "교통?고": 60, "?주?전": 60,
    "?도?: 60, "강도?: 60, "?기?: 60,
    
    # 4?위: 50?(?사?
    "?사": 50, "주식": 50, "주주": 50, "?사": 50, "?병": 50,
    "?한?사": 50, "?명?사": 50, "?호": 50,
    
    # 5?위: 40?(?동?
    "근로계약": 40, "?금": 40, "?고": 40, "?직?: 40, "?업?해": 40,
    "근로??: 40, "?용??: 40, "근로조건": 40,
    
    # 6?위: 30?(지?재?권?
    "?허": 30, "??권": 30, "?표": 30, "?업비?": 30, "부?경??: 30,
    "?허?: 30, "?용?안?: 30, "?자?권": 30,
    
    # 7?위: 25?(?비?법)
    "?비??: 25, "??": 25, "?시광고": 25, "??거래": 25, "?자?거??: 25,
    "?비?기본법": 25, "개인?보": 25, "?보공개": 25,
    
    # 8?위: 20?(?경?
    "?경": 20, "??: 20, "?질": 20, "?기?: 20, "?경?향??": 20,
    "?경?책": 20, "?경?염": 20, "?태?: 20,
    
    # 9?위: 15?(금융?
    "금융": 15, "???: 15, "보험": 15, "증권": 15, "?본?장": 15,
    "금융?자": 15, "?용?보": 15, "금융감독": 15,
    
    # 10?위: 15?(?보?신?
    "?보?신": 15, "?자거래": 15, "개인?보": 15, "?보보호": 15,
    "?이버보??: 15, "?이??: 15, "?터??: 15, "모바??: 15
}

# 기본 ?워?당 ?집 건수 (?선?위 ?워?? ?닌 경우)
DEFAULT_KEYWORD_COUNT = 20

# 중앙부처별 ?워??
MINISTRY_KEYWORDS = {
    "기획?정부": ["?산", "?금", "?", "?정", "경제?책", "물?", "금융?책"],
    "교육부": ["교육", "?교", "?생", "교사", "???, "?구", "?술"],
    "과학기술?보?신부": ["과학", "기술", "?보?신", "?구개발", "?신", "????],
    "?교부": ["?교", "?", "?국??, "비자", "?권", "?사"],
    "?일부": ["?일", "북한", "?북", "??, "?화"],
    "법무부": ["법무", "검?, "교정", "출입?, "법무?정"],
    "?부": ["?", "군사", "병역", "군인", "??책"],
    "?정?전부": ["?정", "?전", "지방자?, "공무??, "?정?도"],
    "문화체육관광?": ["문화", "체육", "관?, "?술", "?포?, "콘텐?],
    "?림축산?품부": ["?업", "축산", "?품", "?촌", "?량", "?정"],
    "?업?상?원부": ["?업", "?상", "?원", "?너지", "무역", "?자"],
    "보건복?부": ["보건", "복?", "?료", "건강", "?회보장", "?인"],
    "?경부": ["?경", "??, "?질", "?기?, "?태", "기후"],
    "고용?동부": ["고용", "?동", "근로", "직업", "?업?전", "?사관?],
    "?성가족?": ["?성", "가?, "?동", "???, "?평??, "가족정?],
    "?교통부": ["?", "교통", "건설", "?시", "주택", "물류"],
    "?양?산부": ["?양", "?산", "?업", "??", "?운", "?양?책"],
    "중소벤처기업부": ["중소기업", "벤처", "창업", "기업지??, "?상공인"],
    "공정거래?원??: ["공정거래", "?점", "경쟁", "불공?거??, "?비?보??],
    "금융감독??: ["금융감독", "금융기?", "금융?품", "금융거래", "금융?책"]
}

# ?석 주제?분류 ?워??
INTERPRETATION_TOPIC_KEYWORDS = {
    "?정?: ["?정처분", "??", "??", "?고", "?정?판", "?정?송"],
    "민사?: ["계약", "?해배상", "?유?, "물권", "채권", "?속"],
    "?사?: ["?도", "강도", "?기", "?인", "?해", "교통?고"],
    "?사?: ["?사", "주식", "?음", "?표", "보험", "?행??],
    "?동?: ["근로계약", "?금", "?고", "?동조합", "?업?해"],
    "지?재?권?: ["?허", "??권", "?표", "?업비?", "부?경??],
    "?비?법": ["?비??, "계약", "??", "?시광고", "??거래"],
    "?경?: ["?경", "??, "?질", "?기?, "?경?향??"],
    "금융?: ["금융", "???, "보험", "증권", "?본?장"],
    "?보?신?: ["?보?신", "?자거래", "개인?보", "?이버보??]
}

# 백업 ?워??(?집??부족할 ???용)
FALLBACK_KEYWORDS = [
    # ?반?인 법률 ?어
    "법원", "법원??, "?사", "검??, "변?사", "법무??, "공증??,
    "법정", "법정공개", "법정비공?, "?판", "?리", "변?, "증인",
    "증거", "증거조사", "증거보전", "증거개시", "증거?청", "증거채택",
    "증거배제", "증거?력", "증명??, "?백", "진술", "진술거??,
    
    # ?송 관???어
    "?송", "?송?, "?송?건", "?송?력", "?송?위", "?송?위?력",
    "?송??, "?송?리권", "?송?리인", "?송?리인?임", "?송?리인?임?,
    "?송비용", "?송비용부??, "?송비용?계", "?송비용?정", "?송비용집행",
    
    # ?결 관???어
    "?결", "?결??, "?결?본", "?결?본", "?결초본", "?결?정",
    "?결?정??, "?결기판??, "?결집행??, "?결집행", "?결집행명령",
    
    # ??/?고 관??
    "??", "????, "???유??, "???유", "??기간", "???기",
    "?고", "?고??, "?고?유??, "?고?유", "?고기간", "?고?기",
    
    # 집행 관??
    "집행", "집행?, "집행문???, "집행문??신?, "집행문??신?",
    "강제집행", "강제집행?청", "강제집행?청?, "강제집행?청권자",
    
    # 가?류/가처분
    "가?류", "가?류?청", "가?류?청?, "가?류?청권자", "가?류?청??,
    "가처분", "가처분?청", "가처분?청?, "가처분?청권자", "가처분?청??,
    
    # 보전처분
    "보전처분", "보전처분?청", "보전처분?청?, "보전처분?청권자", "보전처분?청??,
    
    # 기? 법률 ?어
    "법령", "법규", "법규명령", "법규명령?반", "법규명령?반?,
    "법규명령?반죄처?, "법규명령?반죄처벌법", "법규명령?반죄처벌법?반"
]
