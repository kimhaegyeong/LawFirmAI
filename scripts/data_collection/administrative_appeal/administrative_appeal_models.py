#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
?정?판례 ?집 관???이??모델 ?의
"""

from dataclasses import dataclass, field
from datetime import datetime, timedelta
from enum import Enum
from typing import Dict, Any, Optional


class CollectionStatus(Enum):
    """?집 ?태 ?거??""
    PENDING = "pending"
    IN_PROGRESS = "in_progress"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"


class AppealType(Enum):
    """?정?판 ?형 ?거??""
    PERMIT_APPROVAL = "????"
    DISPOSITION_CANCELLATION = "처분취소"
    IMPOSITION_DISPOSITION = "부과처?
    DISCIPLINARY_DISPOSITION = "징계처분"
    TAX_DISPOSITION = "?무처분"
    CONSTRUCTION_DISPOSITION = "건축처분"
    ENVIRONMENTAL_DISPOSITION = "?경처분"
    URBAN_PLANNING = "?시계획"
    TRAFFIC_DISPOSITION = "교통처분"
    HEALTH_WELFARE = "보건복?"
    EDUCATION_DISPOSITION = "교육처분"
    LABOR_DISPOSITION = "?동처분"
    FINANCE_DISPOSITION = "금융처분"
    OTHER = "기?"


@dataclass
class CollectionStats:
    """?집 ?계 ?이???래??""
    start_time: datetime = field(default_factory=datetime.now)
    end_time: Optional[datetime] = None
    target_count: int = 1000
    collected_count: int = 0
    saved_count: int = 0
    duplicate_count: int = 0
    failed_count: int = 0
    keywords_processed: int = 0
    total_keywords: int = 0
    api_requests_made: int = 0
    api_errors: int = 0
    status: CollectionStatus = CollectionStatus.PENDING
    
    @property
    def success_rate(self) -> float:
        """?공?계산"""
        total_attempts = self.collected_count + self.duplicate_count + self.failed_count
        return (self.collected_count / total_attempts * 100) if total_attempts > 0 else 0.0
    
    @property
    def duration(self) -> Optional[timedelta]:
        """?집 ?요 ?간"""
        if self.end_time:
            return self.end_time - self.start_time
        return None


@dataclass
class AdministrativeAppealData:
    """?정?판례 ?이???래??""
    appeal_id: str
    case_name: str
    case_number: str
    appeal_type: AppealType
    decision_date: str
    raw_data: Dict[str, Any]
    collected_at: datetime = field(default_factory=datetime.now)
    
    def __post_init__(self):
        """?이??검?""
        if not self.appeal_id:
            raise ValueError("?정?판례 ID???수?니??)
        if not self.case_name:
            raise ValueError("?건명? ?수?니??)
    
    @property
    def hash_id(self) -> str:
        """?정?판례 ?이?의 ?시 ID ?성"""
        import hashlib
        content = f"{self.appeal_id}_{self.case_name}_{self.case_number}"
        return hashlib.md5(content.encode('utf-8')).hexdigest()


# ?정?판 관??검???워??(?선?위?
ADMINISTRATIVE_APPEAL_KEYWORDS = [
    # ?정처분 관??(최우??
    "?정처분", "??", "??", "?고", "?청", "?의?청", "취소처분", "??처분",
    "과태?, "과징?, "부과처?, "징계처분", "면허취소", "??취소",
    
    # ? 관??
    "?", "지방세", "?무조사", "가?세", "가?금", "체납처분", "?류처분",
    "?무??, "??, "지방세?, "?무조정", "?무?사",
    
    # 건축 관??
    "건축??", "건축?고", "건축?, "건축?, "건축계획", "건축?의",
    "?도변?, "증축", "개축", "?건?, "철거명령",
    
    # ?경 관??
    "?경?향??", "?경?염", "?기오??, "?질?염", "?음진동", "?취",
    "?기?, "?기물처?, "?경?향????, "?경?향???의",
    
    # ?시계획 관??
    "?시계획", "?시계획?설", "?시계획?업", "?시계획변?, "?시계획결정",
    "개발?위??", "개발?위?고", "개발?한구역", "?시계획구역",
    
    # 교통 관??
    "교통", "교통?향??", "교통계획", "교통?설", "?로", "교량", "?널",
    "교통?고", "교통?반", "교통?리", "교통?호",
    
    # 보건복? 관??
    "보건", "복?", "?료", "?료기?", "?료기기", "?료??, "?료?,
    "?회보장", "???금", "건강보험", "?업?해보상보험",
    
    # 교육 관??
    "교육", "?교", "교육기?", "교육?, "교육과정", "교육?설", "교육?설기?",
    "?립?교", "?립?교?, "교육?, "교육?원??,
    
    # ?동 관??
    "?동", "고용", "근로", "근로기??, "?업?전보건?, "?업?해",
    "?동조합", "?체교섭", "?업", "?견근로", "기간?근?,
    
    # 금융 관??
    "금융", "금융감독", "금융기?", "금융?품", "금융거래", "금융?자",
    "???, "보험", "증권", "?본?장", "금융?자?법",
    
    # 부?산 관??
    "부?산", "부?산?기", "부?산?기?, "부?산?기법위?,
    "부?산?기법위반죄", "부?산?기법위반처?, "부?산?기법위반처벌법",
    
    # ?보?신 관??
    "?보?신", "?자거래", "개인?보", "?보보호", "?이버보??, "?이??,
    "?터??, "모바??, "?라?드", "빅데?터", "?공지??,
    
    # ?료 관??
    "?료", "?료?, "?료?고", "?료?고처리", "?료?고처리?,
    "?료?고처리법위?, "?료?고처리법위반죄", "?료?고처리법위반처?,
    
    # ?회보장 관??
    "?회보장", "?회보장?, "?회보장기본?, "?회보장기본법위?,
    "?회보장기본법위반죄", "?회보장기본법위반처?, "?회보장기본법위반처벌법"
]

# ?선?위 ?워??(중요????
PRIORITY_KEYWORDS = [
    # 1?위: ?심 ?정처분 ?워??(80?
    "?정처분", "??", "??", "?고", "?청", "?의?청", "취소처분", "??처분",
    
    # 2?위: 주요 ? ?워??(60?
    "?", "지방세", "?무조사", "가?세", "가?금", "체납처분", "?류처분", "?무??,
    
    # 3?위: 건축 관???워??(50?
    "건축??", "건축?고", "건축?, "건축?, "건축계획", "건축?의", "?도변?, "증축",
    
    # 4?위: ?경 관???워??(40?
    "?경?향??", "?경?염", "?기오??, "?질?염", "?음진동", "?취", "?기?, "?기물처?,
    
    # 5?위: ?시계획 ?워??(35?
    "?시계획", "?시계획?설", "?시계획?업", "?시계획변?, "?시계획결정", "개발?위??", "개발?위?고", "개발?한구역",
    
    # 6?위: 교통 ?워??(30?
    "교통", "교통?향??", "교통계획", "교통?설", "?로", "교량", "?널", "교통?고",
    
    # 7?위: 보건복? ?워??(25?
    "보건", "복?", "?료", "?료기?", "?료기기", "?료??, "?료?, "?회보장",
    
    # 8?위: 교육 ?워??(20?
    "교육", "?교", "교육기?", "교육?, "교육과정", "교육?설", "교육?설기?", "?립?교",
    
    # 9?위: ?동 ?워??(20?
    "?동", "고용", "근로", "근로기??, "?업?전보건?, "?업?해", "?동조합", "?체교섭",
    
    # 10?위: 금융 ?워??(15?
    "금융", "금융감독", "금융기?", "금융?품", "금융거래", "금융?자", "???, "보험"
]

# ?워?별 ?집 목표 건수 (?선?위???라 차등)
KEYWORD_TARGET_COUNTS = {
    # 1?위: 80?(?심 ?정처분)
    "?정처분": 80, "??": 80, "??": 80, "?고": 80, "?청": 80,
    "?의?청": 80, "취소처분": 80, "??처분": 80,
    
    # 2?위: 60?(주요 ?)
    "?": 60, "지방세": 60, "?무조사": 60, "가?세": 60, "가?금": 60,
    "체납처분": 60, "?류처분": 60, "?무??: 60,
    
    # 3?위: 50?(건축 관??
    "건축??": 50, "건축?고": 50, "건축?: 50, "건축?: 50, "건축계획": 50,
    "건축?의": 50, "?도변?: 50, "증축": 50,
    
    # 4?위: 40?(?경 관??
    "?경?향??": 40, "?경?염": 40, "?기오??: 40, "?질?염": 40,
    "?음진동": 40, "?취": 40, "?기?: 40, "?기물처?: 40,
    
    # 5?위: 35?(?시계획)
    "?시계획": 35, "?시계획?설": 35, "?시계획?업": 35, "?시계획변?: 35,
    "?시계획결정": 35, "개발?위??": 35, "개발?위?고": 35, "개발?한구역": 35,
    
    # 6?위: 30?(교통)
    "교통": 30, "교통?향??": 30, "교통계획": 30, "교통?설": 30,
    "?로": 30, "교량": 30, "?널": 30, "교통?고": 30,
    
    # 7?위: 25?(보건복?)
    "보건": 25, "복?": 25, "?료": 25, "?료기?": 25, "?료기기": 25,
    "?료??: 25, "?료?: 25, "?회보장": 25,
    
    # 8?위: 20?(교육)
    "교육": 20, "?교": 20, "교육기?": 20, "교육?: 20, "교육과정": 20,
    "교육?설": 20, "교육?설기?": 20, "?립?교": 20,
    
    # 9?위: 20?(?동)
    "?동": 20, "고용": 20, "근로": 20, "근로기??: 20, "?업?전보건?: 20,
    "?업?해": 20, "?동조합": 20, "?체교섭": 20,
    
    # 10?위: 15?(금융)
    "금융": 15, "금융감독": 15, "금융기?": 15, "금융?품": 15,
    "금융거래": 15, "금융?자": 15, "???: 15, "보험": 15
}

# 기본 ?워?당 ?집 건수 (?선?위 ?워?? ?닌 경우)
DEFAULT_KEYWORD_COUNT = 10

# ?판 ?형?분류 ?워??
APPEAL_TYPE_KEYWORDS = {
    "????": ["??", "??", "면허", "?록", "?고"],
    "처분취소": ["처분", "취소", "??", "철회", "무효"],
    "부과처?: ["부?, "과태?, "과징?, "가?세", "가?금"],
    "징계처분": ["징계", "?임", "?면", "?직", "감봉"],
    "?무처분": ["?", "지방세", "?무조사", "체납처분", "?류"],
    "건축처분": ["건축", "건축??", "건축?고", "?도변?, "철거명령"],
    "?경처분": ["?경", "?경?향??", "?경?염", "?기?, "?음진동"],
    "?시계획": ["?시계획", "개발?위", "개발?한구역", "?시계획?설"],
    "교통처분": ["교통", "교통?향??", "교통?고", "교통?반", "교통?리"],
    "보건복?": ["보건", "복?", "?료", "?회보장", "???금"],
    "교육처분": ["교육", "?교", "교육기?", "?립?교", "교육?],
    "?동처분": ["?동", "고용", "근로", "?업?해", "?동조합"],
    "금융처분": ["금융", "금융감독", "금융기?", "금융?품", "금융거래"]
}

# 백업 ?워??(?집??부족할 ???용)
FALLBACK_KEYWORDS = [
    # ?반?인 ?정 ?어
    "?정", "?정기?", "?정?, "?정?", "?정?관", "?정?관??,
    "?정?관?리자", "?정?관?리자권한", "?정?관?리자권한???,
    "?정?관?리자권한??자", "?정?관?리자권한??자권한",
    
    # ?정?차 관??
    "?정?차", "?정?차?, "?정?차법위?, "?정?차법위반죄",
    "?정?차법위반처?, "?정?차법위반처벌법", "?정?차법위반처벌법?반",
    
    # ?정규칙 관??
    "?정규칙", "?정규칙?, "?정규칙법위?, "?정규칙법위반죄",
    "?정규칙법위반처?, "?정규칙법위반처벌법", "?정규칙법위반처벌법?반",
    
    # ?정지??관??
    "?정지??, "?정지?법", "?정지?법?반", "?정지?법?반?,
    "?정지?법?반처벌", "?정지?법?반처벌?, "?정지?법?반처벌법위?,
    
    # ?정계획 관??
    "?정계획", "?정계획?, "?정계획법위?, "?정계획법위반죄",
    "?정계획법위반처?, "?정계획법위반처벌법", "?정계획법위반처벌법?반",
    
    # ?정계약 관??
    "?정계약", "?정계약?, "?정계약법위?, "?정계약법위반죄",
    "?정계약법위반처?, "?정계약법위반처벌법", "?정계약법위반처벌법?반",
    
    # ?정???해배상 관??
    "?정?손?배??, "?정?손?배?법", "?정?손?배?법?반", "?정?손?배?법?반?,
    "?정?손?배?법?반처벌", "?정?손?배?법?반처벌?, "?정?손?배?법?반처벌법위?,
    
    # ??배상 관??
    "??배상", "??배상?, "??배상법위?, "??배상법위반죄",
    "??배상법위반처?, "??배상법위반처벌법", "??배상법위반처벌법?반",
    
    # ?실보상 관??
    "?실보상", "?실보상?, "?실보상법위?, "?실보상법위반죄",
    "?실보상법위반처?, "?실보상법위반처벌법", "?실보상법위반처벌법?반",
    
    # ?정??강제집행 관??
    "?정?강?집??, "?정?강?집?법", "?정?강?집?법?반", "?정?강?집?법?반?,
    "?정?강?집?법?반처벌", "?정?강?집?법?반처벌?, "?정?강?집?법?반처벌법위?,
    
    # ?정?관??
    "?정?, "?정벌법", "?정벌법?반", "?정벌법?반?,
    "?정벌법?반처벌", "?정벌법?반처벌?, "?정벌법?반처벌법위?,
    
    # 과태?관??
    "과태?, "과태료법", "과태료법?반", "과태료법?반?,
    "과태료법?반처벌", "과태료법?반처벌?, "과태료법?반처벌법위?,
    
    # 과징?관??
    "과징?, "과징금법", "과징금법?반", "과징금법?반?,
    "과징금법?반처벌", "과징금법?반처벌?, "과징금법?반처벌법위?
]
