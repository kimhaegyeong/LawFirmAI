# -*- coding: utf-8 -*-
"""
?„ë©”?¸ë³„ ë²•ë¥  ?©ì–´ ?•ì¥ê¸?
ë²•ë¥  ë¶„ì•¼ë³„ë¡œ ì²´ê³„?ì¸ ?©ì–´ ?•ì¥???˜í–‰
"""

import json
import logging
from typing import Dict, List, Set
from pathlib import Path

logger = logging.getLogger(__name__)


class DomainTermExpander:
    """?„ë©”?¸ë³„ ë²•ë¥  ?©ì–´ ?•ì¥ê¸?""
    
    def __init__(self):
        """ì´ˆê¸°??""
        self.logger = logging.getLogger(__name__)
        
        # ?„ë©”?¸ë³„ ?©ì–´ ?¬ì „ ?•ì˜
        self.domain_terms = {
            "?•ì‚¬ë²?: {
                "ë²”ì£„? í˜•": [
                    "?´ì¸", "ê°•ë„", "?ˆë„", "?¬ê¸°", "?¡ë ¹", "ë°°ì„", "?Œë¬¼", 
                    "ê°•ê°„", "?±í­??, "?±ì¶”??, "ê°•ì œì¶”í–‰", "ê°•ì œ?±êµ",
                    "??–‰", "?í•´", "?‘ë°•", "ê°ê¸ˆ", "?½ì·¨? ì¸", "? ê´´",
                    "ë°©í™”", "?ˆë„", "ê°•ë„", "ê°•ë„?í•´", "ê°•ë„?´ì¸",
                    "êµí†µ?¬ê³ ", "?Œì£¼?´ì „", "ë¬´ë©´?ˆìš´??, "?¬ê³ ?„ë?ì¡°ì¹˜"
                ],
                "ì²˜ë²Œ?•íƒœ": [
                    "?•ë²Œ", "ë²Œê¸ˆ", "ì§•ì—­", "ê¸ˆê³ ", "ì§‘í–‰? ì˜ˆ", "? ê³ ? ì˜ˆ", 
                    "ë³´í˜¸ê´€ì°?, "?¬íšŒë´‰ì‚¬", "?˜ê°•ëª…ë ¹", "ê¸°ì†Œ? ì˜ˆ", "ê³µì†Œ? ì˜ˆ",
                    "?•ì˜ê°ê²½", "?•ì˜ë©´ì œ", "?•ì˜?•ì?", "?•ì˜?¤íš¨"
                ],
                "?Œì†¡?ˆì°¨": [
                    "ê¸°ì†Œ", "ê³µì†Œ", "ê³µì†Œ?œê¸°", "ê³µì†Œ??, "ê³µíŒ", "ì¦ê±°ì¡°ì‚¬", 
                    "? ê³ ", "??†Œ", "?ê³ ", "?¬ì‹¬", "ë¹„ìƒ?ê³ ", "?¹ë³„??³ ",
                    "êµ¬ì†", "êµ¬ì†?ì¥", "ì²´í¬", "ì²´í¬?ì¥", "?˜ì‚¬", "?˜ì‚¬ê¸°ê?"
                ],
                "ê´€?¨ì¸ë¬?: [
                    "?¼ê³ ??, "ê²€??, "ë³€?¸ì¸", "êµ?„ ë³€?¸ì¸", "ì¦ì¸", "?¼í•´??,
                    "ê³ ë°œ??, "ê³ ì†Œ??, "ì°¸ê³ ??, "ê°ì •??, "?µì—­??, "ë²ˆì—­??,
                    "?¬íŒ??, "?ì‚¬", "ë²•ì •ê²½ìœ„", "ë²•ì •?œê¸°"
                ]
            },
            "ë¯¼ì‚¬ë²?: {
                "ê³„ì•½ê´€ê³?: [
                    "ê³„ì•½", "ê³„ì•½??, "?½ì •", "?©ì˜", "ê³„ì•½ê´€ê³?, "ê³„ì•½ì²´ê²°",
                    "ê³„ì•½?´ì?", "ê³„ì•½?„ë°˜", "ê³„ì•½?´í–‰", "ê³„ì•½ê¸?, "?„ì•½ê¸?,
                    "ë§¤ë§¤ê³„ì•½", "?„ë?ì°¨ê³„??, "?„ê¸‰ê³„ì•½", "?„ì„ê³„ì•½", "ê³ ìš©ê³„ì•½"
                ],
                "?í•´ë°°ìƒ": [
                    "?í•´ë°°ìƒ", "ë°°ìƒ", "ë³´ìƒ", "?„ìë£?, "?•ì‹ ?ì†??, "?¬ì‚°?ì†??,
                    "?´ì—…?í•´", "ì¹˜ë£Œë¹?, "ê°„ë³‘ë¹?, "êµí†µë¹?, "?˜ë£Œë¹?, "?¥ë?ë¹?,
                    "ê³¼ì‹¤?ê³„", "ê³¼ì‹¤ë¹„ìœ¨", "ê³¼ì‹¤", "ê³ ì˜", "ê³¼ì‹¤?ê³„"
                ],
                "?Œìœ ê¶?: [
                    "?Œìœ ê¶?, "?ìœ ê¶?, "ì§€?ê¶Œ", "?„ì„¸ê¶?, "?€?¹ê¶Œ", "ì§ˆê¶Œ", "? ì¹˜ê¶?,
                    "?Œìœ ê¶Œì´??, "?Œìœ ê¶Œë³´ì¡?, "?Œìœ ê¶Œí™•??, "?ìœ ê¶Œí™•??, "?ìœ ê¶Œë³´ì¡?,
                    "?±ê¸°", "?±ê¸°ë¶€?±ë³¸", "?±ê¸°? ì²­", "?±ê¸°?´ì „", "?±ê¸°ë§ì†Œ"
                ],
                "?ì†": [
                    "?ì†", "?ì†??, "?¼ìƒ?ì¸", "? ì–¸", "? ë¥˜ë¶?, "?ì†?¬ê¸°", "?ì†?¹ì¸",
                    "?ì†?¬ì‚°", "?ì†ë¶?, "?ì†ë¶„í• ", "?ì†??, "?ì†?±ê¸°",
                    "? ì–¸??, "? ì–¸ì§‘í–‰", "? ì–¸ì§‘í–‰??, "? ì–¸ë¬´íš¨", "? ì–¸ì·¨ì†Œ"
                ]
            },
            "ê°€ì¡±ë²•": {
                "?¼ì¸ê´€ê³?: [
                    "?¼ì¸", "?´í˜¼", "?¼ì¸ë¬´íš¨", "?¼ì¸ì·¨ì†Œ", "ë³„ê±°", "?„ìë£?,
                    "?¼ì¸? ê³ ", "?¼ì¸? ê³ ??, "?¼ì¸? ê³ ?œë¥˜", "?¼ì¸? ê³ ?œë¥˜",
                    "?¬í˜¼", "?¬í˜¼ê¸ˆì?ê¸°ê°„", "?¼ì¸? ê³ ?œë¥˜", "?¼ì¸? ê³ ?œë¥˜"
                ],
                "ì¹œìê´€ê³?: [
                    "ì¹œìƒ??, "?‘ì", "ì¹œê¶Œ", "?‘ìœ¡ê¶?, "?‘ìœ¡ë¹?, "ë©´ì ‘êµì„­ê¶?,
                    "ì¹œìƒ?ê?ê³?, "?‘ìê´€ê³?, "ì¹œìƒ?ê?ê³?, "?‘ìê´€ê³?,
                    "ì¹œìƒ?ê?ê³?, "?‘ìê´€ê³?, "ì¹œìƒ?ê?ê³?, "?‘ìê´€ê³?
                ],
                "?¬ì‚°ê´€ê³?: [
                    "?¬ì‚°ë¶„í• ", "?¬ì‚°ë¶„ë°°", "ë¶€ë¶€?¬ì‚°", "?¹ë³„?¬ì‚°", "ê³µë™?¬ì‚°",
                    "?¬ì‚°ë¶„í• ì²?µ¬", "?¬ì‚°ë¶„í• ?Œì†¡", "?¬ì‚°ë¶„í• ?‘ì˜", "?¬ì‚°ë¶„í• ì¡°ì •"
                ]
            },
            "?ì‚¬ë²?: {
                "?Œì‚¬ë²?: [
                    "ì£¼ì‹?Œì‚¬", "? í•œ?Œì‚¬", "?©ëª…?Œì‚¬", "?©ì?Œì‚¬", "ì£¼ì£¼", "?´ì‚¬", "ê°ì‚¬",
                    "ì£¼ì‹", "ì£¼ì‹ë°œí–‰", "ì£¼ì‹?‘ë„", "ì£¼ì‹ë§¤ìˆ˜", "ì£¼ì‹ë§¤ë„",
                    "?ë³¸ê¸?, "?ë³¸ê¸ˆì¦??, "?ë³¸ê¸ˆê°??, "?ë³¸ê¸ˆê°??
                ],
                "?í–‰??: [
                    "?í–‰??, "?ì¸", "?í˜¸", "?ì—…?¥ë?", "?ì—…?±ê¸°", "?ì—…?¬ìš©??,
                    "?ì—…?¬ìš©??, "?ì—…?¬ìš©??, "?ì—…?¬ìš©??, "?ì—…?¬ìš©??
                ],
                "?´ìŒ?˜í‘œ": [
                    "?´ìŒ", "?˜í‘œ", "?´ìŒ? ì¸", "?´ìŒêµí™˜", "?´ìŒë³´ì¦", "?´ìŒë°°ì„œ",
                    "?´ìŒ? ì¸", "?´ìŒêµí™˜", "?´ìŒë³´ì¦", "?´ìŒë°°ì„œ"
                ]
            }
        }
        
        # ?©ì–´ ê´€ê³??•ì˜
        self.term_relationships = {
            "?™ì˜??: {},
            "ê´€?¨ìš©??: {},
            "?ìœ„ê°œë…": {},
            "?˜ìœ„ê°œë…": {},
            "?€ë¦½ê°œ??: {}
        }
    
    def expand_domain_terms(self, extracted_terms: Dict) -> Dict:
        """?„ë©”?¸ë³„ ?©ì–´ ?•ì¥"""
        self.logger.info("Starting domain term expansion")
        
        expanded_terms = {}
        
        for domain, categories in self.domain_terms.items():
            expanded_terms[domain] = {}
            
            for category, terms in categories.items():
                expanded_terms[domain][category] = terms
        
        # ì¶”ì¶œ???©ì–´?€ ?„ë©”???©ì–´ ?µí•©
        integrated_terms = self._integrate_extracted_and_domain_terms(
            extracted_terms, expanded_terms
        )
        
        return integrated_terms
    
    def _integrate_extracted_and_domain_terms(self, extracted_terms: Dict, domain_terms: Dict) -> Dict:
        """ì¶”ì¶œ???©ì–´?€ ?„ë©”???©ì–´ ?µí•©"""
        integrated = {}
        
        # ?„ë©”?¸ë³„ë¡??©ì–´ ?µí•©
        for domain, categories in domain_terms.items():
            integrated[domain] = {}
            
            for category, terms in categories.items():
                # ê¸°ì¡´ ?©ì–´?€ ???©ì–´ ?µí•©
                existing_terms = extracted_terms.get(category, [])
                all_terms = list(set(existing_terms + terms))
                
                integrated[domain][category] = all_terms
        
        return integrated
    
    def build_term_relationships(self, terms: Dict) -> Dict:
        """?©ì–´ ê´€ê³?êµ¬ì¶•"""
        relationships = {
            "?™ì˜??: {},
            "ê´€?¨ìš©??: {},
            "?ìœ„ê°œë…": {},
            "?˜ìœ„ê°œë…": {},
            "?€ë¦½ê°œ??: {}
        }
        
        # ê¸°ë³¸ ê´€ê³??•ì˜
        relationships["?™ì˜??] = {
            "?í•´ë°°ìƒ": ["ë°°ìƒ", "ë³´ìƒ", "?¼í•´ë³´ìƒ"],
            "ê³„ì•½": ["ê³„ì•½??, "?½ì •", "?©ì˜"],
            "?´í˜¼": ["?¼ì¸?´ì†Œ", "?¼ì¸ë¬´íš¨", "ë³„ê±°"],
            "?Œì†¡": ["?Œì†¡?ˆì°¨", "?Œì†¡?œê¸°", "?Œì†¡ì§„í–‰"],
            "?•ë²Œ": ["ì²˜ë²Œ", "?œì¬", "ì²˜ë¶„"]
        }
        
        relationships["ê´€?¨ìš©??] = {
            "?í•´ë°°ìƒ": ["ë¶ˆë²•?‰ìœ„", "ì±„ë¬´ë¶ˆì´??, "ê³¼ì‹¤", "ê³ ì˜"],
            "ê³„ì•½": ["ê³„ì•½?´ì?", "ê³„ì•½?„ë°˜", "ê³„ì•½?´í–‰", "ê³„ì•½ê¸?],
            "?´í˜¼": ["?„ìë£?, "?¬ì‚°ë¶„í• ", "?‘ìœ¡ë¹?, "ë©´ì ‘êµì„­ê¶?],
            "?Œì†¡": ["?ê³ ", "?¼ê³ ", "?Œì¥", "?µë???, "ì¦ê±°"],
            "?•ë²Œ": ["ë²Œê¸ˆ", "ì§•ì—­", "ê¸ˆê³ ", "ì§‘í–‰? ì˜ˆ"]
        }
        
        relationships["?ìœ„ê°œë…"] = {
            "?í•´ë°°ìƒ": ["ë¯¼ì‚¬ì±…ì„", "ë¶ˆë²•?‰ìœ„ì±…ì„"],
            "ê³„ì•½": ["ë²•ë¥ ?‰ìœ„", "ì±„ê¶Œê´€ê³?],
            "?´í˜¼": ["?¼ì¸ê´€ê³?, "ê°€ì¡±ê?ê³?],
            "?Œì†¡": ["?Œì†¡?ˆì°¨", "?¬íŒ?ˆì°¨"],
            "?•ë²Œ": ["?•ì‚¬ì²˜ë²Œ", "?•ì‚¬?œì¬"]
        }
        
        relationships["?˜ìœ„ê°œë…"] = {
            "?í•´ë°°ìƒ": ["?¬ì‚°?ì†??, "?•ì‹ ?ì†??, "?„ìë£?],
            "ê³„ì•½": ["ë§¤ë§¤ê³„ì•½", "?„ë?ì°¨ê³„??, "?„ê¸‰ê³„ì•½"],
            "?´í˜¼": ["?‘ì˜?´í˜¼", "?¬íŒ?´í˜¼"],
            "?Œì†¡": ["ë¯¼ì‚¬?Œì†¡", "?•ì‚¬?Œì†¡", "?‰ì •?Œì†¡"],
            "?•ë²Œ": ["ë²Œê¸ˆ", "ì§•ì—­", "ê¸ˆê³ "]
        }
        
        relationships["?€ë¦½ê°œ??] = {
            "?í•´ë°°ìƒ": ["?•ë‹¹?‰ìœ„", "?ê¸°ë°©ì–´", "ê¸´ê¸‰?¼ë‚œ"],
            "ê³„ì•½": ["ë¬´íš¨", "ì·¨ì†Œ", "?´ì?"],
            "?´í˜¼": ["?¼ì¸", "?¬í˜¼"],
            "?Œì†¡": ["?”í•´", "ì¡°ì •", "ì¤‘ì¬"],
            "?•ë²Œ": ["ë¬´ì£„", "ê¸°ì†Œ? ì˜ˆ", "ê³µì†Œ? ì˜ˆ"]
        }
        
        return relationships
    
    def generate_enhanced_dictionary(self, extracted_terms: Dict, domain_terms: Dict) -> Dict:
        """?¥ìƒ???¬ì „ ?ì„±"""
        enhanced_dict = {}
        
        # ëª¨ë“  ?©ì–´ ?˜ì§‘
        all_terms = set()
        for pattern_terms in extracted_terms.values():
            all_terms.update(pattern_terms)
        
        for domain_categories in domain_terms.values():
            for category_terms in domain_categories.values():
                all_terms.update(category_terms)
        
        # ê°??©ì–´???€???•ë³´ ?ì„±
        for term in all_terms:
            enhanced_dict[term] = {
                "synonyms": self._get_synonyms(term),
                "related_terms": self._get_related_terms(term),
                "related_laws": self._get_related_laws(term),
                "precedent_keywords": self._get_precedent_keywords(term),
                "domain": self._get_domain(term, domain_terms),
                "category": self._get_category(term, domain_terms),
                "confidence": self._calculate_confidence(term, extracted_terms),
                "frequency": self._get_frequency(term, extracted_terms)
            }
        
        return enhanced_dict
    
    def _get_synonyms(self, term: str) -> List[str]:
        """?™ì˜??ë°˜í™˜"""
        synonym_map = {
            "?í•´ë°°ìƒ": ["ë°°ìƒ", "ë³´ìƒ", "?¼í•´ë³´ìƒ"],
            "ê³„ì•½": ["ê³„ì•½??, "?½ì •", "?©ì˜"],
            "?´í˜¼": ["?¼ì¸?´ì†Œ", "?¼ì¸ë¬´íš¨", "ë³„ê±°"],
            "?Œì†¡": ["?Œì†¡?ˆì°¨", "?Œì†¡?œê¸°", "?Œì†¡ì§„í–‰"],
            "?•ë²Œ": ["ì²˜ë²Œ", "?œì¬", "ì²˜ë¶„"],
            "ë²•ì›": ["ë²•ì •", "?¬íŒë¶€", "ë²•ì›?ê²°"],
            "ê²€??: ["ê²€ì°?, "ê²€ì°°ê?", "ê²€?¬ì¥"],
            "ë³€?¸ì‚¬": ["ë³€?¸ì¸", "ë²•ì •ë³€?¸ì¸", "êµ?„ ë³€?¸ì¸"],
            "?¼ê³ ??: ["?¼ê³ ", "?¼ì˜??, "?¼ê³ ??],
            "?ê³ ": ["?ê³ ??, "ì²?µ¬??, "? ì²­??],
            "?ê²°": ["? ê³ ", "?ì •", "?¬íŒ"],
            "?Œì¥": ["?Œì†¡??, "ì²?µ¬??, "? ì²­??],
            "?µë???: ["?µë?", "ë°˜ë°•??, "?´ì˜??],
            "ì¦ê±°": ["ì¦ëª…?ë£Œ", "ì¦ëª…?œë¥˜", "ì¦ëª…ë¬?],
            "ì§•ì—­": ["?•ë²Œ", "??, "ì²˜ë²Œ"],
            "ë²Œê¸ˆ": ["ê³¼íƒœë£?, "ê³¼ë£Œ", "ë²Œì¹™"],
            "ì§‘í–‰? ì˜ˆ": ["?•ì˜ì§‘í–‰? ì˜ˆ", "ì§‘í–‰?•ì?", "ì§‘í–‰ë©´ì œ"],
            "ë³´í˜¸ê´€ì°?: ["ë³´í˜¸ì²˜ë¶„", "ë³´í˜¸ì¡°ì¹˜", "ë³´í˜¸ëª…ë ¹"],
            "ê¸°ì†Œ": ["ê³µì†Œ", "ê³µì†Œ?œê¸°", "ê¸°ì†Œ?œê¸°"],
            "ê³µíŒ": ["ê³µíŒ??, "?¬íŒ??, "ë²•ì •"],
            "??†Œ": ["?ì†Œ", "??†Œ?œê¸°", "?ì†Œ?œê¸°"],
            "?ê³ ": ["ìµœì¢…?ì†Œ", "?ê³ ?œê¸°", "ìµœì¢…??†Œ"],
            "?¬ì‹¬": ["?¬ì‹¬ì²?µ¬", "?¬ì‹¬?œê¸°", "?¬ì‹¬? ì²­"],
            "êµ¬ì†": ["êµ¬ê¸ˆ", "êµ¬ì¹˜", "êµ¬ì†?ì¥"],
            "ì²´í¬": ["ì²´í¬?ì¥", "ê¸´ê¸‰ì²´í¬", "?„í–‰ë²”ì²´??],
            "?˜ì‚¬": ["?˜ì‚¬ê¸°ê?", "?˜ì‚¬?ˆì°¨", "?˜ì‚¬ì§„í–‰"],
            "ì¦ì¸": ["ì¦ì¸? ë¬¸", "ì¦ì¸ì¶œì„", "ì¦ì¸ë³´í˜¸"],
            "ê°ì •??: ["ê°ì •", "ê°ì •??, "ê°ì •?˜ê²¬"],
            "?µì—­??: ["?µì—­", "ë²ˆì—­", "ë²ˆì—­??],
            "?¬íŒ??: ["ì£¼ì‹¬?ì‚¬", "?¬íŒê´€", "?ì‚¬"],
            "?ì‚¬": ["ë²•ê?", "?¬íŒê´€", "ë²•ì •?ì‚¬"],
            "ë²•ì •ê²½ìœ„": ["ë²•ì •ë³´ì•ˆ", "ë²•ì •ì§ˆì„œ", "ë²•ì •ê²½ë¹„"],
            "ë²•ì •?œê¸°": ["ë²•ì •ê¸°ë¡", "ë²•ì •ê¸°ë¡??, "ë²•ì •?œê¸°ê´€"]
        }
        return synonym_map.get(term, [])
    
    def _get_related_terms(self, term: str) -> List[str]:
        """ê´€???©ì–´ ë°˜í™˜"""
        related_map = {
            "?í•´ë°°ìƒ": ["ë¶ˆë²•?‰ìœ„", "ì±„ë¬´ë¶ˆì´??, "ê³¼ì‹¤", "ê³ ì˜", "?¸ê³¼ê´€ê³?, "ì±…ì„?¥ë ¥"],
            "ê³„ì•½": ["ê³„ì•½?´ì?", "ê³„ì•½?„ë°˜", "ê³„ì•½?´í–‰", "ê³„ì•½ê¸?, "?„ì•½ê¸?, "?í•´ë°°ìƒ"],
            "?´í˜¼": ["?„ìë£?, "?¬ì‚°ë¶„í• ", "?‘ìœ¡ë¹?, "ë©´ì ‘êµì„­ê¶?, "?´í˜¼?¬ìœ ", "?¼ì¸ê´€ê³?],
            "?Œì†¡": ["?ê³ ", "?¼ê³ ", "?Œì¥", "?µë???, "ì¦ê±°", "?ê²°", "??†Œ", "?ê³ "],
            "?•ë²Œ": ["ë²Œê¸ˆ", "ì§•ì—­", "ê¸ˆê³ ", "ì§‘í–‰? ì˜ˆ", "? ê³ ? ì˜ˆ", "ë³´í˜¸ê´€ì°?],
            "ë²•ì›": ["?¬íŒë¶€", "ë²•ì •", "?ì‚¬", "?¬íŒ??, "ë²•ì •?œê¸°", "ë²•ì •ê²½ìœ„"],
            "ê²€??: ["ê²€ì°?, "ê²€ì°°ê?", "ê²€?¬ì¥", "?˜ì‚¬", "ê¸°ì†Œ", "ê³µì†Œ"],
            "ë³€?¸ì‚¬": ["ë³€?¸ì¸", "ë²•ì •ë³€?¸ì¸", "êµ?„ ë³€?¸ì¸", "ë³€??, "ë²•ì •ë³€??],
            "?¼ê³ ??: ["?¼ê³ ", "?¼ì˜??, "?¼ê³ ??, "?¼ê³ ?¸ê¶Œ", "?¼ê³ ?¸ë³´??],
            "?ê³ ": ["?ê³ ??, "ì²?µ¬??, "? ì²­??, "?ê³ ê¶?, "?ê³ ë³´í˜¸"],
            "?ê²°": ["? ê³ ", "?ì •", "?¬íŒ", "?ê²°??, "?ê²°ë¬?, "?ê²°?”ì?"],
            "?Œì¥": ["?Œì†¡??, "ì²?µ¬??, "? ì²­??, "?Œì¥?œì¶œ", "?Œì¥ê¸°ì¬"],
            "?µë???: ["?µë?", "ë°˜ë°•??, "?´ì˜??, "?µë??œì œì¶?, "?µë??œê¸°??],
            "ì¦ê±°": ["ì¦ëª…?ë£Œ", "ì¦ëª…?œë¥˜", "ì¦ëª…ë¬?, "ì¦ê±°ì¡°ì‚¬", "ì¦ê±°? ì²­"],
            "ì§•ì—­": ["?•ë²Œ", "??, "ì²˜ë²Œ", "?•ì˜ì§‘í–‰", "?•ì˜?¤íš¨"],
            "ë²Œê¸ˆ": ["ê³¼íƒœë£?, "ê³¼ë£Œ", "ë²Œì¹™", "ë²Œê¸ˆ?©ë?", "ë²Œê¸ˆì§‘í–‰"],
            "ì§‘í–‰? ì˜ˆ": ["?•ì˜ì§‘í–‰? ì˜ˆ", "ì§‘í–‰?•ì?", "ì§‘í–‰ë©´ì œ", "ì§‘í–‰? ì˜ˆê¸°ê°„"],
            "ë³´í˜¸ê´€ì°?: ["ë³´í˜¸ì²˜ë¶„", "ë³´í˜¸ì¡°ì¹˜", "ë³´í˜¸ëª…ë ¹", "ë³´í˜¸ê´€ì°°ê¸°ê°?],
            "ê¸°ì†Œ": ["ê³µì†Œ", "ê³µì†Œ?œê¸°", "ê¸°ì†Œ?œê¸°", "ê¸°ì†Œ? ì˜ˆ", "ê³µì†Œ? ì˜ˆ"],
            "ê³µíŒ": ["ê³µíŒ??, "?¬íŒ??, "ë²•ì •", "ê³µíŒ?ˆì°¨", "ê³µíŒì§„í–‰"],
            "??†Œ": ["?ì†Œ", "??†Œ?œê¸°", "?ì†Œ?œê¸°", "??†Œê¸°ê°„", "??†Œ?´ìœ "],
            "?ê³ ": ["ìµœì¢…?ì†Œ", "?ê³ ?œê¸°", "ìµœì¢…??†Œ", "?ê³ ê¸°ê°„", "?ê³ ?´ìœ "],
            "?¬ì‹¬": ["?¬ì‹¬ì²?µ¬", "?¬ì‹¬?œê¸°", "?¬ì‹¬? ì²­", "?¬ì‹¬?¬ìœ ", "?¬ì‹¬?ˆì°¨"],
            "êµ¬ì†": ["êµ¬ê¸ˆ", "êµ¬ì¹˜", "êµ¬ì†?ì¥", "êµ¬ì†ê¸°ê°„", "êµ¬ì†?´ì œ"],
            "ì²´í¬": ["ì²´í¬?ì¥", "ê¸´ê¸‰ì²´í¬", "?„í–‰ë²”ì²´??, "ì²´í¬ê¸°ê°„", "ì²´í¬?´ì œ"],
            "?˜ì‚¬": ["?˜ì‚¬ê¸°ê?", "?˜ì‚¬?ˆì°¨", "?˜ì‚¬ì§„í–‰", "?˜ì‚¬ê¸°ê°„", "?˜ì‚¬ì¢…ë£Œ"],
            "ì¦ì¸": ["ì¦ì¸? ë¬¸", "ì¦ì¸ì¶œì„", "ì¦ì¸ë³´í˜¸", "ì¦ì¸? ì„œ", "ì¦ì¸ê±°ë?"],
            "ê°ì •??: ["ê°ì •", "ê°ì •??, "ê°ì •?˜ê²¬", "ê°ì •? ì²­", "ê°ì •ë¹„ìš©"],
            "?µì—­??: ["?µì—­", "ë²ˆì—­", "ë²ˆì—­??, "?µì—­? ì²­", "?µì—­ë¹„ìš©"],
            "?¬íŒ??: ["ì£¼ì‹¬?ì‚¬", "?¬íŒê´€", "?ì‚¬", "?¬íŒ?¥ê¶Œ??, "?¬íŒ?¥ì???],
            "?ì‚¬": ["ë²•ê?", "?¬íŒê´€", "ë²•ì •?ì‚¬", "?ì‚¬?„ëª…", "?ì‚¬ë³´ìˆ˜"],
            "ë²•ì •ê²½ìœ„": ["ë²•ì •ë³´ì•ˆ", "ë²•ì •ì§ˆì„œ", "ë²•ì •ê²½ë¹„", "ë²•ì •ê²½ìœ„?…ë¬´"],
            "ë²•ì •?œê¸°": ["ë²•ì •ê¸°ë¡", "ë²•ì •ê¸°ë¡??, "ë²•ì •?œê¸°ê´€", "ë²•ì •?œê¸°?…ë¬´"]
        }
        return related_map.get(term, [])
    
    def _get_related_laws(self, term: str) -> List[str]:
        """ê´€??ë²•ë¥  ë°˜í™˜"""
        law_map = {
            "?í•´ë°°ìƒ": ["ë¯¼ë²• ??50ì¡?, "ë¯¼ë²• ??51ì¡?, "ë¯¼ë²• ??93ì¡?, "ë¯¼ë²• ??63ì¡?],
            "ê³„ì•½": ["ë¯¼ë²• ??05ì¡?, "ë¯¼ë²• ??43ì¡?, "ë¯¼ë²• ??44ì¡?, "ë¯¼ë²• ??45ì¡?],
            "?´í˜¼": ["ë¯¼ë²• ??40ì¡?, "ë¯¼ë²• ??41ì¡?, "ë¯¼ë²• ??42ì¡?, "ë¯¼ë²• ??43ì¡?],
            "?Œì†¡": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?‰ì •?Œì†¡ë²?, "ë¯¼ì‚¬ì§‘í–‰ë²?],
            "?•ë²Œ": ["?•ë²•", "?•ì‚¬?Œì†¡ë²?, "?•ì˜ì§‘í–‰ë²?, "ë³´í˜¸ê´€ì°°ë²•"],
            "ë²•ì›": ["ë²•ì›ì¡°ì§ë²?, "ë²•ì›?‰ì •ì²˜ë²•", "ë²•ì›ê³µë¬´?ë²•"],
            "ê²€??: ["ê²€ì°°ì²­ë²?, "ê²€?¬ë²•", "ê²€ì°°ì²­ë²•ì‹œ?‰ë ¹"],
            "ë³€?¸ì‚¬": ["ë³€?¸ì‚¬ë²?, "ë²•ë¬´?¬ë²•", "ë²•ì •ë³€?¸ì¸ë²?],
            "?¼ê³ ??: ["?•ì‚¬?Œì†¡ë²?, "?¼ê³ ?¸ê¶Œë¦¬ë³´?¥ë²•", "êµ?„ ë³€?¸ì¸ë²?],
            "?ê³ ": ["ë¯¼ì‚¬?Œì†¡ë²?, "?‰ì •?Œì†¡ë²?, "?¹í—ˆë²?],
            "?ê²°": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?‰ì •?Œì†¡ë²?],
            "?Œì¥": ["ë¯¼ì‚¬?Œì†¡ë²?, "ë¯¼ì‚¬?Œì†¡ê·œì¹™", "?Œì†¡ì´‰ì§„ë²?],
            "?µë???: ["ë¯¼ì‚¬?Œì†¡ë²?, "ë¯¼ì‚¬?Œì†¡ê·œì¹™", "?Œì†¡ì´‰ì§„ë²?],
            "ì¦ê±°": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "ì¦ê±°ë²?],
            "ì§•ì—­": ["?•ë²•", "?•ì˜ì§‘í–‰ë²?, "?•ì˜ì§‘í–‰ê·œì¹™"],
            "ë²Œê¸ˆ": ["?•ë²•", "?•ì˜ì§‘í–‰ë²?, "?•ì˜ì§‘í–‰ê·œì¹™"],
            "ì§‘í–‰? ì˜ˆ": ["?•ë²•", "?•ì˜ì§‘í–‰ë²?, "?•ì˜ì§‘í–‰ê·œì¹™"],
            "ë³´í˜¸ê´€ì°?: ["ë³´í˜¸ê´€ì°°ë²•", "?Œë…„ë²?, "?•ì˜ì§‘í–‰ë²?],
            "ê¸°ì†Œ": ["?•ì‚¬?Œì†¡ë²?, "ê²€ì°°ì²­ë²?, "ê¸°ì†Œ?¸ì˜ì£¼ì˜"],
            "ê³µíŒ": ["?•ì‚¬?Œì†¡ë²?, "ë¯¼ì‚¬?Œì†¡ë²?, "ê³µíŒ?ˆì°¨ê·œì¹™"],
            "??†Œ": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?‰ì •?Œì†¡ë²?],
            "?ê³ ": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?‰ì •?Œì†¡ë²?],
            "?¬ì‹¬": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?¬ì‹¬ë²?],
            "êµ¬ì†": ["?•ì‚¬?Œì†¡ë²?, "êµ¬ì†?ì¥ë²?, "êµ¬ì†ê¸°ê°„ë²?],
            "ì²´í¬": ["?•ì‚¬?Œì†¡ë²?, "ì²´í¬?ì¥ë²?, "ê¸´ê¸‰ì²´í¬ë²?],
            "?˜ì‚¬": ["?•ì‚¬?Œì†¡ë²?, "?˜ì‚¬ë²?, "?˜ì‚¬ê¸°ê?ë²?],
            "ì¦ì¸": ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "ì¦ì¸ë³´í˜¸ë²?],
            "ê°ì •??: ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "ê°ì •ë²?],
            "?µì—­??: ["ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?, "?µì—­ë²?],
            "?¬íŒ??: ["ë²•ì›ì¡°ì§ë²?, "ë¯¼ì‚¬?Œì†¡ë²?, "?•ì‚¬?Œì†¡ë²?],
            "?ì‚¬": ["ë²•ì›ì¡°ì§ë²?, "?ì‚¬ë²?, "ë²•ê?ë²?],
            "ë²•ì •ê²½ìœ„": ["ë²•ì›ì¡°ì§ë²?, "ë²•ì •ê²½ìœ„ë²?, "ë²•ì›ê³µë¬´?ë²•"],
            "ë²•ì •?œê¸°": ["ë²•ì›ì¡°ì§ë²?, "ë²•ì •?œê¸°ë²?, "ë²•ì›ê³µë¬´?ë²•"]
        }
        return law_map.get(term, [])
    
    def _get_precedent_keywords(self, term: str) -> List[str]:
        """?ë? ?¤ì›Œ??ë°˜í™˜"""
        precedent_map = {
            "?í•´ë°°ìƒ": ["?í•´ë°°ìƒì²?µ¬ê¶?, "ë°°ìƒì±…ì„", "?í•´ë°°ìƒ?Œì†¡", "ë°°ìƒ?¡ì‚°??],
            "ê³„ì•½": ["ê³„ì•½?´ì?ê¶?, "ê³„ì•½?„ë°˜", "ê³„ì•½?´í–‰ì²?µ¬", "ê³„ì•½ê¸ˆë°˜??],
            "?´í˜¼": ["?´í˜¼?¬ìœ ", "?„ìë£Œì²­êµ?, "?¬ì‚°ë¶„í• ì²?µ¬", "?‘ìœ¡ë¹„ì?ê¸?],
            "?Œì†¡": ["?Œì†¡?œê¸°", "?Œì†¡ë¹„ìš©", "?Œì†¡?€ë¦?, "?Œì†¡ì§„í–‰"],
            "?•ë²Œ": ["?•ë²Œ? ê³ ", "?•ë²Œì§‘í–‰", "?•ë²Œë©´ì œ", "?•ë²Œê°ê²½"],
            "ë²•ì›": ["ë²•ì›?ê²°", "ë²•ì›ê²°ì •", "ë²•ì›ëª…ë ¹", "ë²•ì›ì²˜ë¶„"],
            "ê²€??: ["ê²€?¬ê¸°??, "ê²€?¬ìˆ˜??, "ê²€?¬ì²˜ë¶?, "ê²€?¬ëª…??],
            "ë³€?¸ì‚¬": ["ë³€?¸ì‚¬? ì„", "ë³€?¸ì‚¬ë³´ìˆ˜", "ë³€?¸ì‚¬?¤ë¦¬", "ë³€?¸ì‚¬ë²?],
            "?¼ê³ ??: ["?¼ê³ ?¸ê¶Œë¦?, "?¼ê³ ?¸ë³´??, "?¼ê³ ?¸ì§„??, "?¼ê³ ?¸ì¦??],
            "?ê³ ": ["?ê³ ê¶Œë¦¬", "?ê³ ë³´í˜¸", "?ê³ ì§„ìˆ ", "?ê³ ì¦ì–¸"],
            "?ê²°": ["?ê²°? ê³ ", "?ê²°ë¬?, "?ê²°?”ì?", "?ê²°?´ìœ "],
            "?Œì¥": ["?Œì¥?œì¶œ", "?Œì¥ê¸°ì¬", "?Œì¥?´ìš©", "?Œì¥?œì‹"],
            "?µë???: ["?µë??œì œì¶?, "?µë??œê¸°??, "?µë??œë‚´??, "?µë??œì„œ??],
            "ì¦ê±°": ["ì¦ê±°ì¡°ì‚¬", "ì¦ê±°? ì²­", "ì¦ê±°?œì¶œ", "ì¦ê±°?¥ë ¥"],
            "ì§•ì—­": ["ì§•ì—­? ê³ ", "ì§•ì—­ì§‘í–‰", "ì§•ì—­ë©´ì œ", "ì§•ì—­ê°ê²½"],
            "ë²Œê¸ˆ": ["ë²Œê¸ˆ? ê³ ", "ë²Œê¸ˆ?©ë?", "ë²Œê¸ˆì§‘í–‰", "ë²Œê¸ˆê°ê²½"],
            "ì§‘í–‰? ì˜ˆ": ["ì§‘í–‰? ì˜ˆ? ê³ ", "ì§‘í–‰? ì˜ˆê¸°ê°„", "ì§‘í–‰? ì˜ˆì·¨ì†Œ"],
            "ë³´í˜¸ê´€ì°?: ["ë³´í˜¸ê´€ì°°ì²˜ë¶?, "ë³´í˜¸ê´€ì°°ê¸°ê°?, "ë³´í˜¸ê´€ì°°ì·¨??],
            "ê¸°ì†Œ": ["ê¸°ì†Œ?œê¸°", "ê¸°ì†Œ? ì˜ˆ", "ê¸°ì†Œì²˜ë¶„", "ê¸°ì†Œëª…ë ¹"],
            "ê³µíŒ": ["ê³µíŒ?ˆì°¨", "ê³µíŒì§„í–‰", "ê³µíŒ??, "ê³µíŒê¸°ì¼"],
            "??†Œ": ["??†Œ?œê¸°", "??†Œê¸°ê°„", "??†Œ?´ìœ ", "??†Œ?¬ë¦¬"],
            "?ê³ ": ["?ê³ ?œê¸°", "?ê³ ê¸°ê°„", "?ê³ ?´ìœ ", "?ê³ ?¬ë¦¬"],
            "?¬ì‹¬": ["?¬ì‹¬ì²?µ¬", "?¬ì‹¬?¬ìœ ", "?¬ì‹¬?ˆì°¨", "?¬ì‹¬?¬ë¦¬"],
            "êµ¬ì†": ["êµ¬ì†?ì¥", "êµ¬ì†ê¸°ê°„", "êµ¬ì†?´ì œ", "êµ¬ì†?°ì¥"],
            "ì²´í¬": ["ì²´í¬?ì¥", "ì²´í¬ê¸°ê°„", "ì²´í¬?´ì œ", "ì²´í¬?°ì¥"],
            "?˜ì‚¬": ["?˜ì‚¬?ˆì°¨", "?˜ì‚¬ì§„í–‰", "?˜ì‚¬ê¸°ê°„", "?˜ì‚¬ì¢…ë£Œ"],
            "ì¦ì¸": ["ì¦ì¸? ë¬¸", "ì¦ì¸ì¶œì„", "ì¦ì¸ë³´í˜¸", "ì¦ì¸ê±°ë?"],
            "ê°ì •??: ["ê°ì •? ì²­", "ê°ì •?˜ê²¬", "ê°ì •ë¹„ìš©", "ê°ì •??],
            "?µì—­??: ["?µì—­? ì²­", "?µì—­ë¹„ìš©", "?µì—­??, "?µì—­?˜ê²¬"],
            "?¬íŒ??: ["?¬íŒ?¥ê¶Œ??, "?¬íŒ?¥ì???, "?¬íŒ?¥ê²°??, "?¬íŒ?¥ëª…??],
            "?ì‚¬": ["?ì‚¬?„ëª…", "?ì‚¬ë³´ìˆ˜", "?ì‚¬?¤ë¦¬", "?ì‚¬ë²?],
            "ë²•ì •ê²½ìœ„": ["ë²•ì •ê²½ìœ„?…ë¬´", "ë²•ì •ê²½ìœ„ê¶Œí•œ", "ë²•ì •ê²½ìœ„ì§€??],
            "ë²•ì •?œê¸°": ["ë²•ì •?œê¸°?…ë¬´", "ë²•ì •?œê¸°ê¶Œí•œ", "ë²•ì •?œê¸°ì§€??]
        }
        return precedent_map.get(term, [])
    
    def _get_domain(self, term: str, domain_terms: Dict) -> str:
        """?©ì–´???„ë©”??ë°˜í™˜"""
        for domain, categories in domain_terms.items():
            for category, terms in categories.items():
                if term in terms:
                    return domain
        return "ê¸°í?"
    
    def _get_category(self, term: str, domain_terms: Dict) -> str:
        """?©ì–´??ì¹´í…Œê³ ë¦¬ ë°˜í™˜"""
        for domain, categories in domain_terms.items():
            for category, terms in categories.items():
                if term in terms:
                    return category
        return "ê¸°í?"
    
    def _calculate_confidence(self, term: str, extracted_terms: Dict) -> float:
        """?©ì–´ ? ë¢°??ê³„ì‚°"""
        # ê¸°ë³¸ ? ë¢°??
        confidence = 0.5
        
        # ì¶”ì¶œ???©ì–´??ê²½ìš° ? ë¢°??ì¦ê?
        for pattern_terms in extracted_terms.values():
            if term in pattern_terms:
                confidence += 0.3
                break
        
        # ê´€???•ë³´ê°€ ?ˆëŠ” ê²½ìš° ? ë¢°??ì¦ê?
        if self._get_synonyms(term):
            confidence += 0.1
        if self._get_related_laws(term):
            confidence += 0.1
        
        return min(confidence, 1.0)
    
    def _get_frequency(self, term: str, extracted_terms: Dict) -> int:
        """?©ì–´ ë¹ˆë„ ë°˜í™˜"""
        frequency = 0
        for pattern_terms in extracted_terms.values():
            frequency += pattern_terms.count(term)
        return frequency
    
    def save_enhanced_dictionary(self, enhanced_dict: Dict, output_path: str):
        """?¥ìƒ???¬ì „ ?€??""
        try:
            output_file = Path(output_path)
            output_file.parent.mkdir(parents=True, exist_ok=True)
            
            with open(output_file, 'w', encoding='utf-8') as f:
                json.dump(enhanced_dict, f, ensure_ascii=False, indent=2)
            
            self.logger.info(f"Enhanced dictionary saved to: {output_file}")
            
        except Exception as e:
            self.logger.error(f"Error saving enhanced dictionary: {e}")


def main():
    """ë©”ì¸ ?¤í–‰ ?¨ìˆ˜"""
    import argparse
    
    parser = argparse.ArgumentParser(description='?„ë©”?¸ë³„ ë²•ë¥  ?©ì–´ ?•ì¥ê¸?)
    parser.add_argument('--input_file', type=str, required=True,
                       help='ì¶”ì¶œ???©ì–´ ?Œì¼ ê²½ë¡œ')
    parser.add_argument('--output_file', type=str,
                       default='data/extracted_terms/domain_expanded_terms.json',
                       help='ì¶œë ¥ ?Œì¼ ê²½ë¡œ')
    parser.add_argument('--log_level', type=str, default='INFO',
                       choices=['DEBUG', 'INFO', 'WARNING', 'ERROR'],
                       help='ë¡œê·¸ ?ˆë²¨')
    
    args = parser.parse_args()
    
    # ë¡œê¹… ?¤ì •
    logging.basicConfig(
        level=getattr(logging, args.log_level),
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    # ?„ë©”???•ì¥ ?¤í–‰
    expander = DomainTermExpander()
    
    # ?…ë ¥ ?Œì¼ ë¡œë“œ
    with open(args.input_file, 'r', encoding='utf-8') as f:
        extracted_data = json.load(f)
    
    extracted_terms = extracted_data.get('filtered_terms', {})
    
    # ?„ë©”?¸ë³„ ?©ì–´ ?•ì¥
    domain_terms = expander.expand_domain_terms(extracted_terms)
    
    # ?¥ìƒ???¬ì „ ?ì„±
    enhanced_dict = expander.generate_enhanced_dictionary(extracted_terms, domain_terms)
    
    # ê²°ê³¼ ?€??
    expander.save_enhanced_dictionary(enhanced_dict, args.output_file)
    
    # ê²°ê³¼ ì¶œë ¥
    print("\n=== ?„ë©”?¸ë³„ ?©ì–´ ?•ì¥ ê²°ê³¼ ===")
    print(f"ì´??©ì–´ ?? {len(enhanced_dict)}")
    
    print("\n=== ?„ë©”?¸ë³„ ?©ì–´ ??===")
    domain_counts = {}
    for term, info in enhanced_dict.items():
        domain = info.get('domain', 'ê¸°í?')
        domain_counts[domain] = domain_counts.get(domain, 0) + 1
    
    for domain, count in domain_counts.items():
        print(f"{domain}: {count}ê°?)


if __name__ == "__main__":
    main()
