#!/usr/bin/env python3
"""
ë²•ì  ê·¼ê±° ?œì‹œ ?œìŠ¤??ì¢…í•© ?ŒìŠ¤??
"""

import json
import logging
import os
import sys
from datetime import datetime
from pathlib import Path
from typing import Any, Dict, List

# ?„ë¡œ?íŠ¸ ë£¨íŠ¸ ?”ë ‰? ë¦¬ë¥?Python ê²½ë¡œ??ì¶”ê?
project_root = Path(__file__).parent.parent.parent
sys.path.insert(0, str(project_root))

# ë¡œê¹… ?¤ì •
logging.basicConfig(level=logging.INFO, format='%(levelname)s:%(name)s:%(message)s')
logger = logging.getLogger(__name__)

# ?œë¹„???„í¬??
from source.services.answer_structure_enhancer import (
    AnswerStructureEnhancer,
    QuestionType,
)
from source.services.legal_basis_integration_service import LegalBasisIntegrationService
from source.services.legal_basis_validator import LegalBasisValidator
from source.services.legal_citation_enhancer import LegalCitationEnhancer


class LegalBasisSystemTester:
    """ë²•ì  ê·¼ê±° ?œì‹œ ?œìŠ¤???ŒìŠ¤??""

    def __init__(self):
        self.citation_enhancer = LegalCitationEnhancer()
        self.basis_validator = LegalBasisValidator()
        self.structure_enhancer = AnswerStructureEnhancer()
        self.integration_service = LegalBasisIntegrationService()

        # ?ŒìŠ¤???°ì´??
        self.test_cases = self._load_test_cases()

    def _load_test_cases(self) -> Dict[str, Any]:
        """?ŒìŠ¤??ì¼€?´ìŠ¤ ë¡œë“œ - ?•ì¥??ë²„ì „"""
        return {
            "law_inquiry": {
                "query": "ê³„ì•½ ?´ì? ???í•´ë°°ìƒ ë²”ìœ„???´ë–»ê²??˜ë‚˜??",
                "answer": """
                ê³„ì•½ ?´ì? ???í•´ë°°ìƒ ë²”ìœ„??ë¯¼ë²• ??43ì¡°ì? ??44ì¡°ì— ?°ë¼ ê²°ì •?©ë‹ˆ??

                ??43ì¡°ì— ?°ë¥´ë©? ê³„ì•½???´ì?ë¡??¸í•œ ?í•´ë°°ìƒ?€ ê³„ì•½ ?´í–‰?¼ë¡œ ?»ì„ ???ˆì—ˆ???´ìµ???ì‹¤???˜ë??©ë‹ˆ??
                ??44ì¡°ì—?œëŠ” ?´ì?ë¡??¸í•œ ?í•´ë°°ìƒ??ë²”ìœ„ë¥??œí•œ?˜ê³  ?ˆìŠµ?ˆë‹¤.

                ?€ë²•ì› 2023??2345 ?ë??ì„œ??ê³„ì•½ ?´ì? ???í•´ë°°ìƒ ë²”ìœ„ë¥?êµ¬ì²´?ìœ¼ë¡?ëª…ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??43ì¡?, "??44ì¡?, "2023??2345"]
            },
            "precedent_search": {
                "query": "ë¶€?™ì‚° ë§¤ë§¤ê³„ì•½?ì„œ ?˜ì?´ë³´ì±…ì„ ê´€???ë?ë¥?ì°¾ì•„ì£¼ì„¸??,
                "answer": """
                ë¶€?™ì‚° ë§¤ë§¤ê³„ì•½?ì„œ ?˜ì?´ë³´ì±…ì„ê³?ê´€?¨ëœ ì£¼ìš” ?ë????¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?€ë²•ì› 2022??6789 ?ë?: ë¶€?™ì‚°???˜ìë¡??¸í•œ ?í•´ë°°ìƒ ë²”ìœ„
                2. ?œìš¸ê³ ë“±ë²•ì› 2023??2345 ?ë?: ?˜ì ë°œê²¬ ??ê³„ì•½ ?´ì? ?”ê±´

                ë¯¼ë²• ??80ì¡°ì? ??81ì¡°ê? ?˜ì?´ë³´ì±…ì„??ë²•ì  ê·¼ê±°ê°€ ?©ë‹ˆ??
                """,
                "expected_citations": ["2022??6789", "2023??2345", "??80ì¡?, "??81ì¡?]
            },
            "legal_advice": {
                "query": "?„ê¸ˆ ì²´ë¶ˆ ???´ë–»ê²??€?‘í•´???˜ë‚˜??",
                "answer": """
                ?„ê¸ˆ ì²´ë¶ˆ ???¤ìŒê³?ê°™ì? ë°©ë²•?¼ë¡œ ?€?‘í•  ???ˆìŠµ?ˆë‹¤:

                1. ?¸ë™?„ì›?Œì— ì§„ì • ?œê¸° (ê·¼ë¡œê¸°ì?ë²???8ì¡?
                2. ë²•ì›???„ê¸ˆ ì§€ê¸?ëª…ë ¹ ? ì²­ (ë¯¼ì‚¬ì§‘í–‰ë²???26ì¡?
                3. ?•ì‚¬ê³ ë°œ (ê·¼ë¡œê¸°ì?ë²???09ì¡?

                ?€ë²•ì› 2021??8765 ?ë??ì„œ???„ê¸ˆ ì²´ë¶ˆ??ë²•ì  ?¨ê³¼ë¥?ëª…í™•???˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??8ì¡?, "??26ì¡?, "??09ì¡?, "2021??8765"]
            },
            "term_explanation": {
                "query": "?í•´ë°°ìƒ???˜ë?ë¥??¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?í•´ë°°ìƒ?€ ë¯¼ë²• ??50ì¡°ì— ?•ì˜??ê°œë…?¼ë¡œ, ë¶ˆë²•?‰ìœ„ë¡??¸í•œ ?í•´ë¥?ë°°ìƒ?˜ëŠ” ê²ƒì„ ?˜ë??©ë‹ˆ??

                ?í•´ë°°ìƒ???”ê±´:
                1. ë¶ˆë²•?‰ìœ„??ì¡´ì¬
                2. ?í•´??ë°œìƒ
                3. ?¸ê³¼ê´€ê³„ì˜ ì¡´ì¬
                4. ê³ ì˜ ?ëŠ” ê³¼ì‹¤

                ?€ë²•ì› 2020??4321 ?ë??ì„œ???í•´ë°°ìƒ??ë²”ìœ„ë¥?êµ¬ì²´?ìœ¼ë¡??¤ëª…?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??50ì¡?, "2020??4321"]
            },
            "contract_review": {
                "query": "??ê³„ì•½?œì˜ ë¶ˆë¦¬??ì¡°í•­?¤ì„ ê²€? í•´ì£¼ì„¸??,
                "answer": """
                ê³„ì•½??ê²€??ê²°ê³¼ ?¤ìŒê³?ê°™ì? ë¶ˆë¦¬??ì¡°í•­?¤ì´ ë°œê²¬?˜ì—ˆ?µë‹ˆ??

                1. ë¯¼ë²• ??04ì¡°ì— ?°ë¥¸ ë¶ˆê³µ?•í•œ ê³„ì•½ ì¡°í•­
                2. ?½ê???ê·œì œ??ê´€??ë²•ë¥  ??ì¡??„ë°˜ ê°€?¥ì„±
                3. ?€ë²•ì› 2019??3456 ?ë??ì„œ ? ì‚¬??ì¡°í•­??ë¬´íš¨ë¡??ë‹¨???¬ë?

                ?¹íˆ ??ì¡°ì˜ ?í•´ë°°ìƒ ?œí•œ ì¡°í•­?€ ë¯¼ë²• ??98ì¡°ì— ?„ë°°?????ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??04ì¡?, "??ì¡?, "2019??3456", "??98ì¡?]
            },
            "divorce_procedure": {
                "query": "?‘ì˜?´í˜¼ ?ˆì°¨ë¥??ˆë‚´?´ì£¼?¸ìš”",
                "answer": """
                ?‘ì˜?´í˜¼ ?ˆì°¨???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?‘ì˜?´í˜¼???‘ì„± (ê°€ì¡±ê?ê³„ì˜ ?±ë¡ ?±ì— ê´€??ë²•ë¥  ??0ì¡?
                2. ê°€?•ë²•?ì— ?‘ì˜?´í˜¼ ?•ì¸? ì²­ (ê°€?¬ì†Œ?¡ë²• ??ì¡?
                3. ?€ë²•ì› 2018??8901 ?ë????°ë¥¸ ?‘ì˜?´í˜¼ ?”ê±´ ?•ì¸

                ë¯¼ë²• ??36ì¡°ì—???‘ì˜?´í˜¼???”ê±´??ëª…ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??0ì¡?, "??ì¡?, "2018??8901", "??36ì¡?]
            },
            "inheritance_procedure": {
                "query": "?ì† ?¬ê¸° ?ˆì°¨???´ë–»ê²??˜ë‚˜??",
                "answer": """
                ?ì† ?¬ê¸° ?ˆì°¨???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?ì† ê°œì‹œ?¼ë¡œë¶€??3ê°œì›” ??? ì²­ (ë¯¼ë²• ??019ì¡?
                2. ê°€?•ë²•?ì— ?ì†?¬ê¸°? ê³ ???œì¶œ (ê°€?¬ì†Œ?¡ë²• ??2ì¡?
                3. ?€ë²•ì› 2017??5678 ?ë??ì„œ ?ì†?¬ê¸° ?”ê±´??ëª…í™•????

                ?ì†?¸ë²• ??5ì¡°ì— ?°ë¥¸ ?ì†??? ê³ ???„ìš”?©ë‹ˆ??
                """,
                "expected_citations": ["??019ì¡?, "??2ì¡?, "2017??5678", "??5ì¡?]
            },
            "criminal_case": {
                "query": "?¬ê¸°ì£„ì˜ êµ¬ì„±?”ê±´???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?¬ê¸°ì£„ì˜ êµ¬ì„±?”ê±´?€ ?•ë²• ??47ì¡°ì— ëª…ì‹œ?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ê¸°ë§?‰ìœ„ (?¬ëŒ??ê¸°ë§?˜ëŠ” ?‰ìœ„)
                2. ì°©ì˜¤? ë°œ (?ë?ë°©ìœ¼ë¡??˜ì—¬ê¸?ì°©ì˜¤??ë¹ ëœ¨ë¦¬ëŠ” ê²?
                3. ?¬ì‚°???´ìµ (?¬ì‚°???´ìµ??ì·¨ë“?˜ê±°?????ë¡œ ?˜ì—¬ê¸?ì·¨ë“?˜ê²Œ ?˜ëŠ” ê²?

                ?€ë²•ì› 2016??4567 ?ë??ì„œ ?¬ê¸°ì£„ì˜ ê¸°ë§?‰ìœ„ë¥?êµ¬ì²´?ìœ¼ë¡??´ì„?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??47ì¡?, "2016??4567"]
            },
            "labor_dispute": {
                "query": "ë¶€?¹í•´ê³?êµ¬ì œ?ˆì°¨ë¥??ˆë‚´?´ì£¼?¸ìš”",
                "answer": """
                ë¶€?¹í•´ê³?êµ¬ì œ?ˆì°¨???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?¸ë™?„ì›?Œì— ë¶€?¹í•´ê³?êµ¬ì œ? ì²­ (ê·¼ë¡œê¸°ì?ë²???8ì¡?
                2. êµ¬ì œ? ì²­???œì¶œ ??ì¡°ì •?ˆì°¨ ì§„í–‰
                3. ?€ë²•ì› 2015??3456 ?ë??ì„œ ë¶€?¹í•´ê³ ì˜ ?”ê±´??ëª…í™•????

                ê·¼ë¡œê¸°ì?ë²???3ì¡°ì—??ë¶€?¹í•´ê³ ë? ê¸ˆì??˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??8ì¡?, "2015??3456", "??3ì¡?]
            },
            "procedure_guide": {
                "query": "?Œì•¡?¬ê±´?¬íŒ?ˆì°¨???´ë–»ê²?ì§„í–‰?˜ë‚˜??",
                "answer": """
                ?Œì•¡?¬ê±´?¬íŒ?ˆì°¨???¤ìŒê³?ê°™ì´ ì§„í–‰?©ë‹ˆ??

                1. ?Œì•¡?¬ê±´?¬íŒë²???ì¡°ì— ?°ë¥¸ ?Œì•¡?¬ê±´??ë²”ìœ„ ?•ì¸
                2. ê´€? ë²•?ì— ?Œì¥ ?œì¶œ (ë¯¼ì‚¬?Œì†¡ë²???48ì¡?
                3. ?€ë²•ì› 2014??2345 ?ë??ì„œ ?Œì•¡?¬ê±´?¬íŒ???¹ë?ë¥??¸ì •

                ?Œì•¡?¬ê±´?¬íŒë²???5ì¡°ì—??ê°„ì´?ˆì°¨ë¥?ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??48ì¡?, "2014??2345", "??5ì¡?]
            },
            "constitutional_law": {
                "query": "?Œë²• ??0ì¡°ì˜ ?¸ê°„??ì¡´ì—„ê³?ê°€ì¹˜ì— ?€???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?Œë²• ??0ì¡°ëŠ” ?¸ê°„??ì¡´ì—„ê³?ê°€ì¹˜ë? ëª…ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ëª¨ë“  êµ???€ ?¸ê°„?¼ë¡œ?œì˜ ì¡´ì—„ê³?ê°€ì¹˜ë? ê°€ì§„ë‹¤
                2. ?Œë²•?¬íŒ??2013?Œë§ˆ456 ?ê²°?ì„œ ?¸ê°„??ì¡´ì—„?±ì„ êµ¬ì²´?ìœ¼ë¡??´ì„
                3. êµ????ê°œì¸??ê°€ì§€??ë¶ˆê?ì¹¨ì˜ ê¸°ë³¸???¸ê¶Œ???•ì¸?˜ê³  ?´ë? ë³´ì¥???˜ë¬´ë¥?ì§„ë‹¤

                ?Œë²• ??7ì¡°ì—??ê¸°ë³¸ê¶Œì˜ ?œí•œê³?ê·??œê³„ë¥?ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??0ì¡?, "2013?Œë§ˆ456", "??7ì¡?]
            },
            "administrative_law": {
                "query": "?‰ì •ì²˜ë¶„??ì·¨ì†Œ?”ê±´???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?‰ì •ì²˜ë¶„??ì·¨ì†Œ?”ê±´?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?‰ì •?ˆì°¨ë²???ì¡°ì— ?°ë¥¸ ?‰ì •?ˆì°¨ ì¤€??
                2. ?‰ì •?Œì†¡ë²???ì¡°ì— ?°ë¥¸ ?‰ì •?Œì†¡ ?œê¸° ê°€??
                3. ?€ë²•ì› 2012??8901 ?ë??ì„œ ?‰ì •ì²˜ë¶„ ì·¨ì†Œ???”ê±´??ëª…í™•????

                ?‰ì •?ˆì°¨ë²???0ì¡°ì—???‰ì •ì²˜ë¶„??ê·¼ê±°?€ ?´ìœ ë¥??œì‹œ???˜ë¬´ë¥?ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "2012??8901", "??0ì¡?]
            },
            "commercial_law": {
                "query": "ì£¼ì‹?Œì‚¬???´ì‚¬ ì±…ì„???€???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ì£¼ì‹?Œì‚¬???´ì‚¬ ì±…ì„?€ ?ë²•??ëª…ì‹œ?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ?ë²• ??82ì¡°ì—???´ì‚¬??? ì„ê³??„ê¸° ê·œì •
                2. ?ë²• ??99ì¡°ì—???´ì‚¬???˜ë¬´?€ ì±…ì„ ê·œì •
                3. ?€ë²•ì› 2011??5678 ?ë??ì„œ ?´ì‚¬??ì£¼ì˜?˜ë¬´ë¥?êµ¬ì²´?ìœ¼ë¡??´ì„

                ?ë²• ??01ì¡°ì—???´ì‚¬???í•´ë°°ìƒì±…ì„??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??82ì¡?, "??99ì¡?, "2011??5678", "??01ì¡?]
            },
            "tax_law": {
                "query": "?Œë“??? ê³  ?ˆì°¨ë¥??ˆë‚´?´ì£¼?¸ìš”",
                "answer": """
                ?Œë“??? ê³  ?ˆì°¨???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?Œë“?¸ë²• ??0ì¡°ì— ?°ë¥¸ ? ê³ ?˜ë¬´???•ì¸
                2. ?Œë“?¸ë²• ??1ì¡°ì— ?°ë¥¸ ? ê³ ê¸°í•œ ì¤€??
                3. ?€ë²•ì› 2010??4567 ?ë??ì„œ ?Œë“??? ê³ ?˜ë¬´ë¥?ëª…í™•????

                êµ?„¸ê¸°ë³¸ë²???5ì¡°ì—???©ì„¸?˜ë¬´???±ë¦½ê³??•ì •??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??0ì¡?, "??1ì¡?, "2010??4567", "??5ì¡?]
            },
            "intellectual_property": {
                "query": "?¹í—ˆê¶?ì¹¨í•´ ??êµ¬ì œë°©ë²•???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?¹í—ˆê¶?ì¹¨í•´ ??êµ¬ì œë°©ë²•?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?¹í—ˆë²???26ì¡°ì— ?°ë¥¸ ì¹¨í•´ê¸ˆì?ì²?µ¬ê¶?
                2. ?¹í—ˆë²???28ì¡°ì— ?°ë¥¸ ?í•´ë°°ìƒì²?µ¬ê¶?
                3. ?€ë²•ì› 2009??3456 ?ë??ì„œ ?¹í—ˆê¶?ì¹¨í•´???”ê±´??ëª…í™•????

                ?¹í—ˆë²???30ì¡°ì—??ì¹¨í•´?‰ìœ„??ì¶”ì •??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??26ì¡?, "??28ì¡?, "2009??3456", "??30ì¡?]
            },
            "family_law": {
                "query": "ì¹œìƒ??ì¶”ì •???ì¹™???€???¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ì¹œìƒ??ì¶”ì •???ì¹™?€ ë¯¼ë²•??ëª…ì‹œ?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ë¯¼ë²• ??44ì¡°ì—???¼ì¸ ì¤‘ì˜ ?‰íƒœë¡?ì¶œìƒ???ëŠ” ë¶€???ë¡œ ì¶”ì •
                2. ë¯¼ë²• ??45ì¡°ì—??ì¹œìƒ??ë¶€?¸ì†Œ??ê·œì •
                3. ?€ë²•ì› 2008??2345 ?ë??ì„œ ì¹œìƒ??ì¶”ì •???”ê±´??êµ¬ì²´?ìœ¼ë¡??´ì„

                ë¯¼ë²• ??46ì¡°ì—??ì¹œìƒ???¸ì????¨ë ¥??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??44ì¡?, "??45ì¡?, "2008??2345", "??46ì¡?]
            },
            "real_estate_law": {
                "query": "ë¶€?™ì‚° ?±ê¸° ?ˆì°¨ë¥??ˆë‚´?´ì£¼?¸ìš”",
                "answer": """
                ë¶€?™ì‚° ?±ê¸° ?ˆì°¨???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ë¶€?™ì‚°?±ê¸°ë²???ì¡°ì— ?°ë¥¸ ?±ê¸°???¨ë ¥ ê·œì •
                2. ë¶€?™ì‚°?±ê¸°ë²???0ì¡°ì— ?°ë¥¸ ?±ê¸°? ì²­ ?ˆì°¨
                3. ?€ë²•ì› 2007??8901 ?ë??ì„œ ?±ê¸°???¨ë ¥??êµ¬ì²´?ìœ¼ë¡??´ì„

                ë¶€?™ì‚°?±ê¸°ë²???5ì¡°ì—???±ê¸°?ì¸??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??0ì¡?, "2007??8901", "??5ì¡?]
            },
            "complex_legal_question": {
                "query": "?Œì‚¬ê°€ ì§ì›??ë¶€?¹í•´ê³ í•œ ?? ?´ë‹¹ ì§ì›???Œì‚¬???€???í•´ë°°ìƒ??ì²?µ¬?????ˆëŠ”ì§€, ê·¸ë¦¬ê³???ê²½ìš° ë¯¼ë²• ??50ì¡°ì? ê·¼ë¡œê¸°ì?ë²???3ì¡°ê? ?´ë–»ê²??ìš©?˜ëŠ”ì§€ ?¤ëª…?´ì£¼?¸ìš”",
                "answer": """
                ?´ëŠ” ë³µí•©?ì¸ ë²•ì  ë¬¸ì œë¡??¬ëŸ¬ ë²•ë ¹???ìš©?©ë‹ˆ??

                1. ê·¼ë¡œê¸°ì?ë²???3ì¡°ì—??ë¶€?¹í•´ê³ ë? ê¸ˆì??˜ê³  ?ˆìŠµ?ˆë‹¤.
                2. ë¯¼ë²• ??50ì¡°ì—??ë¶ˆë²•?‰ìœ„ë¡??¸í•œ ?í•´ë°°ìƒ??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                3. ?€ë²•ì› 2006??5678 ?ë??ì„œ ë¶€?¹í•´ê³ ì? ?í•´ë°°ìƒ??ê´€ê³„ë? ëª…í™•???ˆìŠµ?ˆë‹¤.
                4. ê·¼ë¡œê¸°ì?ë²???8ì¡°ì—??ë¶€?¹í•´ê³?êµ¬ì œ?ˆì°¨ë¥?ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.

                ?°ë¼??ë¶€?¹í•´ê³ ëœ ì§ì›?€ ê·¼ë¡œê¸°ì?ë²•ìƒ êµ¬ì œ?ˆì°¨?€ ë¯¼ë²•???í•´ë°°ìƒ??ëª¨ë‘ ì²?µ¬?????ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??3ì¡?, "??50ì¡?, "2006??5678", "??8ì¡?]
            },
            "no_citations": {
                "query": "ë²•ë¥  ?ë‹´?€ ?´ë””??ë°›ì„ ???ˆë‚˜??",
                "answer": """
                ë²•ë¥  ?ë‹´?€ ?¤ìŒê³?ê°™ì? ê³³ì—??ë°›ì„ ???ˆìŠµ?ˆë‹¤:

                1. ?€?œë??¸ì‚¬?‘íšŒ ë²•ë¥ êµ¬ì¡°?¬ë‹¨
                2. ê°?ì§€ë°©ë²•?ì˜ ë²•ë¥ ?ë‹´??
                3. ?œêµ°êµ¬ì²­??ë²•ë¥ ?ë‹´??
                4. ?¨ë¼??ë²•ë¥ ?ë‹´ ?œë¹„??

                ?€ë¶€ë¶?ë¬´ë£Œ ?ëŠ” ?€?´í•œ ë¹„ìš©?¼ë¡œ ?ë‹´??ë°›ì„ ???ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": []
            },
            "mixed_citations": {
                "query": "ê³„ì•½?œì— ëª…ì‹œ???„ì•½ê¸?ì¡°í•­??ë¯¼ë²• ??98ì¡°ì? ?½ê???ê·œì œ??ê´€??ë²•ë¥  ??ì¡°ì— ?„ë°°?˜ëŠ”ì§€, ê·¸ë¦¬ê³??€ë²•ì› 2005??2345 ?ë??€ ?œìš¸ê³ ë“±ë²•ì› 2004??6789 ?ë????´ë–»ê²??ë‹¨?ˆëŠ”ì§€ ?Œë ¤ì£¼ì„¸??,
                "answer": """
                ?„ì•½ê¸?ì¡°í•­??? íš¨?±ì? ?¬ëŸ¬ ë²•ë ¹ê³??ë?ë¥?ì¢…í•©?ìœ¼ë¡?ê²€? í•´???©ë‹ˆ??

                1. ë¯¼ë²• ??98ì¡°ì—???„ì•½ê¸ˆì˜ ?±ì§ˆê³??¨ë ¥??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                2. ?½ê???ê·œì œ??ê´€??ë²•ë¥  ??ì¡°ì—??ë¶ˆê³µ?•í•œ ?½ê???ê·œì œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                3. ?€ë²•ì› 2005??2345 ?ë??ì„œ ?„ì•½ê¸?ì¡°í•­??? íš¨???”ê±´??ëª…í™•???ˆìŠµ?ˆë‹¤.
                4. ?œìš¸ê³ ë“±ë²•ì› 2004??6789 ?ë??ì„œ ? ì‚¬???¬ì•ˆ???¤ë£¨?ˆìŠµ?ˆë‹¤.
                5. ê·¼ë¡œê¸°ì?ë²???5ì¡°ì—??ê·¼ë¡œê³„ì•½???„ì•½ê¸ˆì„ ?œí•œ?˜ê³  ?ˆìŠµ?ˆë‹¤.

                ê°??¬ì•ˆ??êµ¬ì²´???´ìš©???°ë¼ ?ë‹¨???¬ë¼ì§????ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??98ì¡?, "??ì¡?, "2005??2345", "2004??6789", "??5ì¡?]
            },

            # === ì¶”ê? ë²•ë¥  ë¶„ì•¼ ?ŒìŠ¤??===
            "environmental_law": {
                "query": "?˜ê²½?¤ì—¼?¼ë¡œ ?¸í•œ ?í•´ë°°ìƒ ì±…ì„???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ?˜ê²½?¤ì—¼?¼ë¡œ ?¸í•œ ?í•´ë°°ìƒ ì±…ì„?€ ?˜ê²½?•ì±…ê¸°ë³¸ë²???1ì¡°ì? ?˜ê²½?¤ì—¼?¼í•´ ë°°ìƒì±…ì„ë²•ì— ê·œì •?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ë¬´ê³¼??ì±…ì„ì£¼ì˜ ?ì¹™ ?ìš©
                2. ?ì¸??ë¶ˆëª… ??ê³µë™ì±…ì„
                3. ?˜ê²½?¤ì—¼?¼í•´ ë°°ìƒì±…ì„ë³´í—˜ ê°€???˜ë¬´

                ?€ë²•ì› 2022??2345 ?ë??ì„œ ?˜ê²½?¤ì—¼ ?í•´ë°°ìƒ??êµ¬ì²´?ì¸ ë²”ìœ„ë¥??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??1ì¡?, "2022??2345"]
            },
            "medical_law": {
                "query": "?˜ë£Œ?¬ê³  ë°œìƒ ???˜ì‚¬??ì±…ì„???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ?˜ë£Œ?¬ê³  ë°œìƒ ???˜ì‚¬??ì±…ì„?€ ?˜ë£Œë²???7ì¡°ì? ë¯¼ë²• ??50ì¡°ì— ?°ë¼ ?¤ìŒê³?ê°™ì´ ê·œì •?©ë‹ˆ??

                1. ?˜ë£Œì§„ì˜ ì£¼ì˜?˜ë¬´ ?„ë°˜
                2. ?˜ì???€???¤ëª…?˜ë¬´ ?„ë°˜
                3. ?˜ë£Œê¸°ë¡ ?‘ì„± ë°?ë³´ê??˜ë¬´

                ?€ë²•ì› 2021??2345 ?ë??ì„œ ?˜ë£Œ?¬ê³ ??ì±…ì„ ?¸ì • ê¸°ì???êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??7ì¡?, "??50ì¡?, "2021??2345"]
            },
            "cyber_law": {
                "query": "ê°œì¸?•ë³´ë³´í˜¸ë²??„ë°˜ ??ì²˜ë²Œ???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ê°œì¸?•ë³´ë³´í˜¸ë²??„ë°˜ ??ì²˜ë²Œ?€ ê°œì¸?•ë³´ë³´í˜¸ë²???1ì¡°ë?????6ì¡°ê¹Œì§€?ì„œ ?•í•˜ê³??ˆìŠµ?ˆë‹¤:

                1. ê°œì¸?•ë³´ ì²˜ë¦¬ë°©ì¹¨ ?„ë°˜: 3???´í•˜??ì§•ì—­ ?ëŠ” 3ì²œë§Œ???´í•˜??ë²Œê¸ˆ
                2. ê°œì¸?•ë³´ ? ì¶œ ? ê³  ?˜ë¬´ ?„ë°˜: 1???´í•˜??ì§•ì—­ ?ëŠ” 1ì²œë§Œ???´í•˜??ë²Œê¸ˆ
                3. ê°œì¸?•ë³´ë³´í˜¸?„ì›?Œì˜ ?œì •ëª…ë ¹ ?„ë°˜

                ?€ë²•ì› 2022??2345 ?ë??ì„œ ê°œì¸?•ë³´ë³´í˜¸ë²??„ë°˜??êµ¬ì²´?ì¸ ì²˜ë²Œ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??1ì¡?, "??6ì¡?, "2022??2345"]
            },
            "international_law": {
                "query": "êµ? œê³„ì•½?ì„œ ì¤€ê±°ë²• ? íƒ???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                êµ? œê³„ì•½?ì„œ ì¤€ê±°ë²• ? íƒ?€ êµ? œ?¬ë²• ??5ì¡°ë?????8ì¡°ê¹Œì§€?ì„œ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ?¹ì‚¬?ì˜ ?ìœ ë¡œìš´ ì¤€ê±°ë²• ? íƒ
                2. ì¤€ê±°ë²• ? íƒ???†ëŠ” ê²½ìš°??ê²°ì • ê¸°ì?
                3. ê°•í–‰ë²•ê·œ???ìš© ë²”ìœ„

                ?€ë²•ì› 2021??2345 ?ë??ì„œ êµ? œê³„ì•½??ì¤€ê±°ë²• ê²°ì • ê¸°ì???êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??5ì¡?, "??8ì¡?, "2021??2345"]
            },
            "banking_law": {
                "query": "?€?‰ì˜ ?€ì¶œê³„?½ì—???´ì???œí•œ???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ?€?‰ì˜ ?€ì¶œê³„?½ì—???´ì???œí•œ?€ ê¸ˆìœµ?Œë¹„?ë³´?¸ë²• ??9ì¡°ì? ?½ê???ê·œì œ??ê´€??ë²•ë¥  ??ì¡°ì— ê·œì •?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ??20%ë¥?ì´ˆê³¼?˜ëŠ” ?´ì?¨ì˜ ë¬´íš¨
                2. ë³µë¦¬ ê³„ì‚°??ê¸ˆì?
                3. ? ì´??ê³µì œ??ê¸ˆì?

                ?€ë²•ì› 2020??2345 ?ë??ì„œ ?€ì¶??´ì???œí•œ??êµ¬ì²´?ì¸ ?ìš©???ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??9ì¡?, "??ì¡?, "2020??2345"]
            },
            "insurance_law": {
                "query": "ë³´í—˜ê³„ì•½?ì„œ ë³´í—˜?¬ê¸° ë°©ì?ë¥??„í•œ ì¡°ì¹˜???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ë³´í—˜ê³„ì•½?ì„œ ë³´í—˜?¬ê¸° ë°©ì?ë¥??„í•œ ì¡°ì¹˜??ë³´í—˜?…ë²• ??08ì¡°ì? ?ë²• ??44ì¡°ì— ê·œì •?˜ì–´ ?ˆìŠµ?ˆë‹¤:

                1. ë³´í—˜?¬ê¸° ? ê³  ?˜ë¬´
                2. ë³´í—˜?¬ê¸° ì¡°ì‚¬ê¶?
                3. ë³´í—˜ê¸?ì§€ê¸?ê±°ë? ?¬ìœ 

                ?€ë²•ì› 2021??2345 ?ë??ì„œ ë³´í—˜?¬ê¸° ë°©ì? ì¡°ì¹˜??êµ¬ì²´?ì¸ ë²”ìœ„ë¥??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??08ì¡?, "??44ì¡?, "2021??2345"]
            },
            "competition_law": {
                "query": "ê³µì •ê±°ë˜ë²??„ë°˜ ???œì¬???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ê³µì •ê±°ë˜ë²??„ë°˜ ???œì¬??ê³µì •ê±°ë˜ë²???2ì¡°ë?????5ì¡°ê¹Œì§€?ì„œ ?•í•˜ê³??ˆìŠµ?ˆë‹¤:

                1. ?œì •ëª…ë ¹ ë°?ê³¼ì§•ê¸?ë¶€ê³?
                2. ê³¼ì§•ê¸ˆì˜ ê³„ì‚° ê¸°ì?
                3. ?œì •ëª…ë ¹ ?„ë°˜ ???•ì‚¬ì²˜ë²Œ

                ?€ë²•ì› 2022??2345 ?ë??ì„œ ê³µì •ê±°ë˜ë²??„ë°˜ ?œì¬??êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??2ì¡?, "??5ì¡?, "2022??2345"]
            },
            "consumer_law": {
                "query": "?Œë¹„?ê¸°ë³¸ë²•???°ë¥¸ ?Œë¹„??ê¶Œë¦¬???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ?Œë¹„?ê¸°ë³¸ë²•???°ë¥¸ ?Œë¹„??ê¶Œë¦¬???Œë¹„?ê¸°ë³¸ë²• ??ì¡°ë?????ì¡°ê¹Œì§€?ì„œ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ?ˆì „???í’ˆê³??œë¹„?¤ë? ë°›ì„ ê¶Œë¦¬
                2. ?•í™•???•ë³´ë¥?ë°›ì„ ê¶Œë¦¬
                3. ? íƒ??ê¶Œë¦¬
                4. ?¼í•´ë¥?ë°›ì•˜????ë³´ìƒë°›ì„ ê¶Œë¦¬

                ?€ë²•ì› 2021??2345 ?ë??ì„œ ?Œë¹„??ê¶Œë¦¬??êµ¬ì²´?ì¸ ë³´í˜¸ ë²”ìœ„ë¥??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "2021??2345"]
            },
            "education_law": {
                "query": "êµìœ¡ê¸°ë³¸ë²•ì— ?°ë¥¸ êµìœ¡??ê¶Œë¦¬???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                êµìœ¡ê¸°ë³¸ë²•ì— ?°ë¥¸ êµìœ¡??ê¶Œë¦¬??êµìœ¡ê¸°ë³¸ë²???ì¡°ì? ?Œë²• ??1ì¡°ì—??ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ëª¨ë“  êµ????êµìœ¡ë°›ì„ ê¶Œë¦¬
                2. êµìœ¡??ê¸°íšŒ ê· ë“±
                3. êµìœ¡???ì£¼?±ê³¼ ?„ë¬¸??ë³´ì¥

                ?Œë²•?¬íŒ??2019?Œë§ˆ123 ê²°ì •?ì„œ êµìœ¡ê¶Œì˜ êµ¬ì²´?ì¸ ë³´í˜¸ ë²”ìœ„ë¥??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??1ì¡?, "2019?Œë§ˆ123"]
            },

            # === ?£ì? ì¼€?´ìŠ¤ ë°??¹ìˆ˜ ?í™© ?ŒìŠ¤??===
            "ambiguous_citations": {
                "query": "??23ì¡°ì— ?°ë¼ ì²˜ë²Œ?œë‹¤ê³??˜ì–´ ?ˆëŠ”?? ?´ê²Œ ?•ë²•?¸ì? ë¯¼ë²•?¸ì? ë¶ˆë¶„ëª…í•©?ˆë‹¤.",
                "answer": """
                ??23ì¡°ëŠ” ?¬ëŸ¬ ë²•ë¥ ??ì¡´ì¬?????ˆìœ¼ë¯€ë¡??•í™•??ë²•ë¥ ëª…ì„ ?•ì¸?´ì•¼ ?©ë‹ˆ??

                1. ?•ë²• ??23ì¡? ê³µë¬¸???„ì¡°
                2. ë¯¼ë²• ??23ì¡? ë²•ë¥ ?‰ìœ„???´ì„
                3. ?ë²• ??23ì¡? ì£¼ì‹?Œì‚¬???¤ë¦½

                ?€ë²•ì› 2020??2345 ?ë??ì„œ??ë²•ì¡°ë¬??´ì„ ??ë²•ë¥ ëª…ì˜ ì¤‘ìš”?±ì„ ê°•ì¡°?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??23ì¡?, "??23ì¡?, "??23ì¡?, "2020??2345"]
            },
            "outdated_citations": {
                "query": "êµ?ë¯¼ë²• ??23ì¡°ì— ?°ë¥´ë©??´ë–»ê²??˜ë‚˜??",
                "answer": """
                êµ?ë¯¼ë²• ??23ì¡°ëŠ” ?„ì¬ ê°œì •?˜ì–´ ?ˆë¡œ??ì¡°ë¬¸?¼ë¡œ ë³€ê²½ë˜?ˆìŠµ?ˆë‹¤:

                1. êµ?ë¯¼ë²• ??23ì¡? êµ¬ì²´?ì¸ ?´ìš©
                2. ?„í–‰ ë¯¼ë²• ??24ì¡? ê°œì •???´ìš©
                3. ë²•ë¥  ê°œì •???Œê¸‰??ë¬¸ì œ

                ?€ë²•ì› 2019??2345 ?ë??ì„œ??ë²•ë¥  ê°œì •???Œê¸‰???ìš© ë²”ìœ„ë¥?êµ¬ì²´?ìœ¼ë¡??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??23ì¡?, "??24ì¡?, "2019??2345"]
            },
            "foreign_law_citations": {
                "query": "ë¯¸êµ­ ë²•ë¥ ê³??œêµ­ ë²•ë¥ ??ì°¨ì´?ì? ë¬´ì—‡?¸ê???",
                "answer": """
                ë¯¸êµ­ ë²•ë¥ ê³??œêµ­ ë²•ë¥ ??ì£¼ìš” ì°¨ì´?ì? ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ë²•ì²´ê³? ?ë?ë²?vs ?±ë¬¸ë²?
                2. ë²•ì›êµ¬ì¡°: ?°ë°©ë²•ì› vs ?¨ì¼ë²•ì›
                3. ë°°ì‹¬?œë„: ë°°ì‹¬??vs ?„ë¬¸ë²•ê???

                êµ? œ?¬ë²• ??ì¡°ì—???¸êµ­ë²•ì˜ ?ìš© ë²”ìœ„ë¥?ê·œì •?˜ê³  ?ˆìœ¼ë©?
                ?€ë²•ì› 2020??2345 ?ë??ì„œ ?¸êµ­ë²??ìš©??êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2020??2345"]
            },
            "multiple_law_conflicts": {
                "query": "ë¯¼ë²•ê³??ë²•??ì¶©ëŒ?????´ë–¤ ë²•ì´ ?°ì„ ?˜ë‚˜??",
                "answer": """
                ë¯¼ë²•ê³??ë²•??ì¶©ëŒ ???ìš© ?ì¹™?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?¹ë³„ë²??°ì„ ???ì¹™: ?ë²•??ë¯¼ë²•???°ì„ 
                2. ?ë²• ??ì¡? ?ì‚¬??ê´€?˜ì—¬ ?ë²•???¹ë³„??ê·œì •???†ìœ¼ë©?ë¯¼ë²•??ê·œì •??ì¤€??
                3. ë²•ë¥ ???´ì„ ?ì¹™

                ?€ë²•ì› 2021??2345 ?ë??ì„œ ë¯¼ë²•ê³??ë²•??ì¶©ëŒ ?´ê²° ê¸°ì???êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2021??2345"]
            },
            "constitutional_challenge": {
                "query": "?Œë²•?¬íŒ?Œì—???„í—Œ ê²°ì •??ë°›ì? ë²•ë¥ ?€ ?´ë–»ê²??˜ë‚˜??",
                "answer": """
                ?Œë²•?¬íŒ?Œì˜ ?„í—Œ ê²°ì •?€ ?Œë²•?¬íŒ?Œë²• ??7ì¡°ì— ?°ë¼ ?¤ìŒê³?ê°™ì? ?¨ë ¥??ê°€ì§‘ë‹ˆ??

                1. ë²•ë¥ ???¨ë ¥ ?ì‹¤
                2. ?Œê¸‰?¨ì˜ ë¬¸ì œ
                3. ê´€???ë???ë³€ê²?

                ?Œë²•?¬íŒ??2019?Œë§ˆ123 ê²°ì •?ì„œ ?„í—Œ ê²°ì •??êµ¬ì²´?ì¸ ?¨ë ¥ ë²”ìœ„ë¥??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??7ì¡?, "2019?Œë§ˆ123"]
            },
            "emergency_law": {
                "query": "ê¸´ê¸‰?í™©?ì„œ ë°œë ¹???‰ì •ëª…ë ¹???¨ë ¥?€ ?´ë–»ê²??˜ë‚˜??",
                "answer": """
                ê¸´ê¸‰?í™©?ì„œ ë°œë ¹???‰ì •ëª…ë ¹???¨ë ¥?€ ?‰ì •?ˆì°¨ë²???ì¡°ì? ê¸´ê¸‰ëª…ë ¹ê¶Œì— ê´€??ë²•ë¥ ?ì„œ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ê¸´ê¸‰ëª…ë ¹??ë°œë ¹ ?”ê±´
                2. êµ?šŒ???¬í›„ ?¹ì¸
                3. ëª…ë ¹???¨ë ¥ ê¸°ê°„

                ?€ë²•ì› 2020??2345 ?ë??ì„œ ê¸´ê¸‰ëª…ë ¹??êµ¬ì²´?ì¸ ?¨ë ¥ ë²”ìœ„ë¥??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2020??2345"]
            },
            "international_treaty": {
                "query": "êµ? œì¡°ì•½??êµ?‚´ë²•ê³¼ ì¶©ëŒ?????´ë–»ê²??´ê²°?˜ë‚˜??",
                "answer": """
                êµ? œì¡°ì•½ê³?êµ?‚´ë²•ì˜ ì¶©ëŒ ???´ê²° ?ì¹™?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ì¡°ì•½??êµ?‚´ë²•ì  ?¨ë ¥
                2. êµ? œë²??°ì„ ???ì¹™
                3. ?Œë²• ??ì¡°ì˜ ì¡°ì•½ ?¹ì¸

                ?€ë²•ì› 2021??2345 ?ë??ì„œ êµ? œì¡°ì•½ê³?êµ?‚´ë²•ì˜ ì¶©ëŒ ?´ê²° ê¸°ì???êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2021??2345"]
            },
            "customary_law": {
                "query": "ê´€?µë²•???¨ë ¥ê³??ìš© ë²”ìœ„???€???¤ëª…?´ì£¼?¸ìš”.",
                "answer": """
                ê´€?µë²•???¨ë ¥ê³??ìš© ë²”ìœ„??ë¯¼ë²• ??ì¡°ì? ?€ë²•ì› ?ë??ì„œ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤:

                1. ë²•ë ¹???¹ë³„??ê·œì •???†ëŠ” ê²½ìš° ê´€?µë²• ?ìš©
                2. ê´€?µë²•???±ë¦½ ?”ê±´
                3. ê´€?µë²•ê³??±ë¬¸ë²•ì˜ ê´€ê³?

                ?€ë²•ì› 2020??2345 ?ë??ì„œ ê´€?µë²•??êµ¬ì²´?ì¸ ?ìš© ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2020??2345"]
            },
            "legal_fiction": {
                "query": "ë²•ë¥ ??ì¶”ì •ê³?ë²•ë¥ ??ê°€?•ì˜ ì°¨ì´?ì? ë¬´ì—‡?¸ê???",
                "answer": """
                ë²•ë¥ ??ì¶”ì •ê³?ë²•ë¥ ??ê°€?•ì˜ ì°¨ì´?ì? ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ë²•ë¥ ??ì¶”ì •: ë°˜ì¦??ê°€?¥í•œ ì¶”ì •
                2. ë²•ë¥ ??ê°€?? ë°˜ì¦??ë¶ˆê??¥í•œ ê°€??
                3. ?…ì¦ì±…ì„???„í™˜

                ?€ë²•ì› 2021??2345 ?ë??ì„œ ë²•ë¥ ??ì¶”ì •ê³?ê°€?•ì˜ êµ¬ì²´?ì¸ ?ìš©???ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["2021??2345"]
            },

            # === ?±ëŠ¥ ë°?ë¶€???ŒìŠ¤??===
            "long_text": {
                "query": "ë§¤ìš° ê¸?ë²•ë¥  ë¬¸ì„œ?ì„œ ?¬ëŸ¬ ì¡°ë¬¸???¸ìš©?˜ëŠ” ê²½ìš°",
                "answer": """
                ë¯¼ë²• ??ì¡°ëŠ” ë²•ì›??ë²•ë¥  ?´ì„??ê´€??ê¸°ë³¸ ?ì¹™??ê·œì •?˜ê³  ?ˆìœ¼ë©? ??ì¡°ëŠ” ë²•ë¥ ???¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???´ì„??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„??ë¬´íš¨?€ ì·¨ì†Œ??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„??ì¡°ê±´ê³?ê¸°í•œ??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???€ë¦¬ì— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???€?œì— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??ì¡°ëŠ” ë²•ë¥ ?‰ìœ„??ê³µì‹œ??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??0ì¡°ëŠ” ë²•ë¥ ?‰ìœ„??ê³µì¦??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??1ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??2ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??3ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸???¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??4ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ì¶”ì •?¥ì— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??5ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸???€?? ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??6ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê³µì‹ ?¥ì— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??7ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê¸°ì¬?¬ì‹¤??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??8ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê¸°ì¬?¬ì‹¤??ì§„ì‹¤?±ì— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ??9ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê¸°ì¬?¬ì‹¤??ì¶”ì •??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ??0ì¡°ëŠ” ë²•ë¥ ?‰ìœ„???±ê¸°ë¶€?±ë³¸??ê¸°ì¬?¬ì‹¤???€??— ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ?€ë²•ì› 2020??2345 ?ë??ì„œ???´ëŸ¬??ë²•ì¡°ë¬¸ë“¤???´ì„ê³??ìš©??ê´€?˜ì—¬ êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??0ì¡?, "??1ì¡?, "??2ì¡?, "??3ì¡?, "??4ì¡?, "??5ì¡?, "??6ì¡?, "??7ì¡?, "??8ì¡?, "??9ì¡?, "??0ì¡?, "2020??2345"]
            },
            "rapid_citations": {
                "query": "?°ì†??ë²•ì¡°ë¬??¸ìš© ?ŒìŠ¤??,
                "answer": """
                ë¯¼ë²• ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??0ì¡°ì— ?°ë¥´ë©?
                ë²•ë¥ ?‰ìœ„???±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ?•ë²• ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡°ì— ?°ë¥´ë©?
                ë²”ì£„???±ë¦½ê³?ì²˜ë²Œ??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤. ?ë²• ??ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡°ì— ?°ë¥´ë©?
                ?í–‰?„ì˜ ?±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©? ê·¼ë¡œê¸°ì?ë²???ì¡? ??ì¡? ??ì¡? ??ì¡? ??ì¡°ì— ?°ë¥´ë©?
                ê·¼ë¡œì¡°ê±´??ê¸°ì???ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??0ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?]
            },
            "mixed_languages": {
                "query": "?œêµ­?´ì? ?ì–´ê°€ ?ì¸ ë²•ë¥  ë¬¸ì„œ",
                "answer": """
                Contract Law???°ë¥´ë©?ê³„ì•½???±ë¦½?€ ë¯¼ë²• ??43ì¡°ì— ê·œì •?˜ì–´ ?ˆìœ¼ë©?
                Tort Law???°ë¥´ë©?ë¶ˆë²•?‰ìœ„??ë¯¼ë²• ??50ì¡°ì— ê·œì •?˜ì–´ ?ˆìŠµ?ˆë‹¤.
                Property Law???°ë¥´ë©?ë¬¼ê¶Œ?€ ë¯¼ë²• ??85ì¡°ì— ê·œì •?˜ì–´ ?ˆìœ¼ë©?
                Family Law???°ë¥´ë©?ê°€ì¡±ê?ê³„ëŠ” ë¯¼ë²• ??79ì¡°ì— ê·œì •?˜ì–´ ?ˆìŠµ?ˆë‹¤.
                ?€ë²•ì› 2021??2345 ?ë??ì„œ???´ëŸ¬??êµ? œë²•ê³¼ êµ?‚´ë²•ì˜ ?ìš©??ê´€?˜ì—¬ êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??43ì¡?, "??50ì¡?, "??85ì¡?, "??79ì¡?, "2021??2345"]
            },
            "special_characters": {
                "query": "?¹ìˆ˜ë¬¸ìê°€ ?¬í•¨??ë²•ë¥  ë¬¸ì„œ",
                "answer": """
                ë¯¼ë²• ??ì¡?ë²•ì›??ë²•ë¥  ?´ì„)???°ë¥´ë©? ë²•ë¥ ?‰ìœ„???±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©?
                ?•ë²• ??ì¡?ë²”ì£„???±ë¦½)???°ë¥´ë©? ë²”ì£„??êµ¬ì„±?”ê±´??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ?ë²• ??ì¡??í–‰?„ì˜ ?±ë¦½)???°ë¥´ë©? ?í–‰?„ì˜ ?”ê±´??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©?
                ê·¼ë¡œê¸°ì?ë²???ì¡?ê·¼ë¡œì¡°ê±´??ê¸°ì?)???°ë¥´ë©? ê·¼ë¡œì¡°ê±´??ìµœì?ê¸°ì???ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ?€ë²•ì› 2020??2345 ?ë??ì„œ???´ëŸ¬??ë²•ì¡°ë¬¸ì˜ ?´ì„??ê´€?˜ì—¬ êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "2020??2345"]
            },
            "unicode_citations": {
                "query": "? ë‹ˆì½”ë“œ ë¬¸ìê°€ ?¬í•¨??ë²•ë¥  ë¬¸ì„œ",
                "answer": """
                ë¯¼ë²• ??ì¡°ì— ?°ë¥´ë©?ë²•ë¥ ?‰ìœ„???±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©?
                ?•ë²• ??ì¡°ì— ?°ë¥´ë©?ë²”ì£„???±ë¦½ê³?ì²˜ë²Œ??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ?ë²• ??ì¡°ì— ?°ë¥´ë©??í–‰?„ì˜ ?±ë¦½ê³??¨ë ¥??ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìœ¼ë©?
                ê·¼ë¡œê¸°ì?ë²???ì¡°ì— ?°ë¥´ë©?ê·¼ë¡œì¡°ê±´??ê¸°ì???ê´€?˜ì—¬ ê·œì •?˜ê³  ?ˆìŠµ?ˆë‹¤.
                ?€ë²•ì› 2020??2345 ?ë??ì„œ???´ëŸ¬??ë²•ì¡°ë¬¸ì˜ ?´ì„??ê´€?˜ì—¬ êµ¬ì²´?ì¸ ê¸°ì????œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "??ì¡?, "??ì¡?, "??ì¡?, "2020??2345"]
            },

            # === ë³µí•© ?œë‚˜ë¦¬ì˜¤ ?ŒìŠ¤??===
            "multi_jurisdiction": {
                "query": "?œêµ­ê³?ë¯¸êµ­??ê³„ì•½ë²?ì°¨ì´?ê³¼ êµ? œê³„ì•½?ì„œ???ìš©",
                "answer": """
                ?œêµ­ê³?ë¯¸êµ­??ê³„ì•½ë²?ì°¨ì´?ì? ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?œêµ­ ë¯¼ë²• ??43ì¡?vs ë¯¸êµ­ UCC Article 2
                2. ?œêµ­ ë¯¼ë²• ??44ì¡?vs ë¯¸êµ­ Common Law
                3. êµ? œ?¬ë²• ??5ì¡°ì˜ ì¤€ê±°ë²• ? íƒ

                ?€ë²•ì› 2021??2345 ?ë??ì„œ êµ? œê³„ì•½??ì¤€ê±°ë²• ê²°ì • ê¸°ì????œì‹œ?˜ê³  ?ˆìœ¼ë©?
                ë¯¸êµ­ ?°ë°©ë²•ì› 2020???ë??ì„œ??? ì‚¬???ì¹™???ìš©?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??43ì¡?, "??44ì¡?, "??5ì¡?, "2021??2345"]
            },
            "cross_reference": {
                "query": "ë¯¼ë²•ê³??ë²•, ?•ë²•??ëª¨ë‘ ê´€?¨ëœ ë³µí•© ?¬ê±´",
                "answer": """
                ë³µí•© ?¬ê±´?ì„œ ?¬ëŸ¬ ë²•ë¥ ???ìš©?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ë¯¼ë²• ??50ì¡? ë¶ˆë²•?‰ìœ„ë¡??¸í•œ ?í•´ë°°ìƒ
                2. ?ë²• ??01ì¡? ?´ì‚¬???í•´ë°°ìƒì±…ì„
                3. ?•ë²• ??47ì¡? ?¬ê¸°ì£„ì˜ ?±ë¦½

                ?€ë²•ì› 2021??2345 ?ë??ì„œ???´ëŸ¬??ë³µí•© ?¬ê±´??ë²•ë¥  ?ìš© ?œì„œë¥?êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??50ì¡?, "??01ì¡?, "??47ì¡?, "2021??2345"]
            },
            "temporal_conflict": {
                "query": "ë²•ë¥  ê°œì • ?„í›„???ìš© ë¬¸ì œ",
                "answer": """
                ë²•ë¥  ê°œì • ?„í›„???ìš© ë¬¸ì œ???¤ìŒê³?ê°™ì´ ?´ê²°?©ë‹ˆ??

                1. êµ?ë¯¼ë²• ??23ì¡? ê°œì • ??ê·œì •
                2. ?„í–‰ ë¯¼ë²• ??24ì¡? ê°œì • ??ê·œì •
                3. ë²•ë¥  ê°œì •???Œê¸‰??ë¬¸ì œ

                ?€ë²•ì› 2019??2345 ?ë??ì„œ??ë²•ë¥  ê°œì •???Œê¸‰???ìš© ë²”ìœ„ë¥?êµ¬ì²´?ìœ¼ë¡??ì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??23ì¡?, "??24ì¡?, "2019??2345"]
            },
            "hierarchical_conflict": {
                "query": "?Œë²•, ë²•ë¥ , ?œí–‰?? ?œí–‰ê·œì¹™???¨ë ¥ ?œì„œ",
                "answer": """
                ë²•ë¥ ???¨ë ¥ ?œì„œ???¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ?Œë²• ??ì¡? ìµœê³ ë²•ê·œ??ì§€??
                2. ë²•ë¥ : êµ?šŒ?ì„œ ?œì •
                3. ?œí–‰?? ?€?µë ¹??
                4. ?œí–‰ê·œì¹™: ë¶€??

                ?Œë²•?¬íŒ??2019?Œë§ˆ123 ê²°ì •?ì„œ ë²•ë¥ ???¨ë ¥ ?œì„œë¥?êµ¬ì²´?ìœ¼ë¡??œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["??ì¡?, "2019?Œë§ˆ123"]
            },
            "interpretation_methods": {
                "query": "ë²•ë¥  ?´ì„???¬ëŸ¬ ë°©ë²•??,
                "answer": """
                ë²•ë¥  ?´ì„??ë°©ë²•?€ ?¤ìŒê³?ê°™ìŠµ?ˆë‹¤:

                1. ë¬¸ë¦¬?´ì„: ë²•ì¡°ë¬¸ì˜ ë¬¸ì???˜ë?
                2. ?¼ë¦¬?´ì„: ë²•ì¡°ë¬¸ì˜ ?¼ë¦¬??êµ¬ì¡°
                3. ??‚¬?´ì„: ?…ë²• ê³¼ì •ê³??˜ë„
                4. ëª©ì ?´ì„: ë²•ë¥ ??ëª©ì ê³?ì·¨ì?

                ?€ë²•ì› 2020??2345 ?ë??ì„œ ë²•ë¥  ?´ì„??êµ¬ì²´?ì¸ ë°©ë²•???œì‹œ?˜ê³  ?ˆìŠµ?ˆë‹¤.
                """,
                "expected_citations": ["2020??2345"]
            }
        }

    def test_citation_enhancer(self) -> Dict[str, Any]:
        """ë²•ì  ?¸ìš© ê°•í™” ?œìŠ¤???ŒìŠ¤??""
        logger.info("=== ë²•ì  ?¸ìš© ê°•í™” ?œìŠ¤???ŒìŠ¤???œì‘ ===")

        results = {}
        for test_name, test_case in self.test_cases.items():
            logger.info(f"?ŒìŠ¤??ì¼€?´ìŠ¤: {test_name}")

            try:
                citation_result = self.citation_enhancer.enhance_text_with_citations(test_case["answer"])

                results[test_name] = {
                    "success": True,
                    "citations_found": citation_result["citation_count"],
                    "expected_citations": len(test_case["expected_citations"]),
                    "citations": citation_result,
                    "enhanced_text": citation_result["enhanced_text"]
                }

                logger.info(f"  - ë°œê²¬???¸ìš©: {citation_result['citation_count']}ê°?)
                logger.info(f"  - ?ˆìƒ ?¸ìš©: {len(test_case['expected_citations'])}ê°?)

            except Exception as e:
                logger.error(f"?ŒìŠ¤??ì¼€?´ìŠ¤ {test_name} ?¤íŒ¨: {e}")
                results[test_name] = {
                    "success": False,
                    "error": str(e)
                }

        return results

    def test_basis_validator(self) -> Dict[str, Any]:
        """ë²•ì  ê·¼ê±° ê²€ì¦??œìŠ¤???ŒìŠ¤??""
        logger.info("=== ë²•ì  ê·¼ê±° ê²€ì¦??œìŠ¤???ŒìŠ¤???œì‘ ===")

        results = {}
        for test_name, test_case in self.test_cases.items():
            logger.info(f"?ŒìŠ¤??ì¼€?´ìŠ¤: {test_name}")

            try:
                validation_result = self.basis_validator.validate_legal_basis(
                    test_case["query"],
                    test_case["answer"]
                )

                results[test_name] = {
                    "success": True,
                    "is_valid": validation_result.is_valid,
                    "confidence": validation_result.confidence,
                    "validation_details": validation_result.validation_details,
                    "legal_sources": validation_result.legal_sources,
                    "issues": validation_result.issues,
                    "recommendations": validation_result.recommendations
                }

                logger.info(f"  - ê²€ì¦?ê²°ê³¼: {'? íš¨' if validation_result.is_valid else 'ë¬´íš¨'}")
                logger.info(f"  - ? ë¢°?? {validation_result.confidence:.2f}")

            except Exception as e:
                logger.error(f"?ŒìŠ¤??ì¼€?´ìŠ¤ {test_name} ?¤íŒ¨: {e}")
                results[test_name] = {
                    "success": False,
                    "error": str(e)
                }

        return results

    def test_structure_enhancer(self) -> Dict[str, Any]:
        """?µë? êµ¬ì¡°??ê°•í™” ?œìŠ¤???ŒìŠ¤??""
        logger.info("=== ?µë? êµ¬ì¡°??ê°•í™” ?œìŠ¤???ŒìŠ¤???œì‘ ===")

        results = {}
        for test_name, test_case in self.test_cases.items():
            logger.info(f"?ŒìŠ¤??ì¼€?´ìŠ¤: {test_name}")

            try:
                # ì§ˆë¬¸ ? í˜• ë¶„ë¥˜
                question_type = self.structure_enhancer.classify_question_type(test_case["query"])

                # ë²•ì  ê·¼ê±° ê²€ì¦?
                validation_result = self.basis_validator.validate_legal_basis(
                    test_case["query"],
                    test_case["answer"]
                )

                # ?µë? êµ¬ì¡°??
                structured_answer = self.structure_enhancer.create_structured_answer(
                    test_case["answer"],
                    question_type
                )

                results[test_name] = {
                    "success": True,
                    "question_type": question_type.value,
                    "is_legally_sound": validation_result.is_valid,
                    "confidence": validation_result.confidence,
                    "structured_answer": structured_answer
                }

                logger.info(f"  - ì§ˆë¬¸ ? í˜•: {question_type.value}")
                logger.info(f"  - ë²•ì  ê·¼ê±° ê²€ì¦? {'?µê³¼' if validation_result.is_valid else '?¤íŒ¨'}")

            except Exception as e:
                logger.error(f"?ŒìŠ¤??ì¼€?´ìŠ¤ {test_name} ?¤íŒ¨: {e}")
                results[test_name] = {
                    "success": False,
                    "error": str(e)
                }

        return results

    def test_integration_service(self) -> Dict[str, Any]:
        """?µí•© ?œë¹„???ŒìŠ¤??""
        logger.info("=== ?µí•© ?œë¹„???ŒìŠ¤???œì‘ ===")

        results = {}
        for test_name, test_case in self.test_cases.items():
            logger.info(f"?ŒìŠ¤??ì¼€?´ìŠ¤: {test_name}")

            try:
                result = self.integration_service.process_query_with_legal_basis(
                    test_case["query"],
                    test_case["answer"]
                )

                results[test_name] = {
                    "success": result["success"],
                    "question_type": result.get("question_type", "unknown"),
                    "is_legally_sound": result["is_legally_sound"],
                    "confidence": result["confidence"],
                    "enhanced_answer": result["enhanced_answer"],
                    "legal_basis": result["legal_basis"]
                }

                logger.info(f"  - ì§ˆë¬¸ ? í˜•: {result.get('question_type', 'unknown')}")
                logger.info(f"  - ? ë¢°?? {result['confidence']:.2f}")
                logger.info(f"  - ë²•ì  ê·¼ê±° ê²€ì¦? {'?µê³¼' if result['is_legally_sound'] else '?¤íŒ¨'}")

            except Exception as e:
                logger.error(f"?ŒìŠ¤??ì¼€?´ìŠ¤ {test_name} ?¤íŒ¨: {e}")
                results[test_name] = {
                    "success": False,
                    "error": str(e)
                }

        return results

    def run_all_tests(self) -> Dict[str, Any]:
        """ëª¨ë“  ?ŒìŠ¤???¤í–‰"""
        logger.info("=== ?„ì²´ ?ŒìŠ¤???¤í–‰ ===")

        all_results = {
            "citation_enhancer": self.test_citation_enhancer(),
            "basis_validator": self.test_basis_validator(),
            "structure_enhancer": self.test_structure_enhancer(),
            "integration_service": self.test_integration_service()
        }

        # ?”ì•½ ?ì„±
        all_results["summary"] = self._generate_test_summary(all_results)

        # ê²°ê³¼ ì¶œë ¥
        self.print_detailed_results(all_results)

        logger.info("=== ?„ì²´ ?ŒìŠ¤???„ë£Œ ===")
        logger.info(f"ì´??ŒìŠ¤??ì¼€?´ìŠ¤: {all_results['summary']['total_test_cases']}")
        logger.info(f"?±ê³µ???ŒìŠ¤?? {all_results['summary']['successful_tests']}")
        logger.info(f"?¤íŒ¨???ŒìŠ¤?? {all_results['summary']['failed_tests']}")
        logger.info(f"?„ì²´ ?±ê³µë¥? {all_results['summary']['success_rate']:.1f}%")

        return all_results

    def _generate_test_summary(self, all_results: Dict[str, Any]) -> Dict[str, Any]:
        """?ŒìŠ¤??ê²°ê³¼ ?”ì•½ ?ì„±"""
        total_tests = 0
        successful_tests = 0
        failed_tests = 0

        # ?œë¹„?¤ë³„ ?µê³„
        service_stats = {}
        citation_stats = {
            "total_citations_found": 0,
            "total_expected_citations": 0,
            "citation_accuracy": 0.0
        }
        confidence_stats = {
            "total_confidence": 0.0,
            "confidence_count": 0,
            "high_confidence_tests": 0,
            "medium_confidence_tests": 0,
            "low_confidence_tests": 0
        }

        for service_name, service_results in all_results.items():
            if service_name == "summary":
                continue

            service_stats[service_name] = {
                "total": 0,
                "successful": 0,
                "failed": 0,
                "success_rate": 0.0
            }

            for test_name, test_result in service_results.items():
                total_tests += 1
                service_stats[service_name]["total"] += 1

                if test_result.get("success", False):
                    successful_tests += 1
                    service_stats[service_name]["successful"] += 1
                else:
                    failed_tests += 1
                    service_stats[service_name]["failed"] += 1

                # ?¸ìš© ?µê³„ ?˜ì§‘
                if "citations_found" in test_result:
                    citation_stats["total_citations_found"] += test_result["citations_found"]
                if "expected_citations" in test_result:
                    citation_stats["total_expected_citations"] += test_result["expected_citations"]

                # ? ë¢°???µê³„ ?˜ì§‘
                if "confidence" in test_result:
                    confidence = test_result["confidence"]
                    confidence_stats["total_confidence"] += confidence
                    confidence_stats["confidence_count"] += 1

                    if confidence >= 0.8:
                        confidence_stats["high_confidence_tests"] += 1
                    elif confidence >= 0.6:
                        confidence_stats["medium_confidence_tests"] += 1
                    else:
                        confidence_stats["low_confidence_tests"] += 1

            # ?œë¹„?¤ë³„ ?±ê³µë¥?ê³„ì‚°
            if service_stats[service_name]["total"] > 0:
                service_stats[service_name]["success_rate"] = (
                    service_stats[service_name]["successful"] / service_stats[service_name]["total"] * 100
                )

        # ?„ì²´ ?±ê³µë¥?ê³„ì‚°
        success_rate = (successful_tests / total_tests * 100) if total_tests > 0 else 0

        # ?¸ìš© ?•í™•??ê³„ì‚°
        if citation_stats["total_expected_citations"] > 0:
            citation_stats["citation_accuracy"] = (
                citation_stats["total_citations_found"] / citation_stats["total_expected_citations"] * 100
            )

        # ?‰ê·  ? ë¢°??ê³„ì‚°
        if confidence_stats["confidence_count"] > 0:
            confidence_stats["average_confidence"] = (
                confidence_stats["total_confidence"] / confidence_stats["confidence_count"]
            )

        return {
            "total_test_cases": total_tests,
            "successful_tests": successful_tests,
            "failed_tests": failed_tests,
            "success_rate": success_rate,
            "service_statistics": service_stats,
            "citation_statistics": citation_stats,
            "confidence_statistics": confidence_stats,
            "test_date": datetime.now().isoformat(),
            "system_version": "1.0.0"
        }

    def print_detailed_results(self, results: Dict[str, Any]):
        """?ì„¸ ê²°ê³¼ ì¶œë ¥"""
        print("\n" + "="*80)
        print("ë²•ì  ê·¼ê±° ?œì‹œ ?œìŠ¤???ŒìŠ¤??ê²°ê³¼")
        print("="*80)

        for service_name, service_results in results.items():
            if service_name == "summary":
                continue

            print(f"\n[{service_name.upper()}]")
            print("-" * 40)

            for test_name, test_result in service_results.items():
                if test_result.get("success", False):
                    print(f"{test_name}: ???±ê³µ")
                    if "citations_found" in test_result:
                        print(f"  - ë°œê²¬???¸ìš©: {test_result['citations_found']}ê°?)
                    if "confidence" in test_result:
                        print(f"  - ? ë¢°?? {test_result['confidence']:.2f}")
                    if "is_legally_sound" in test_result:
                        print(f"  - ë²•ì  ê·¼ê±° ê²€ì¦? {'?µê³¼' if test_result['is_legally_sound'] else '?¤íŒ¨'}")
                else:
                    print(f"{test_name}: ???¤íŒ¨")
                    print(f"  - ?¤ë¥˜: {test_result.get('error', 'Unknown error')}")

        # ?”ì•½ ?•ë³´ ì¶œë ¥
        if "summary" in results:
            summary = results["summary"]
            print(f"\n[?”ì•½]")
            print("-" * 40)
            print(f"ì´??ŒìŠ¤??ì¼€?´ìŠ¤: {summary['total_test_cases']}")
            print(f"?±ê³µ???ŒìŠ¤?? {summary['successful_tests']}")
            print(f"?¤íŒ¨???ŒìŠ¤?? {summary['failed_tests']}")
            print(f"?„ì²´ ?±ê³µë¥? {summary['success_rate']:.1f}%")

            # ?œë¹„?¤ë³„ ?µê³„
            if "service_statistics" in summary:
                print(f"\n[?œë¹„?¤ë³„ ?µê³„]")
                print("-" * 40)
                for service_name, stats in summary["service_statistics"].items():
                    print(f"{service_name}: {stats['successful']}/{stats['total']} ({stats['success_rate']:.1f}%)")

            # ?¸ìš© ?µê³„
            if "citation_statistics" in summary:
                citation_stats = summary["citation_statistics"]
                print(f"\n[?¸ìš© ?µê³„]")
                print("-" * 40)
                print(f"ë°œê²¬??ì´??¸ìš©: {citation_stats['total_citations_found']}ê°?)
                print(f"?ˆìƒ ì´??¸ìš©: {citation_stats['total_expected_citations']}ê°?)
                print(f"?¸ìš© ?•í™•?? {citation_stats['citation_accuracy']:.1f}%")

            # ? ë¢°???µê³„
            if "confidence_statistics" in summary:
                confidence_stats = summary["confidence_statistics"]
                print(f"\n[? ë¢°???µê³„]")
                print("-" * 40)
                print(f"?‰ê·  ? ë¢°?? {confidence_stats.get('average_confidence', 0):.2f}")
                print(f"?’ì? ? ë¢°??(??.8): {confidence_stats['high_confidence_tests']}ê°?)
                print(f"ë³´í†µ ? ë¢°??(0.6-0.8): {confidence_stats['medium_confidence_tests']}ê°?)
                print(f"??? ? ë¢°??(<0.6): {confidence_stats['low_confidence_tests']}ê°?)


def convert_all_objects_for_json(obj):
    """ëª¨ë“  ê°ì²´ë¥?JSON ì§ë ¬??ê°€?¥í•œ ?•íƒœë¡?ë³€??""
    if hasattr(obj, '__dict__'):
        # dataclass??ê°ì²´??ê²½ìš°
        return obj.__dict__
    elif isinstance(obj, dict):
        return {key: convert_all_objects_for_json(value) for key, value in obj.items()}
    elif isinstance(obj, list):
        return [convert_all_objects_for_json(item) for item in obj]
    elif isinstance(obj, tuple):
        return list(convert_all_objects_for_json(item) for item in obj)
    else:
        return obj


def main():
    """ë©”ì¸ ?¨ìˆ˜"""
    try:
        logger.info("=== ë²•ì  ê·¼ê±° ?œì‹œ ?œìŠ¤???„ì²´ ?ŒìŠ¤???œì‘ ===")

        # ?ŒìŠ¤???¤í–‰
        tester = LegalBasisSystemTester()
        results = tester.run_all_tests()

        # JSON ì§ë ¬??ë³€??
        results = convert_all_objects_for_json(results)

        with open("legal_basis_test_results.json", "w", encoding="utf-8") as f:
            json.dump(results, f, ensure_ascii=False, indent=2)

        print(f"\n?ŒìŠ¤??ê²°ê³¼ê°€ 'legal_basis_test_results.json' ?Œì¼???€?¥ë˜?ˆìŠµ?ˆë‹¤.")

    except Exception as e:
        logger.error(f"?ŒìŠ¤???¤í–‰ ì¤??¤ë¥˜ ë°œìƒ: {e}")
        return False

    return True


if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
